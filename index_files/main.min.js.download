function enableChangeAvatar(){$(document.body).select(".avatarChange").each(function(e){var t=new Element("a",{class:"changeAvatarLink",href:"/profile/edit/picture"}).update("Change picture");t.setStyle({width:e.getWidth()-4+"px"}),t.hide(),e.appendChild(t),e.observe("mouseover",function(){$(this).select(".changeAvatarLink")[0].show()}),e.observe("mouseout",function(){$(this).select(".changeAvatarLink")[0].hide()})})}function howtoInstallDiigolet(e){switch(e){case"ie":alert('Right-click on "Diigolet" and select "Add to Favorites"');break;default:alert('Drag "Diigolet" to your bookmarks toolbar')}}function installDiigoTool(e,t){var i=t.URI;t.version;switch(t.learnmore||(t.learnmore=!0),-1!=self.location.href.indexOf("/tools")&&(t.learnmore=!1),e){case"ff":var n="<div id='installFFToolbar'><img src='/images/ff-allow-arrow.png' />Install Diigo Toolbar in 3 steps<ul><li class='current'>1. Click Allow</li><li>2. Click Install Now</li><li>3. After downloading, Restart Firefox</li></ul>";t.learnmore&&(n+="<div id='installLeanmore'><a href='/tools'>Learn more&raquo;</a></div>"),n+="</div>",Modalbox.show(n,{title:"",width:400,position:"topRight",transitions:!1,overlayOpacity:.8,autoFocusing:!1});try{pageTracker._trackPageview("/download/ff_toolbar")}catch(e){}break;case"ie":var o=$("ieInstallInstruction");Modalbox.show(o,{title:"",width:860,transitions:!1,overlayOpacity:.75,autoFocusing:!1}),$("ieClickRun").setStyle({left:document.viewport.getDimensions().width/2+200+"px"}),$("ieClickRun").show();try{pageTracker._trackPageview("/download/ie_toolbar")}catch(e){}break;case"flock":var a="<div id='installFFToolbar'><img src='/images/ff-allow-arrow.png' />Install Diigo Toolbar in 3 steps<ul><li class='current'>1. Click Allow</li><li>2. Click Install Now</li><li>3. After downloading, Restart Flock</li></ul>";t.learnmore&&(a+="<div id='installLeanmore'><a href='/tools'>Learn more&raquo;</a></div>"),a+="</div>",Modalbox.show(a,{title:"",width:400,position:"topRight",transitions:!1,overlayOpacity:.8,autoFocusing:!1});try{pageTracker._trackPageview("/download/ff_toolbar")}catch(e){}break;case"chrome":var s="<div id='installDiigolet'>Install Diigolet in 3 steps<ul><li>1. Make sure your Bookmarks Toolbar is enabled</li><li>2. Drag the <a id='diigoletLink' href='"+i+"' onclick=\"alert('"+"Drag this to your bookmarks toolbar"+"');return false;\" >Diigolet</a> to your Bookmarks Toolbar</li><li>3. Click Diigolet to use it!</li></ul>";t.learnmore&&(s+="<div id='installLeanmore'><a href='/tools/diigolet'>Learn more&raquo;</a></div>"),s+="</div>",Modalbox.show(s,{title:"",width:600,transitions:!1,overlayOpacity:.8,autoFocusing:!1});break;default:s="<div id='installDiigolet'>Install Diigolet in 3 steps<ul><li>1. Make sure your Bookmarks Toolbar is enabled</li><li>2. Drag the <a id='diigoletLink' href='"+i+"' onclick=\"alert('"+"Drag this to your bookmarks toolbar"+"');return false;\">Diigolet</a> to your Bookmarks Toolbar</li><li>3. Click Diigolet to use it!</li></ul>";t.learnmore&&(s+="<div id='installLeanmore'><a href='/tools/diigolet'>Learn more&raquo;</a></div>"),s+="</div>",Modalbox.show(s,{title:"",width:600,transitions:!1,overlayOpacity:.8,autoFocusing:!1})}return!1}!function(){function e(e,i){var n=this;function t(){var e=arguments,t=n._thens.shift();t&&(e=t.comp.apply(i,e))&&(e._thens=n._thens)}function o(){var e=arguments,t=n._thens.shift();t&&t.err&&(e=t.err.apply(i,e))&&(e._thens=n._thens)}function a(){var e=n._thens[0];e&&e.prog&&e.prog.apply(i,arguments)}this._thens=[],setTimeout(function(){e.call(i,t,o,a)},0)}e.prototype.then=function(e,t,i){return e instanceof Function&&this._thens.push({comp:e,err:t,prog:i}),this},e.prototype.done=function(e){return e instanceof Function&&this._thens.push({comp:e}),null},e.prototype.cancel=function(e){this._thens.length=0,e instanceof Function&&e()},e.join=function(){var o=arguments,a=o.length,s=0,r=[];return new e(function(e,i,n){for(var t=0;t<a;t++)!function(t){o[t].then(function(){r[t]=arguments.length<=1?arguments[0]:arguments,n(++s),s==a&&e.apply(this,r)},function(){var e=Array.prototype.slice.call(arguments);e.push("error in function "+t),i.apply(this,e)})}(t)})},e.any=function(){var i=arguments,n=i.length,o=!1;return new e(function(e){for(var t=0;t<n;t++)i[t].done(function(){o||(o=!0,e.apply(this,arguments))})})},e.as=function(t){return new e(function(e){e(t)})},window.YPro=window.YPromise=e}();var DCrumb=Class.create({initialize:function(e){this.defaultText=e.defaultText||"",this.value=e.value||"",this.scaleSize=e.scaleSize||1,this.action=e.action,this.name=e.name,this.crumbID=e.crumbID||"dCrumb",this.form=new Element("form",{id:this.crumbID+"Form",action:this.action,method:"get"}).setStyle({display:"inline"}),this.inputTxt=new Element("input",{id:this.crumbID+"InputTxt",name:this.name}),this.value.blank()?this.inputTxt.value=this.defaultText:this.inputTxt.value=this.value,this.inputSizer=new Element("span",{id:this.crumbID+"InputSizer"}).setStyle({position:"absolute",visibility:"hidden"}),this.form.appendChild(this.inputTxt),this.form.appendChild(this.inputSizer),this.instance=$(this.crumbID),this.instance.innerHTML="",this.instance.appendChild(this.form);var t=DCrumb.getTextSize(this.inputTxt.value,this.inputSizer);this.inputTxt.setStyle({width:t+20+"px"}),Event.observe(this.inputTxt,"focus",function(){this.inputTxt.value==this.defaultText&&(this.inputTxt.value="",this.inputTxt.setStyle({color:"#000"}))}.bind(this)),Event.observe(this.inputTxt,"blur",function(){this.inputTxt.value.blank()&&(this.inputTxt.value=this.defaultText,this.inputTxt.setStyle({color:"#ddd"}))}.bind(this)),Event.observe(this.inputTxt,"keydown",function(){var e=DCrumb.getTextSize(this.inputTxt.value,this.inputSizer);this.inputTxt.setStyle({width:e+20+"px"})}.bind(this)),Event.observe(this.inputTxt,"submit",function(){this.inputTxt.value=encodeURIComponent(this.inputTxt.value)}.bind(this))}});DCrumb.getTextSize=function(e,t){return t.innerHTML=e.escapeHTML().replace(/\s/g,"&nbsp;"),500<t.offsetWidth?500:t.offsetWidth};var TopNav=Class.create();function _copy(e){if(window.clipboardData)window.clipboardData.setData("Text",e);else{var t="flashcopier";if(!document.getElementById(t)){var i=document.createElement("div");i.id=t,document.body.appendChild(i)}document.getElementById(t).innerHTML="";var n='<embed src="/_clipboard.swf" FlashVars="clipboard='+encodeURIComponent(e)+'" width="0" height="0" type="application/x-shockwave-flash"></embed>';document.getElementById(t).innerHTML=n}}TopNav.ShowTimeOut=null,TopNav.hideTimeOut=null,TopNav.mouseoverHandler=function(e){TopNav.clearTimeHandler(),TopNav.showTimeOut=setTimeout(function(){TopNav.showContextMenu(e)},50)},TopNav.mouseoutHandler=function(){TopNav.clearTimeHandler(),TopNav.hideTimeOut=setTimeout(TopNav.hideContextMenu,200)},TopNav.clearTimeHandler=function(){clearTimeout(TopNav.showTimeOut),clearTimeout(TopNav.hideTimeOut)},TopNav.showContextMenu=function(e){$("topMenuHideIframe")||(TopNav.hideIframe=new Element("iframe",{id:"topMenuHideIframe"}),document.body.appendChild(TopNav.hideIframe),TopNav.hideIframe.hide()),TopNav.hideIframe=$("topMenuHideIframe"),li=$(e),TopNav.selected&&TopNav.selected!=li&&TopNav.hideContextMenu(),TopNav.selected=li;var t=li.down(),i=t.next();if(!i.visible()){t.addClassName("flyMenu");var n,o,a=[t.offsetLeft,t.offsetTop];n=a[0]+0,o=a[1]+t.getHeight(),i.setStyle({display:"block",left:n+"px",top:o+"px"}),submenu_p=Position.cumulativeOffset(i),TopNav.hideIframe.setStyle({display:"block",position:"absolute",border:0,frameborder:"no",left:submenu_p[0]+"px",top:submenu_p[1]+"px",width:i.getWidth()+"px",height:i.getHeight()+"px"})}},TopNav.hideContextMenu=function(){if(TopNav.selected){var e=TopNav.selected.down(),t=e.next();t.visible()&&(TopNav.hideIframe.hide(),t.hide(),e.removeClassName("flyMenu")),TopNav.selected=null}};var EOCBox=Class.create({initialize:function(e,t){$(e).select(".eocBox").each(function(e){var t=e.down(),i="2px",n="Collapse";t.next().visible()||(i="bottom",n="Expand"),Element.insert(t,{top:"<a href='javascript:void(0);' title='"+n+"' style='display:block;width:13px;height:20px;float:left;background:url(/images/v2/eoc.gif) -5px "+i+" no-repeat;text-decoration:none;'>&nbsp;</a>"}),t.onclick=EOCBox.doEOC,t.style.cursor="pointer"})}});function getMessageCount(){return new Ajax.Request("/message_mana/get_message_count",{asynchronous:!0,evalScripts:!1,method:"get",onComplete:function(e){"200"==e.status&&($("messageCount").innerHTML="("+e.responseText+")")}}),!1}function initDomainCrumb(){var e="e.g. www.nytimes.com",t=$("txtDomainCrumb");t.value;!/^\s*$/.test(t.value)&&t.value!=e||t.addClassName("tip").setValue(e);function i(e){e&&e.keyCode==Event.KEY_RETURN&&(n=!0),t.setStyle({width:t.next("div").update(t.value).getWidth()+35+"px"})}var n=!1,o=!1;t.observe("keypress",i).observe("keyup",i).observe("focus",function(){t.addClassName("focused"),o=!0,t.value==e&&t.removeClassName("tip").setValue("")}).observe("blur",function(){if(n)return!1;t.removeClassName("focused"),o=!1,/^\s*$/.test(t.value)&&t.addClassName("tip").setValue(e),i()}).observe("mouseover",function(){t.addClassName("focused")}).observe("mouseout",function(){o||t.removeClassName("focused")}),i()}function doTopSearch(){var e=$("topSearchForm"),t=(e.scope.value,e.what.value);self.location=BOOKMARK_HOST+"/search?what="+encodeURIComponent(t)}EOCBox.doEOC=function(){var e=this.down(),t=this.next();t.visible()?(t.hide(),e.style.backgroundPosition="-5px bottom",e.title="Expand"):(t.show(),e.style.backgroundPosition="-5px 2px",e.title="Collapse")};var ContextMenu=Class.create({initialize:function(e,n){var o=n.eventType||"click",a=n.showTimeoutMillisecond||50;ContextMenu.hideIframe||$("contextMenuHideIframe")||(ContextMenu.hideIframe=new Element("iframe",{id:"contextMenuHideIframe"}),document.body.appendChild(ContextMenu.hideIframe),ContextMenu.hideIframe.hide()),$(e).select(".contextMenu").each(function(t){var e=t.down(),i=e.next();if(n.submenuId&&(i=$(n.submenuId)),"click"==o)e.onclick=function(){return e.blur(),ContextMenu.clearTimeHandler(),i.visible()?ContextMenu.onclick():(ContextMenu.showContextMenu(t,n),Event.observe(document,"mousedown",ContextMenu.onclick)),!1};else if("mouseover"==o){if(t.onmouseover=function(e){ContextMenu.clearTimeHandler(),ContextMenu.showTimeOut=setTimeout(function(){ContextMenu.showContextMenu(t,n)},a)},t.onmouseout=function(){ContextMenu.clearTimeHandler(),ContextMenu.hideTimeOut=setTimeout(ContextMenu.hideContextMenu,500)},!t.select(".subMenu")[0])return;t.select(".subMenu")[0].childElements().each(function(e){e.onmouseover=function(){ContextMenu.clearTimeHandler()},e.onmouseout=function(){ContextMenu.clearTimeHandler(),ContextMenu.hideTimeOut=setTimeout(ContextMenu.hideContextMenu,500)},e.onclick=function(){ContextMenu.clearTimeHandler(),ContextMenu.hideContextMenu()}})}})}});function AutoComplete(e,t,i){if(this.id=t,this.inputField=document.getElementById(e),!this.inputField)return null;if(!$(t)){var n=document.createElement("ul");n.id=t,n.className="autoUL",n.style.display="none",document.body.appendChild(n)}this.completeDiv=$(t),null!=i&&(this.submitBtn=document.getElementById(i)),this.itemPrefix=t,this.temItemIndex=-1,this.items,this.filterItems,this.init,this.afterTab=function(){return!0},this.afterCreated=function(){return!0},this.cleanTail=function(e){return e.replace(/\s*$/,"").replace(/,*$/,"")},this.autoSizeInput=!0,this.findItems=autoCompleteFindItems,this.clearItems=autoCompleteClearItems,this.afterEnter=this.clearItems,this.setOffsets=autoCompleteSetOffsets,this.calculateOffset=autoCompleteCalculateOffest,this.populateItems=autoCompletePopulateItems,this.keydown=autoCompleteKeydown,(this.inputField.object=this).disabled=!1,this.turnOff=function(){this.inputField.onkeyup=null,this.inputField.onkeydown=null,this.disabled=!1},this.turnOn=function(){this.inputField.onkeyup=this.findItems,this.inputField.onkeydown=this.keydown,this.disabled=!0},this.inputField.onblur=function(){return setTimeout(this.object.clearItems.bind(this.object),200),blurKeyword(),!1},this.lockSubmit=function(){this.lockedSubmit=!0,this.submitBtn&&(this.submitBtn.disabled=!0)},this.unlockSubmit=function(){this.lockedSubmit=!1,this.submitBtn&&(this.submitBtn.disabled=!1)},this.updateInput=function(e){var t=ParseTags.parseTags(this.inputField.value);t.pop();var i=ParseTags.unparseTags(t);this.inputField.value=(i+" "+e).trim().replace(/&amp;/,"&")+" ",this.autoSizeInput&&(this.inputField.style.width=getTextSize(this.inputField.value,$("tagsCrumbSizer"))+"px")},this.up=function(){setCaretPos(this.inputField,255);var e=document.getElementById(this.itemPrefix+"Item_"+(this.temItemIndex-1));if(e){e.className="mouseOver";var t=document.getElementById(this.itemPrefix+"Item_"+this.temItemIndex);t&&(t.className="mouseOut"),this.temItemIndex--,this.updateInput(e.innerHTML)}},this.down=function(){setCaretPos(this.inputField,255);var e=document.getElementById(this.itemPrefix+"Item_"+(this.temItemIndex+1));if(e){e.className="mouseOver";var t=document.getElementById(this.itemPrefix+"Item_"+this.temItemIndex);t&&(t.className="mouseOut"),this.temItemIndex++,this.updateInput(e.innerHTML)}}}function autoCompleteKeydown(e){var t,i=this.object;return window.event?t=window.event.keyCode:e&&(t=e.which),9!=t||(!$(i.itemPrefix).visible()||(i.down(),!1))}function autoCompleteClearItems(){this.lockedSubmit&&this.unlockSubmit(),this.completeDiv&&(this.completeDiv.innerHTML="",this.completeDiv.style.display="none"),this.actShadow&&(this.actShadow.style.display="none");try{this.autoSizeInput&&(this.inputField.style.width=getTextSize(this.inputField.value,$("tagsCrumbSizer"))+"px")}catch(e){}}function autoCompleteFindItems(e){var t,i=this.object;switch(window.event?t=window.event.keyCode:e&&(t=e.which),t){case 40:return i.down(),!1;case 38:return i.up(),!1;case 13:return-1!=i.temItemIndex&&i.populateItems(document.getElementById(i.itemPrefix+"Item_"+i.temItemIndex)),i.afterEnter(),i.temItemIndex=-1,i.submitBtn&&i.submitBtn.click(),!1;case 9:return!1}0<i.inputField.value.length?i.filterItems(i.items):i.clearItems()}function autoCompleteSetOffsets(){this.inputField.offsetWidth;var e=this.calculateOffset(this.inputField,"offsetLeft"),t=this.calculateOffset(this.inputField,"offsetTop")+this.inputField.offsetHeight,i=$(this.id);i.setStyle({left:e+"px",top:t+"px",zIndex:888888});var n=i.getWidth(),o=i.getHeight();this.actShadow||(this.actShadow=new Element("iframe",{id:this.id+"Shadow",width:n+"px",height:o+"px"}),this.actShadow.setAttribute("frameBorder","0"),this.actShadow.setAttribute("marginheight","0"),this.actShadow.setAttribute("marginwidth","0"),this.actShadow.setAttribute("scrolling","no"),document.body.appendChild(this.actShadow)),this.actShadow.setStyle({left:e+"px",top:t+"px",zIndex:888887,position:"absolute",width:n+"px",height:o+"px"}),this.actShadow.style.display=""}function autoCompleteCalculateOffest(e,t){for(var i=0;e;)i+=e[t],e=e.offsetParent;return i}function autoCompletePopulateItems(e){var t=document.getElementById(this.itemPrefix+"Item_"+this.temItemIndex);this.updateInput(t.innerHTML),this.clearItems()}ContextMenu.showTimeOut=null,ContextMenu.hideTimeOut=null,ContextMenu.selected=null,ContextMenu.selected_submenu=null,ContextMenu.options=null,ContextMenu.onclick=function(e){e&&e.target.className&&/keepShow/.test(e.target.className)||(ContextMenu.clearTimeHandler(),ContextMenu.hideTimeOut=setTimeout(ContextMenu.hideContextMenu,200),Event.stopObserving(document,"mousedown",ContextMenu.onclick))},ContextMenu.clearTimeHandler=function(){ContextMenu.showTimeOut&&clearTimeout(ContextMenu.showTimeOut),ContextMenu.hideTimeOut&&clearTimeout(ContextMenu.hideTimeOut)},ContextMenu.showContextMenu=function(e,t){ContextMenu.selected&&ContextMenu.selected!=e&&ContextMenu.hideContextMenu(),ContextMenu.options=t,(ContextMenu.selected=e).addClassName("contextmenushow");var i=ContextMenu.selected,n=i.down().next();if(t.submenuId&&(n=$(t.submenuId)),n&&!n.visible()){t.togglerClass&&i.addClassName(t.togglerClass);var o=(ContextMenu.selected_submenu=n).select(".spinous");if(0<o.length){var a=!0;o=o[0]}else a=!1;var s=Position.cumulativeOffset(i),r=s[0],l=s[0],d=s[1]+i.getHeight(),c=t.offsetX||0;t.offsetY;if(n.getWidth()+s[0]+30>document.body.offsetWidth?r=s[0]-(n.getWidth()-i.getWidth())+5:(r=s[0]+c-5,"right"==t.align&&(r=s[0]+i.getWidth()-n.getWidth())),document.body.appendChild(n),t.className&&n.addClassName(t.className),n.setStyle({display:"block",left:r+"px",top:1==a?d+6+"px":d+"px"}),a){var u=t.spioffset||0;o.setStyle({top:"-8px",left:l-r+u+"px"})}ContextMenu.hideIframe.setStyle({display:"block",postion:"absolute",border:0,frameborder:"no",left:r+"px",top:1==a?d+6+"px":d+"px",width:n.getWidth()+"px",height:n.getHeight()+"px"})}},ContextMenu.hideContextMenu=function(){if(ContextMenu.selected){ContextMenu.selected.removeClassName("contextmenushow");var e=ContextMenu.selected.down(),t=ContextMenu.selected_submenu;ContextMenu.options.submenuId&&(t=$(ContextMenu.options.submenuId)),t.visible()&&(ContextMenu.hideIframe.hide(),t.hide(),ContextMenu.options.togglerClass&&e.removeClassName(ContextMenu.options.togglerClass),ContextMenu.selected.appendChild(t)),ContextMenu.selected=null}};var DEFAULT_C_MODE="0",DEFAULT_S_MODE="2",DURATION_1=3e5,DURATION_2=3e3,DURATION_3=1e4,USER_DEF_AVATAR="_d_u",GROUP_DEF_AVATAR="_d_g";function initOnMouseUp(){window.document.onmouseup=function(){for(var e=0;e<window.onmouseupListeners.length;e++){window.onmouseupListeners[e].call()}}}function switchStyle(e){if(document.getElementsByTagName)for(var t=document.getElementsByTagName("link"),i=0;i<t.length;i++)-1!=t[i].getAttribute("rel").indexOf("style")&&t[i].getAttribute("title")&&(t[i].disabled=!0,t[i].getAttribute("title")==e&&(t[i].disabled=!1))}function switchBox(e,t){new(Effect[Element.visible(e)?"BlindUp":"BlindDown"])(e,{duration:.25}),new(Effect[Element.visible(t)?"BlindUp":"BlindDown"])(t,{duration:.25})}function switchBox2(e,t){new(Effect[Element.visible(e)?"BlindUp":"BlindDown"])(e,{duration:.25}),new(Effect[Element.visible(t)?"BlindUp":"BlindDown"])(t,{duration:.25})}function encodeAdSyntax(){var e="",t=$F("ad_tags").trim();""!=t&&(e+=t="tag:("+t+") ");var i=$F("ad_url").trim();""!=i&&(e+=i="url:("+i+") ");var n=$F("ad_title").trim();""!=n&&(e+=n="title:("+n+") ");var o=$F("ad_desc").trim();""!=o&&(e+=o="desc:("+o+") ");var a=$F("ad_text").trim();""!=a&&(e+=a="text:("+a+") ");var s=$F("ad_comments").trim();""!=s&&(e+=s="c:("+s+") ");var r=$F("ad_highlights").trim();""!=r&&(e+=r="h:("+r+") ");var l=$F("ad_anywhere").trim();""!=l&&(e+=l+=" ");var d=$F("ad_anywhere_2").trim();""!=d&&(e+=d='"'+d+'" ');var c=$F("ad_nowhere").trim();return""!=c&&(e+=c="-("+c+")"),e}function decodeAdSyntax(e){var t=$F(e).trim(),i=new RegExp(/tags?:\([^\)]*\)/i);if(u=t.match(i)){var n=u[0];t=t.replace(n,"");var o=n.substring(n.indexOf(":(")+2,n.length-1);$("ad_tags").value=o.trim()}else $("ad_tags").value="";i=new RegExp(/titles?:\([^\)]*\)/i);if(u=t.match(i)){n=u[0];t=t.replace(n,"");var a=n.substring(n.indexOf(":(")+2,n.length-1);$("ad_title").value=a.trim()}else $("ad_title").value="";i=new RegExp(/text?:\([^\)]*\)/i);if(u=t.match(i)){n=u[0];t=t.replace(n,"");var s=n.substring(n.indexOf(":(")+2,n.length-1);$("ad_text").value=s.trim()}else $("ad_text").value="";i=new RegExp(/url:\([^\)]*\)/i);if(u=t.match(i)){n=u[0];t=t.replace(n,"");var r=n.substring(n.indexOf(":(")+2,n.length-1);$("ad_url").value=r.trim()}else $("ad_url").value="";i=new RegExp(/c:\([^\)]*\)/i);if(u=t.match(i)){n=u[0];t=t.replace(n,"");var l=n.substring(n.indexOf(":(")+2,n.length-1);$("ad_comments").value=l.trim()}else $("ad_comments").value="";i=new RegExp(/h:\([^\)]*\)/i);if(u=t.match(i)){n=u[0];t=t.replace(n,"");var d=n.substring(n.indexOf(":(")+2,n.length-1);$("ad_highlights").value=d.trim()}else $("ad_highlights").value="";i=new RegExp(/\-\([^\)]*\)/i);if(u=t.match(i)){n=u[0];t=t.replace(n,"");var c=n.substring(n.indexOf("-(")+2,n.length-1);$("ad_nowhere").value=c.trim()}else $("ad_nowhere").value="";var u;i=new RegExp(/\"[^\"]*\"/i);if(u=t.match(i)){n=u[0];t=t.replace(n,"");var p=n.substring(n.indexOf('"')+1,n.length-1);$("ad_anywhere_2").value=p.trim()}else $("ad_anywhere_2").value="";n=t.trim();$("ad_anywhere").value=n}function calculateOffest(e,t){for(var i=0;e;)i+=e[t],e=e.offsetParent;return i}function initSideBarBoxSwitchAble(){for(var e=0,t=$("sideBarBoxTitle_"+e),i=$("eocMark_"+e),n=$("sideBarBoxContent_"+e);t;)t.onclick=switchSideBarBox,""==n.style.display?i.className+=" expand":i.className+=" collapse",e++,t=$("sideBarBoxTitle_"+e),i=$("eocMark_"+e),n=$("sideBarBoxContent_"+e)}function switchSideBarBox(){var e=this.id.split("_")[1],t=$("sideBarBoxContent_"+e);new(Effect[Element.visible(t)?"BlindUp":"BlindDown"])(t,{duration:.25});var i=$("eocMark_"+e);""==t.style.display?i.className=i.className.replace("expand","collapse"):i.className=i.className.replace("collapse","expand")}function getCookieDomain(){return D_DOMAIN}function Cookie(e,t,i,n,o,a){this.$document=e,this.$name=t,this.$expiration=i?new Date((new Date).getTime()+36e5*i):null,this.$path=n||null,this.$domain=o||null,this.$secure=a||null}function report(){window.open("/report/index",null,"width=380,height=500, left=0, top=0, status=no,resizable=no")}function getInstallURL(e){for(var t=e.target;t&&!t.href;)t=t.parentNode;return t&&t.href}function install(e,t,i,n){if(e.altKey||!window.InstallTrigger)return!0;var o=getInstallURL(e);if(o){var a=new Array;return a[t]={URL:o,IconURL:i,toString:function(){return this.URL}},n&&(a[t].Hash=n),InstallTrigger.install(a),!1}return!0}function flashNotice2(e,t,i,n){null==t&&(t="noticeBar"),null==i&&(i=""),null==n&&(n=1e4);var o=$(t);if(o){null!=window.noticeTimeout&&clearTimeout(window.noticeTimeout),null!=window.noticeClassName&&(o.removeClassName(window.noticeClassName),window.noticeClassName=""),i.blank()||(o.addClassName(i),window.noticeClassName=i),window.noticeTimeout=setTimeout(function(){var e=$(t);e.hide(),i.blank()||(e.removeClassName(i),window.noticeClassName="")},n);var a=o.getElementsByClassName("contentb");0<a.length?a[0].innerHTML=e:o.innerHTML=e,o.show()}}function hideNotice2(e){void 0===e&&(e="tailNoticer");var t=$(e);t&&t.hide()}function quickFadeFlashNoticer(){}function showCentralNoticer(e,t){void 0===t&&(t="centralNoticer"),void 0===e&&(e="Processing...");var i=$(t+"_box"),n=$(t+"_content");i||((i=document.createElement("div")).className="centralNoticerBox",i.id=t+"_box",(n=document.createElement("div")).id=t+"_content",n.className="centralNoticerContent",i.appendChild(n),document.body.appendChild(i)),n.innerHTML=e;var o=document.body.offsetWidth/2-$(t+"_box").getWidth()/2;i.show(),i.setStyle({left:o+"px",top:0})}function updateCentralNoticer(e,t){void 0===t&&(t="centralNoticer"),$(t+"_content").innerHTML=e}function hideCentralNoticer(e){"undefined"==typeof noticerID&&(noticerID="centralNoticer"),void 0===e&&(e=1),e*=1e3,$(noticerID+"_box").style.display="none"}function EasySignin(e){return $(e+"_switcher")?(this.valid=!0,this.id=e,this.enableEasySignin=function(){return $(this.id+"_switcher").onclick=this.switchEasySignin,!1},this.disableEasySignin=function(){return!($(this.id+"_switcher").onclick=null)},this.switchEasySignin=function(){var e=this.id.split("_")[0],t=$(e+"_box");if(""==t.style.display)t.style.display="none";else{var i=$(e+"_switcher"),n=(i.offsetWidth,calculateOffest(i,"offsetLeft")),o=calculateOffest(i,"offsetTop")+i.offsetHeight;t.style.left=n-30+"px",t.style.top=o+"px",t.style.display="",$(e+"_username").focus()}return!1},this.initEasySinginBox=function(){var e=this.id,t=document.createElement("div");t.style.display="none",t.id=e+"_box",t.className="signinBox";var i=document.createElement("div");i.className="top";var n=document.createElement("img");n.id=e+"_closer",n.src="/images/v2/closer.gif",n.onclick=this.switchEasySignin,i.appendChild(n);var o=document.createElement("div");o.className=e+"_content";var a=document.createElement("form");a.method="post",a.action="/user_mana2/login";var s=document.createElement("input");s.name="referInfo",s.value=self.location,s.type="hidden",a.appendChild(s);var r=document.createElement("label");r.innerHTML=DIS_1;var l=document.createElement("input");l.type="text",l.id=e+"_username",l.name="username",l.className="inputTxt",a.appendChild(r),a.appendChild(l),(r=document.createElement("label")).innerHTML=DIS_2,(l=document.createElement("input")).type="password",l.id=e+"_password",l.name="password",l.className="inputTxt",a.appendChild(r),a.appendChild(l),(l=document.createElement("input")).type="submit",l.value=DIS_3,l.id=e+"_submit",l.className="diigoBtn",a.appendChild(l),o.appendChild(a),t.appendChild(i),t.appendChild(o);var d=document.createElement("div");d.className="bottom",t.appendChild(d),document.body.appendChild(t)},!0):this.valid=!1}function Validator(){this.isEmail=/^\w+([-.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,this.isEmail2=/^.+<\w+([-.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*>$/,this.isTags=/^[^%&]+$/,this.isTag=/^[^%&\s]*$/,this.isUsername=/^[a-zA-Z]([0-9a-zA-Z\-_]{5,15})$/,this.isUrl=/^https?:\/\/.+$/,this.isUrl2=/^([a-z]+:\/\/)?([a-z0-9.-]+)(:[0-9]+)?(\/[a-z0-9+&-@#\/%=~_|!:,.;]*)?(\?[a-z0-9+&-@#\/%=~_|!:,.;]*)?$/i,this.isPhoneNum=/(^(\d{2,4}[-_－—]?)?\d{3,8}([-_－—]?\d{3,8})?([-_－—]?\d{1,7})?$)|(^0?1[35]\d{9}$)/,this.isAllNum=/^[0-9]*$/,this.IsAllNum=function(e){return re=this.isAllNum,re.test(e.trim())},this.IsEmail=function(e){return re=this.isEmail,re.test(e.trim())},this.IsEmail2=function(e){return re=this.isEmail2,re.test(e.trim())},this.IsTags=function(e){return re=this.isTags,re.test(e)},this.IsTag=function(e){return re=this.isTag,re.test(e)},this.IsUsername=function(e){return re=this.isUsername,re.test(e.trim())},this.IsPwd=function(e){return 6<=e.length&&e.length<=32},this.IsRealname=function(e){return 1<=e.length&&e.length<=64},this.IsTitle=function(e){return e.length<=255},this.IsSignature=function(e){return e.length<=255},this.IsUrl=function(e){return re=this.isUrl,re.test(e)},this.IsUrl2=function(e){return re=this.isUrl2,re.test(e)},this.IsPhoneNum=function(e){return re=this.isPhoneNum,re.test(e)}}function appendTip(e,t,i,n,o){var a=$(e);a.content=t,a.tipPosition=i,a.offsetX=n,a.offsetY=o,a.onmouseover=showFloatTip,a.onmouseout=hideFloatTip}function showFloatTip(){var e=getFloatTip("floatTip");e.innerHTML="<p>"+this.content+"</p>",setFloatTipOffsets(this,e,this.tipPosition,this.offsetX,this.offsetY),e.style.display="block"}function hideFloatTip(){getFloatTip("floatTip").style.display="none"}function getFloatTip(e){var t=$(e);return t||createFloatTip(e)}function createFloatTip(e){var t=document.createElement("div");return t.id=e,t.className=t.id,t.style.display="none",document.body.appendChild(t),t}function setFloatTipOffsets(e,t,i,n,o){var a,s,r=e.offsetWidth,l=e.offsetHeight;if(!n)n=0;if(!o)o=0;switch(i){case"top":a=calculateOffest(e,"offsetLeft"),bottom=calculateOffest(e,"offsetTop")+2,t.style.left=a+n+"px",t.style.bottom=bottom+o+"px";break;case"right":a=calculateOffest(e,"offsetLeft")+r+2,s=calculateOffest(e,"offsetTop"),t.style.left=a+n+"px",t.style.top=s+o+"px";break;case"bottom":a=calculateOffest(e,"offsetLeft"),s=calculateOffest(e,"offsetTop")+l+2,t.style.left=a+n+"px",t.style.top=s+o+"px";break;case"left":right=calculateOffest(e,"offsetLeft")+2,s=calculateOffest(e,"offsetTop")+l,t.style.right=right+n+"px",t.style.top=s+o+"px"}}function loading(e,t){void 0===t&&(t="small");var i=$(e);i.innerHTML='<img src="/images/v2/loading_'+t+'.gif" alt="loading..." />',i.style.display=""}function loadComplete(e){var t=$(e);t.innerHTML="",t.style.display="none"}function authFailed(){self.location="/sign-out"}function doSearch(e,t){void 0===e&&(e="T");var i,n=new RegExp(/^all$/i),o=new RegExp(/^my$/i),a=$F("dSearchScope").trim(),s=$F("dSearchKeyword").trim();if("T"==e)if(""==a||a.match(n)){if(s==_GLOBAL_VAR.keywordTip)return!1;i="/tag/"+s}else i=a.match(o)?s==_GLOBAL_VAR.keywordTip?"/user/"+_GLOBAL_VAR.my_name:"/user/"+_GLOBAL_VAR.my_name+"/"+s:s==_GLOBAL_VAR.keywordTip?"/user/"+a:"/user/"+a+"/"+s;else{if("F"!=e)return!1;i=s==_GLOBAL_VAR.keywordTip?"/search/ad="+t+"&who="+a+"&what=":"/search/ad="+t+"&who="+a+"&what="+s}return self.location=i,!1}function doFSearch(e){void 0===e&&(e="all");var t=0;"my"==e?$("dSearchScope").value="My":"all"==e?$("dSearchScope").value="All":"ad"==e&&(t=1),doSearch("F",t)}function fillScope(e){$("dSearchScope").value=e,switchScopeList()}function switchScopeList(){var e=$("scopeList");return"none"==e.style.display?(e.style.display="",setScopeListOffsets(e)):e.style.display="none",!1}function setScopeListOffsets(e){var t=$("dSearchScope"),i=(t.offsetWidth,calculateOffest(t,"offsetLeft")),n=calculateOffest(t,"offsetTop")+t.offsetHeight;e.style.left=i+"px",e.style.top=n+"px"}function blurKeyword(){var e=$("tagsCrumbInput");e&&(e.className=e.className.replace("focus",""),e.value.blank()&&(_GLOBAL_VAR.tagsCrumb.blank()?(e.value=_GLOBAL_VAR.tagsCrumbHint,e.className="blurNoTag"):e.value=_GLOBAL_VAR.tagsCrumb),e.value=e.value.trim(),e.style.width=getTextSize(e.value,$("tagsCrumbSizer"))+"px")}function focusKeyword(){}function setCaretPos(e,t){if(e.createTextRange){var i=e.createTextRange();i.move("character",t),i.select()}else 0<=e.selectionStart&&(e.focus(),e.setSelectionRange(t,t))}function loadCusData(){var e=getCookieDomain(),t=new Cookie(document,"cus_data",240,"/",e);return t.load(),t}function switchSearchMoreList(){var e=$("searchMore");return"none"==e.style.display?(e.style.display="",setSearchMoreOffsets(e)):e.style.display="none",!1}function setSearchMoreOffsets(e){var t=$("searchMoreLink"),i=(t.offsetWidth,calculateOffest(t,"offsetLeft")),n=calculateOffest(t,"offsetTop")+t.offsetHeight;e.style.left=i-75+"px",e.style.top=n+3+"px"}function confirmSpammer(e){var t=new PopWindow({optEnabled:!0,left:50,top:10,title:"Flag as a spammer?",root:"spammerFlag_"+e});t.show({}),$("wContent").innerHTML='<p>Please explain briefly why.</p><p><textarea style="width:90%" name="pop_msg" id="mark_comment"></textarea></p>',t.submit=function(){t.hide(),flagAsSpammer(e)},$("wSubmit").value="Ok"}function flagAsSpammer(i){return showCentralNoticer(),new Ajax.Request("/spam_mana/mark_spammer",{asynchronous:!0,evalScripts:!1,parameters:{spammer_id:i,comment:$("mark_comment").value},onComplete:function(e){if("200"==e.status){var t=$("spammerFlag_"+i);t.innerHTML="Spammer reported",t.onclick=null,hideCentralNoticer()}}}),!1}function confirmBuryLink(e,t){var i="";i=$("ditemItem_"+e)?"ditemItem_"+e:"actions";var n=new PopWindow({optEnabled:!0,left:50,top:10,title:"Bury this link?",root:i});n.show({}),$("wContent").innerHTML='<p>Want to bury this link? Please explain briefly why (this will really help our community manager) </p><p><textarea style="width:90%" name="pop_msg" id="mark_comment"></textarea></p>',n.submit=function(){n.hide(),buryLink(e,t)},$("wSubmit").value="Ok"}function buryLink(i,e){return showCentralNoticer(),new Ajax.Request("/spam_mana/bury_link",{asynchronous:!0,evalScripts:!1,parameters:{link_id:e,comment:$("mark_comment").value},onComplete:function(e){if("200"==e.status){var t=null;$("menu_item_"+i+"_bury")?t=$("menu_item_"+i+"_bury"):$("buryButton")&&(t=$("buryButton")),t&&(t.innerHTML=t.innerHTML.replace("Bury","Buried"),t.onclick=null),hideCentralNoticer()}}}),!1}function cLoadUserGroups(){var e="/group_mana/load_groups?u_name="+_GLOBAL_VAR.username;new Ajax.Request(e,{asynchronous:!0,evalScripts:!1,method:"get",onComplete:function(e){"200"==e.status?renderGroupsSidebar(e.responseText.evalJSON()):e.status}})}function renderGroupsSidebar(e){var t=$("groupsUL");if(!t)return!1;if(0<e.length){for(var i=0;i<_diigo_groups.length;i++){var n=document.createElement("li");n.innerHTML='<a href="'+GROUP_HOST+"/group/"+_diigo_groups[i].g_name+'">'+_diigo_groups[i].display_name+"</a>",n.id="group_"+i,t.appendChild(n)}$("groupCount").innerHTML=_diigo_groups.length}else $("groupCount").innerHTML=0}function cLoadRecommendUsersByUser(){var e="/recommend/user_by_user?username="+_GLOBAL_VAR.username;new Ajax.Request(e,{asynchronous:!0,evalScripts:!1,onComplete:function(e){"200"==e.status&&($("recommendUserHolder").innerHTML=e.responseText,0<$F("rUserCount")&&($("rUserList").style.display=""))}})}function markUserStatus(){var t=$("main").select(".dUserName"),i=[];t.each(function(e){i.push(e.getAttribute("username")||"")});var e="json_infos="+Object.toJSON(i);new Ajax.Request("/user_mana2/check_user_status",{asynchronous:!0,evalScripts:!1,method:"post",onComplete:function(e){checkUserStatusCompleted(e,t)},parameters:e})}function checkUserStatusCompleted(e,t){if("200"==e.status){var i=e.responseText.evalJSON();t.each(function(e){var t=e.getAttribute("username")||"";doMarkUserStatus(e,t,i[t])})}}function doMarkUserStatus(e,t,i){try{var n=e.up().getAttribute("title");1==i?(e.style.background="url(/images/v3/online_status.gif) no-repeat scroll 0 -25px",e.up().setAttribute("title",n+" online")):(e.style.background="url(/images/v3/online_status.gif) no-repeat scroll 0 2px",e.up().setAttribute("title",n+" offline")),e.style.paddingLeft="11px",e.style.width="37px"}catch(e){}}function focusInputTxt(e){e.className+=" inputFocus"}function blurInputTxt(e){e.className=e.className.replace(" inputFocus","")}function getTextSize(e,t){return t.innerHTML=e.escapeHTML().replace(/\s/g,"&nbsp;"),500<t.offsetWidth?500:t.offsetWidth+10}function tagsSortBy(e){var t=loadCusData();t.tag_cloud_options=e+_GLOBAL_VAR.userTagsOpt.viewType,t.store(),self.location.reload()}function tagsViewAs(e){"0"==e?($("userTagsUL").className="tagCloud",$("viewType_0").className="current",$("viewType_1").className=""):($("userTagsUL").className="tagList",$("viewType_0").className="",$("viewType_1").className="current"),_GLOBAL_VAR.userTagsOpt.viewType=e;var t=loadCusData();t.tag_cloud_options=_GLOBAL_VAR.userTagsOpt.sortType+e,t.store()}function initTagsCrumb(){_GLOBAL_VAR.tagsCrumbHint=_GLOBAL_VAR.tagsCrumbHint||"filter by tags, space-separated";var e=$("tagsCrumb");if(!e)return!1;e.innerHTML="";var t=document.createElement("form");t.style.display="inline";var i=document.createElement("input"),n=document.createElement("div");_GLOBAL_VAR.tagsCrumb||(_GLOBAL_VAR.tagsCrumb=""),i.type="text",i.value=_GLOBAL_VAR.tagsCrumb.blank()?_GLOBAL_VAR.tagsCrumbHint:_GLOBAL_VAR.tagsCrumb,i.value==_GLOBAL_VAR.tagsCrumbHint&&(i.className="blurNoTag"),i.onfocus=function(){this.className="focus",this.value==_GLOBAL_VAR.tagsCrumbHint?this.value="":this.value=this.value.trim()+" ",setCaretPos(this,255)},i.onmouseover=function(){this.className+=" mouseover"},i.onmouseout=function(){this.className=this.className.replace(/\s?mouseover/g,"")},i.id="tagsCrumbInput",i.maxLength=255,i.setAttribute("autocomplete","off");var o=document.createElement("input");o.type="submit",o.style.display="none",o.id="tagCrumbSubmit",t.onsubmit=function(){if(-1!=(n=self.location.href).indexOf("community/site")){var e=n.split("?"),t=e[0],i=e[1]||"";self.location=t.substring(0,t.lastIndexOf("/")+1)+encodeURIComponent($F("tagsCrumbInput").trim())+(i.blank()?"":"?"+i)}else if(-1!=n.indexOf("/network/"))self.location=BOOKMARK_HOST+"/network/"+_GLOBAL_VAR.username+"/tag/"+encodeURIComponent($F("tagsCrumbInput").trim());else if(/\/user\/.+\/.+/.test(n)){_GLOBAL_VAR.tag_tail_tab;if(_GLOBAL_VAR.username){var n="/user/"+_GLOBAL_VAR.username+"/"+encodeURIComponent($F("tagsCrumbInput").trim());_GLOBAL_VAR.item_type.empty()||(n+="?type="+_GLOBAL_VAR.item_type),self.location=n}else self.location="/tag/"+encodeURIComponent($F("tagsCrumbInput").trim())+window.location.search}else self.location=BOOKMARK_HOST+"/search/user?adSScope="+_GLOBAL_VAR.username+"&what="+encodeURIComponent($F("tagsCrumbInput").trim());return!1},t.appendChild(i),t.appendChild(o),n.className="tagsCrumbSizer",n.style.position="absolute",n.style.visibility="hidden",n.top=0,n.right=0,n.id="tagsCrumbSizer",e.appendChild(n),i.style.width=getTextSize(i.value,$("tagsCrumbSizer"))+"px",e.appendChild(t)}function searchSubmit(e){var t=e.type,i=e.value;if(e.value&&0<e.value.length){if("tag"==t)if(-1!=(s=self.location.href).indexOf("community/site")){var n=s.split("?"),o=n[0],a=n[1]||"";self.location=o.substring(0,o.lastIndexOf("/")+1)+encodeURIComponent(i.trim())+(a.blank()?"":"?"+a)}else if(-1!=s.indexOf("/network/"))self.location=BOOKMARK_HOST+"/network/"+_GLOBAL_VAR.username+"/tag/"+encodeURIComponent(i.trim());else{_GLOBAL_VAR.tag_tail_tab;if(_GLOBAL_VAR.username){var s="/user/"+_GLOBAL_VAR.username+"/"+encodeURIComponent(i.trim());_GLOBAL_VAR.item_type.empty()||(s+="?type="+_GLOBAL_VAR.item_type),self.location=s}else self.location="/tag/"+encodeURIComponent(i.trim())}else if("full"==t)if("true"!=_GLOBAL_VAR.ispremium){s="/premium";self.location=s}else{s="/search?adSScope="+"my"+"&what="+encodeURIComponent(i)+"&snapshot=yes";self.location=s}else if("meta"==t){s="/search?adSScope="+"my"+"&what="+encodeURIComponent(i)+"&snapshot=no";self.location=s}else if("edittag"==t){s="/cloud/"+_GLOBAL_VAR.my_name+"?q="+encodeURIComponent(i);self.location=s}}else{s="/";self.location=s}}function changeMonth(e){e=$("month").value;var t=$("day").value;if(0!=e){var i=31;switch(e){case"1":case"3":case"5":case"7":case"8":case"10":case"12":i=31;break;case"2":i=28;break;case"4":case"6":case"9":case"11":i=30}$("day").innerHTML="",(o=document.createElement("option")).value=0,o.innerHTML="Day:",$("day").appendChild(o);for(var n=1;n<=i;n++){var o;(o=document.createElement("option")).value=n,o.innerHTML=n,$("day").appendChild(o)}$("day").value=t}}function appendTip(e,t,i,n,o){var a=$(e);a.content=t,a.tipPosition=i,a.offsetX=n,a.offsetY=o,a.onmouseover=showFloatTip,a.onmouseout=hideFloatTip}window.onmouseupListeners=[],window.addOnMouseUpListener=function(e){window.onmouseupListeners[window.onmouseupListeners.length]=e},window.globalObjects=[],window.registerGlobalObject=function(e){window.globalObjects[e.id]=e},String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")},String.prototype.replaceAll=function(e,t,i){return raRegExp=new RegExp(e,"g"+i),this.replace(raRegExp,t)},Array.prototype.removeItem=function(e){return 0==e?(this.shift(),this):e>=this.length||e<0?this:this.slice(0,e).concat(this.slice(e+1,this.length))},Cookie.prototype.store=function(){var e="";for(var t in this)"$"!=t.charAt(0)&&"function"!=typeof this[t]&&(""!=e&&(e+="|"),e+=t+":"+escape(this[t]));var i=this.$name+"="+e;this.$expiration&&(i+="; expires="+this.$expiration.toGMTString()),this.$path&&(i+="; path="+this.$path),this.$domain&&(i+="; domain="+this.$domain),this.$secure&&(i+="; secure"),this.$document.cookie=i},Cookie.prototype.load=function(){var e=this.$document.cookie;if(""==e)return!1;var t=e.indexOf(this.$name+"=");if(-1==t)return!1;t+=this.$name.length+1;var i=e.indexOf(";",t);-1==i&&(i=e.length);for(var n=e.substring(t,i).split("|"),o=0;o<n.length;o++)n[o]=n[o].split(":");for(o=0;o<n.length;o++)this[n[o][0]]=unescape(n[o][1]);return!0},Cookie.prototype.remove=function(){var e;e=this.$name+"=",this.$path&&(e+="; path="+this.$path),this.$domain&&(e+="; domain="+this.$domain),e+="; expires=Fri, 02-Jan-1970 00:00:00 GMT",this.$document.cookie=e};var BrowserVersion={IE:!(!window.attachEvent||window.opera),Opera:!!window.opera,WebKit:-1<navigator.userAgent.indexOf("AppleWebKit/"),Gecko:-1<navigator.userAgent.indexOf("Gecko")&&-1==navigator.userAgent.indexOf("KHTML"),MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),getIEVersion:function(){var e=null;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e},isIE6:function(){return BrowserVersion.getIEVersion()&&BrowserVersion.getIEVersion()<=6}};function inputOnfocus(){var e=this.value,t=new Element("span",{id:"inputTipTemp",style:"display:none"});t.innerHTML=e,$("main").appendChild(t),this.value="",$(this).setStyle({color:"#000"})}function inputOnblur(){var t=this;setTimeout(function(){var e=$("inputTipTemp");t.value=e.innerHTML,e.remove(),$(t).setStyle({color:"#ccc"})},1e3)}function fixLeft(e,t){var i=Element.getDimensions(document.body);return e+t>=i.width?e=i.width-t:e<0&&(e=0),e}function fixTop(e,t){var i=Element.getDimensions("wrapper");return e+t>=i.height?e=i.height-t:e<0&&(e=0),e}var WORD_1="Title can't be empty",WORD_2="Tags can't be empty",WORD_3="Processing...",WORD_4="Operation failed! Please try again later.",WORD_5="Delete it?",WORD_6="Delete all?",WORD_7='Batch "Share To" Successfully',WORD_8="Your input can be seen by all Diigo members visiting the web page",WORD_9="No Comment No Post!",WORD_10="Remove this annotation?",WORD_11="Can't do this",WORD_12="Show Annotations",WORD_13="Collapse Annotations",WORD_14="Comment",WORD_15="Collapse",WORD_16="Expand",WORD_17="Edit",WORD_18="Forward",WORD_19="Delete",WORD_20="Forward",WORD_21="Unread",WORD_22="Read",WORD_23="Public",WORD_24="Private",WORD_25="Share to",WORD_26="Alert",WORD_27="Remove alert",WORD_28="alert",WORD_29="Add to a list",WORD_30="Revise tags",WORD_31="Up",WORD_32="Down",WORD_33="Top",WORD_34="Bottom",WORD_35="Remove from list",WORD_36="Post to the discussion thread for this URL",WORD_37="Add a private note",DIS_1="Username / Email",DIS_2="Password",DIS_3="Sign In",DIS_4="Template",DIS_5="Choose your favorite",DIS_6="Collapse",DIS_7="Expand",DIS_8="Show Annotations",DIS_9="Collapse Annotations",DIS_10="Processing...",DIS_11="All your del.icio.us tags will be imported in Diigo. In addition, you can set optional tag(s) to your del.icio.us bookmarks.",DIS_12="Highlight and sticky notes",DIS_13="Search Bookmarks...",DIS_14="Include URL and Title",DIS_15="Include URL, Title and Tag",DIS_16="Include URL, Title, Description, Tag, Highlights and Sticky notes",DIS_17="Include URL, Title, Description, Tag, Highlights and Sticky notes",DIS_18="Same as del.icio.us exporting format",DIS_19="Title can't be empty.",DIS_20="Please select a category.",DIS_21="Incorrect url format.",ALE_1="Username can't be empty.",ALE_2="Password can't be empty.",ALE_3="Incorrect username format.",ALE_4='Sorry, the username "?" is taken.',ALE_5='Great, the username "?" is available.',ALE_6="Incorrect password format.",ALE_7="The retyped Password does not match.",ALE_8="Incorrect email format.",ALE_9='Sorry, the email "?" is already in use under another username.',ALE_10='Great, the email "?" is available.',ALE_11="Your input was not correct.",ALE_12="You need to accept the Terms and Conditions to complete your registration.",ALE_13="Delete picture successfully!",ALE_14="First Name and Last Name can't be empty.",ALE_15="Save general informations successfully!",ALE_16="Change password successfully!",ALE_17="Incorrect url format.",ALE_18="Incorrect title format.",ALE_19="Incorrect tags format.",ALE_20="No bookmark selected",ALE_21="Remove this comment?",ALE_22="Remove this annotation?",ALE_23="Remove this sticky note?",ALE_24="No Comment No Post!",ALE_25="Delete bookmark?",ALE_26="Delete bookmark(s)?",ALE_27='Share to Group"?" successfully!',ALE_28='Share to Group"?" failed!',ALE_29="Oops, Current export job failed! Please try again later or ?",ALE_30="Delete this config?",ALE_31="Remove selected contact(s)?",ALE_32="Remove selected list(s)?",ALE_33="Remove from list?",ALE_34="Added to Outliner successfully!",ALE_35="Added to Outliner failed!",ALE_36="No workapd selected",ALE_37='Share to Group "?" successfully!',ALE_38="Remove this friend?",ALE_39="Remove this contact from the list?",ALE_40="Delete the post?",ALE_41="Delete the link?",ALE_42="Want to remove this module?",ALE_43="Remove my footprint?",ALE_44="Please select a email service",ALE_45='Want to remove this module?\n(you can add it back using "Add Content" in the upper right corner of the dashboard)',ALE_46="Incorrect phone number format.",ALE_47="Incorrect mobile phone format.",ALE_48="Incorrect land phone format.",ALE_49="Do you want to cancel subscription for diigo premium?",ALE_50="Converting this note to plain text will lose some formatting.\nAre you sure you want to continue?",EXC_1="Oops, server busy. Please try again later...",EXC_2="Sorry, upload picture failed. [1500]",EXC_3="Sorry, save general information failed. [1501]",EXC_4="Sorry, change password failed. [1502]",EXC_5="Sorry, server error. [1503]",EXC_6="Oops, bad request. [1400]",BL_1="End Point is Invalid",BL_2="Username Can not be empty",BL_3="Password Can not be empty",BL_4="Post Successfully!",BL_5="Post Failed!",BL_6="No Blog Selected",BL_7="Url is Invalid",BL_8="Convert to public",BL_9="Delete highlight",BL_10="All settings are verified. Check to post",BL_11="No password stored. Please enter when ready to post",BL_12="Your blog settings cannot be verified. Please check",BL_14="Your Blog(s) Saved with Diigo",BL_15="Could not find any API for your blog. Click Back to try another blog, or click next to manually configure your blog.",BL_16="Valid",BL_17="Checking...",BL_18="Invalid <span style='display:block'>Please remove the invalid blog and reconnect.</span>",BL_19="&lt;&lt; Need to select a blog before posting",BL_20="&lt;&lt; Need to select a blog first";function _popupControl(){}function follow(i,n){var o=$("followLink_"+i);$("followRequest");showCentralNoticer(DIS_10),new Ajax.Request("/friend/add_follow",{method:"post",parameters:{id:i,lw:!0,captcha:$("follow_captcha")?$("follow_captcha").value:""},onComplete:function(e){var t=e.responseText.evalJSON();hideCentralNoticer(),200==e.status&&1==t.status?(o&&(o.className="followingMark",o.innerHTML="<span><strong>Following</strong></span>",o.onclick=function(){unfollow_confirm(t.following_id,n)},o.title="You are following "+n+". Click to un-follow."),follow_window(t.following_id,t.whtml,n),AvatarPopup&&AvatarPopup.followCallback(e.status,"yes")):200==e.status&&-2==t.status&&follow_captcha_window(i,n,t.whtml)}})}function follow_window(e,t,i){var n=150;800<$("followLink_"+e).offsetLeft&&(n=-280),new PopWindow({optEnabled:!0,left:n,top:0,title:"",root:"followLink_"+e}).submit=add_following_to_list,PopWindow.instance.noticer.hide(),PopWindow.instance.content.show(),PopWindow.instance.submitBtn.value="Add "+i+" to this friend list",PopWindow.instance.opt.hide(),PopWindow.instance.appendNode(new Element("div",{id:"followForm",style:"padding:5px 10px 20px 5px;"})),$("followForm").innerHTML=t}function add_following_to_list(){var e=$("followRequest");PopWindow.instance.hide(),showCentralNoticer(DIS_10),new Ajax.Request("/friend/add_friend_to_list",{method:"post",parameters:Form.serialize(e),onComplete:function(e){var t=e.responseText.evalJSON();200==e.status&&t.status,hideCentralNoticer()}})}function follow_captcha_window(e,t,i){var n=150;800<$("followLink_"+e).offsetLeft&&(n=-280),new PopWindow({optEnabled:!0,left:n,top:0,title:"",root:"followLink_"+e}).submit=function(){follow(e,t)},jQuery("#wContent").html("Loading"),$("wSubmit").value="Follow",jQuery("#wContent").html(i),PopWindow.instance.opt.hide();setTimeout(function(){PopWindow.instance.opt.show()},50)}function changeAddToList(e){var t=$(this).value;0!=t&&(-1==t?showCreateNewList(e):($("show_contact_name_"+e).innerHTML=t,$("list_name_"+e).value=t,$(this).hide(),$("show_add_to_contact_"+e).show(),PopWindow.instance.opt.show()))}function showCreateNewList(e){$("list_creator_"+e).show(),$("list_selector_"+e).hide(),$("new_list_name_"+e).focus()}function removeAddToList(e){$("list_selector_"+e).show(),$("list_selector_"+e).value=0,$("show_add_to_contact_"+e).hide(),PopWindow.instance.opt.hide(),$("show_contact_name_"+e).innerHTML="",$("list_name_"+e).value=""}function createNewList(e){var t=$("new_list_name_"+e).value;$("list_name_"+e).value=t,$("show_contact_name_"+e).innerHTML=t,$("list_creator_"+e).hide(),$("show_add_to_contact_"+e).show(),PopWindow.instance.opt.show()}function cancelNewList(e){$("list_creator_"+e).hide(),$("list_selector_"+e).show(),$("list_selector_"+e).value=0}function unfollow_confirm(e,t){var i=150;800<$("followLink_"+e).offsetLeft&&(i=-280);var n=new PopWindow({optEnabled:!0,left:i,top:0,title:"",root:"followLink_"+e});$("wContent").innerHTML="Un-follow <strong>"+t+"</strong>?",n.submit=function(){unfollow(e,t)},$("wSubmit").value="Yes",$("wCancel").value="No",n.cancel=function(){PopWindow.instance.hide()}}function unfollow(n,e){PopWindow.instance.hide(),showCentralNoticer(DIS_10),new Ajax.Request("/friend/remove_follow",{method:"post",parameters:{id:n},onComplete:function(e){var t=e.responseText.evalJSON();if(200==e.status&&1==t.status){$("followLink_"+n);var i=$("user_"+n);i&&i.remove()}hideCentralNoticer(),AvatarPopup&&AvatarPopup.followCallback(e.status,"no")}})}var ParseTags={quoteTag:function(e){return(e=e.replace(/"/g,"'").replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")).match(/\s+|,/)&&(e='"'+e+'"'),e},parseTags:function(e,t){for(var i,n=[],o=[],a=!1,s=0,r=e.length;i=e.charAt(s),s<r;s++)'"'==i?a?(a=!1,l()):a=!0:a?n.push(i):/\s/.test(i)||","==i?l():n.push(i);return l(),t&&o.compact().map(function(e){e.strip()}).uniq(),o;function l(){0<n.length&&(o.push(n.join("")),n.length=0)}},unparseTags:function(e,t){return e.map(function(e){return ParseTags.quoteTag(e)}).join(t||" ")}};String.prototype.parseColor=function(){var e="#";if("rgb("==this.slice(0,4))for(var t=this.slice(4,this.length-1).split(","),i=0;e+=parseInt(t[i]).toColorPart(),++i<3;);else if("#"==this.slice(0,1)){if(4==this.length)for(i=1;i<4;i++)e+=(this.charAt(i)+this.charAt(i)).toLowerCase();7==this.length&&(e=this.toLowerCase())}return 7==e.length?e:arguments[0]||this},Element.collectTextNodes=function(e){return $A($(e).childNodes).collect(function(e){return 3==e.nodeType?e.nodeValue:e.hasChildNodes()?Element.collectTextNodes(e):""}).flatten().join("")},Element.collectTextNodesIgnoreClass=function(e,t){return $A($(e).childNodes).collect(function(e){return 3==e.nodeType?e.nodeValue:e.hasChildNodes()&&!Element.hasClassName(e,t)?Element.collectTextNodesIgnoreClass(e,t):""}).flatten().join("")},Element.setContentZoom=function(e,t){return(e=$(e)).setStyle({fontSize:t/100+"em"}),Prototype.Browser.WebKit&&window.scrollBy(0,0),e},Element.getInlineOpacity=function(e){return $(e).style.opacity||""},Element.forceRerendering=function(e){try{e=$(e);var t=document.createTextNode(" ");e.appendChild(t),e.removeChild(t)}catch(e){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},reverse:function(e){return 1-e},flicker:function(e){return 1<(e=-Math.cos(e*Math.PI)/4+.75+Math.random()/4)?1:e},wobble:function(e){return-Math.cos(e*Math.PI*(9*e))/2+.5},pulse:function(e,t){return 0==(e%(1/(t=t||5))*t).round()?e*t*2-(e*t*2).floor():1-(e*t*2-(e*t*2).floor())},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)},none:function(e){return 0},full:function(e){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(i){var n="position:relative";Prototype.Browser.IE&&(n+=";zoom:1"),i=$(i),$A(i.childNodes).each(function(t){3==t.nodeType&&(t.nodeValue.toArray().each(function(e){i.insertBefore(new Element("span",{style:n}).update(" "==e?String.fromCharCode(160):e),t)}),Element.remove(t))})},multiple:function(e,i){var t;t=("object"==typeof e||Object.isFunction(e))&&e.length?e:$(e).childNodes;var n=Object.extend({speed:.1,delay:0},arguments[2]||{}),o=n.delay;$A(t).each(function(e,t){new i(e,Object.extend(n,{delay:t*n.speed+o}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(e,t){e=$(e),t=(t||"appear").toLowerCase();var i=Object.extend({queue:{position:"end",scope:e.id||"global",limit:1}},arguments[2]||{});Effect[e.visible()?Effect.PAIRS[t][1]:Effect.PAIRS[t][0]](e,i)}};function quickFeedback(){new PopWindow({optEnabled:!0,left:0,top:0,width:500,title:"Feedback"}).appendNode(new Element("div").update("hello world"))}Effect.DefaultOptions.transition=Effect.Transitions.sinoidal,Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[],this.interval=null},_each:function(e){this.effects._each(e)},add:function(t){var e=(new Date).getTime();switch(Object.isString(t.options.queue)?t.options.queue:t.options.queue.position){case"front":this.effects.findAll(function(e){return"idle"==e.state}).each(function(e){e.startOn+=t.finishOn,e.finishOn+=t.finishOn});break;case"with-last":e=this.effects.pluck("startOn").max()||e;break;case"end":e=this.effects.pluck("finishOn").max()||e}t.startOn+=e,t.finishOn+=e,(!t.options.queue.limit||this.effects.length<t.options.queue.limit)&&this.effects.push(t),this.interval||(this.interval=setInterval(this.loop.bind(this),15))},remove:function(t){this.effects=this.effects.reject(function(e){return e==t}),0==this.effects.length&&(clearInterval(this.interval),this.interval=null)},loop:function(){for(var e=(new Date).getTime(),t=0,i=this.effects.length;t<i;t++)this.effects[t]&&this.effects[t].loop(e)}}),Effect.Queues={instances:$H(),get:function(e){return Object.isString(e)?this.instances.get(e)||this.instances.set(e,new Effect.ScopedQueue):e}},Effect.Queue=Effect.Queues.get("global"),Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(e,t){return(e[t+"Internal"]?"this.options."+t+"Internal(this);":"")+(e[t]?"this.options."+t+"(this);":"")}options&&!1===options.transition&&(options.transition=Effect.Transitions.linear),this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{}),this.currentFrame=0,this.state="idle",this.startOn=1e3*this.options.delay,this.finishOn=this.startOn+1e3*this.options.duration,this.fromToDelta=this.options.to-this.options.from,this.totalTime=this.finishOn-this.startOn,this.totalFrames=this.options.fps*this.options.duration,eval('this.render = function(pos){ if (this.state=="idle"){this.state="running";'+codeForEvent(this.options,"beforeSetup")+(this.setup?"this.setup();":"")+codeForEvent(this.options,"afterSetup")+'};if (this.state=="running"){pos=this.options.transition(pos)*'+this.fromToDelta+"+"+this.options.from+";this.position=pos;"+codeForEvent(this.options,"beforeUpdate")+(this.update?"this.update(pos);":"")+codeForEvent(this.options,"afterUpdate")+"}}"),this.event("beforeStart"),this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(e){if(e>=this.startOn){if(e>=this.finishOn)return this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),void this.event("afterFinish");var t=(e-this.startOn)/this.totalTime,i=(t*this.totalFrames).round();i>this.currentFrame&&(this.render(t),this.currentFrame=i)}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this),this.state="finished"},event:function(e){this.options[e+"Internal"]&&this.options[e+"Internal"](this),this.options[e]&&this.options[e](this)},inspect:function(){var e=$H();for(property in this)Object.isFunction(this[property])||e.set(property,this[property]);return"#<Effect:"+e.inspect()+",options:"+$H(this.options).inspect()+">"}}),Effect.Parallel=Class.create(Effect.Base,{initialize:function(e){this.effects=e||[],this.start(arguments[1])},update:function(e){this.effects.invoke("render",e)},finish:function(t){this.effects.each(function(e){e.render(1),e.cancel(),e.event("beforeFinish"),e.finish&&e.finish(t),e.event("afterFinish")})}}),Effect.Tween=Class.create(Effect.Base,{initialize:function(t,e,i){t=Object.isString(t)?$(t):t;var n=$A(arguments),o=n.last(),a=5==n.length?n[3]:null;this.method=Object.isFunction(o)?o.bind(t):Object.isFunction(t[o])?t[o].bind(t):function(e){t[o]=e},this.start(Object.extend({from:e,to:i},a||{}))},update:function(e){this.method(e)}}),Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction}),Effect.Opacity=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});var t=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(t)},update:function(e){this.element.setOpacity(e)}}),Effect.Move=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(t)},setup:function(){this.element.makePositioned(),this.originalLeft=parseFloat(this.element.getStyle("left")||"0"),this.originalTop=parseFloat(this.element.getStyle("top")||"0"),"absolute"==this.options.mode&&(this.options.x=this.options.x-this.originalLeft,this.options.y=this.options.y-this.originalTop)},update:function(e){this.element.setStyle({left:(this.options.x*e+this.originalLeft).round()+"px",top:(this.options.y*e+this.originalTop).round()+"px"})}}),Effect.MoveBy=function(e,t,i){return new Effect.Move(e,Object.extend({x:i,y:t},arguments[3]||{}))},Effect.Scale=Class.create(Effect.Base,{initialize:function(e,t){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var i=Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:t},arguments[2]||{});this.start(i)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1,this.elementPositioning=this.element.getStyle("position"),this.originalStyle={},["top","left","width","height","fontSize"].each(function(e){this.originalStyle[e]=this.element.style[e]}.bind(this)),this.originalTop=this.element.offsetTop,this.originalLeft=this.element.offsetLeft;var t=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(e){0<t.indexOf(e)&&(this.fontSize=parseFloat(t),this.fontSizeType=e)}.bind(this)),this.factor=(this.options.scaleTo-this.options.scaleFrom)/100,this.dims=null,"box"==this.options.scaleMode&&(this.dims=[this.element.offsetHeight,this.element.offsetWidth]),/^content/.test(this.options.scaleMode)&&(this.dims=[this.element.scrollHeight,this.element.scrollWidth]),this.dims||(this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth])},update:function(e){var t=this.options.scaleFrom/100+this.factor*e;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*t+this.fontSizeType}),this.setDimensions(this.dims[0]*t,this.dims[1]*t)},finish:function(e){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(e,t){var i={};if(this.options.scaleX&&(i.width=t.round()+"px"),this.options.scaleY&&(i.height=e.round()+"px"),this.options.scaleFromCenter){var n=(e-this.dims[0])/2,o=(t-this.dims[1])/2;"absolute"==this.elementPositioning?(this.options.scaleY&&(i.top=this.originalTop-n+"px"),this.options.scaleX&&(i.left=this.originalLeft-o+"px")):(this.options.scaleY&&(i.top=-n+"px"),this.options.scaleX&&(i.left=-o+"px"))}this.element.setStyle(i)}}),Effect.Highlight=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(t)},setup:function(){"none"!=this.element.getStyle("display")?(this.oldStyle={},this.options.keepBackgroundImage||(this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"})),this.options.endcolor||(this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")),this.options.restorecolor||(this.options.restorecolor=this.element.getStyle("background-color")),this._base=$R(0,2).map(function(e){return parseInt(this.options.startcolor.slice(2*e+1,2*e+3),16)}.bind(this)),this._delta=$R(0,2).map(function(e){return parseInt(this.options.endcolor.slice(2*e+1,2*e+3),16)-this._base[e]}.bind(this))):this.cancel()},update:function(n){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(e,t,i){return e+(this._base[i]+this._delta[i]*n).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}}),Effect.ScrollTo=function(e){var t=arguments[1]||{},i=document.viewport.getScrollOffsets(),n=$(e).cumulativeOffset(),o=(window.height||document.body.scrollHeight)-document.viewport.getHeight();return t.offset&&(n[1]+=t.offset),new Effect.Tween(null,i.top,n[1]>o?o:n[1],t,function(e){scrollTo(i.left,e.round())})},Effect.Fade=function(e){var t=(e=$(e)).getInlineOpacity(),i=Object.extend({from:e.getOpacity()||1,to:0,afterFinishInternal:function(e){0==e.options.to&&e.element.hide().setStyle({opacity:t})}},arguments[1]||{});return new Effect.Opacity(e,i)},Effect.Appear=function(e){e=$(e);var t=Object.extend({from:"none"==e.getStyle("display")?0:e.getOpacity()||0,to:1,afterFinishInternal:function(e){e.element.forceRerendering()},beforeSetup:function(e){e.element.setOpacity(e.options.from).show()}},arguments[1]||{});return new Effect.Opacity(e,t)},Effect.Puff=function(e){var t={opacity:(e=$(e)).getInlineOpacity(),position:e.getStyle("position"),top:e.style.top,left:e.style.left,width:e.style.width,height:e.style.height};return new Effect.Parallel([new Effect.Scale(e,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(e){Position.absolutize(e.effects[0].element)},afterFinishInternal:function(e){e.effects[0].element.hide().setStyle(t)}},arguments[1]||{}))},Effect.BlindUp=function(e){return(e=$(e)).makeClipping(),new Effect.Scale(e,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(e){e.element.hide().undoClipping()}},arguments[1]||{}))},Effect.BlindDown=function(e){var t=(e=$(e)).getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:t.height,originalWidth:t.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.element.undoClipping()}},arguments[1]||{}))},Effect.SwitchOff=function(e){var t=(e=$(e)).getInlineOpacity();return new Effect.Appear(e,Object.extend({duration:.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(e){new Effect.Scale(e.element,1,{duration:.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(e){e.element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned().setStyle({opacity:t})}})}},arguments[1]||{}))},Effect.DropOut=function(e){var t={top:(e=$(e)).getStyle("top"),left:e.getStyle("left"),opacity:e.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(e,{x:0,y:100,sync:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:.5,beforeSetup:function(e){e.effects[0].element.makePositioned()},afterFinishInternal:function(e){e.effects[0].element.hide().undoPositioned().setStyle(t)}},arguments[1]||{}))},Effect.Shake=function(e){e=$(e);var t=Object.extend({distance:20,duration:.5},arguments[1]||{}),i=parseFloat(t.distance),n=parseFloat(t.duration)/10,o={top:e.getStyle("top"),left:e.getStyle("left")};return new Effect.Move(e,{x:i,y:0,duration:n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*-i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*-i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:-i,y:0,duration:n,afterFinishInternal:function(e){e.element.undoPositioned().setStyle(o)}})}})}})}})}})}})},Effect.SlideDown=function(e){var t=(e=$(e).cleanWhitespace()).down().getStyle("bottom"),i=e.getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:i.height,originalWidth:i.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.SlideUp=function(e){var t=(e=$(e).cleanWhitespace()).down().getStyle("bottom"),i=e.getDimensions();return new Effect.Scale(e,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:i.height,originalWidth:i.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.Squish=function(e){return new Effect.Scale(e,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(e){e.element.makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping()}})},Effect.Grow=function(e){e=$(e);var t,i,n,o,a=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{}),s={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},r=e.getDimensions();switch(a.direction){case"top-left":t=i=n=o=0;break;case"top-right":t=r.width,i=o=0,n=-r.width;break;case"bottom-left":t=n=0,i=r.height,o=-r.height;break;case"bottom-right":t=r.width,i=r.height,n=-r.width,o=-r.height;break;case"center":t=r.width/2,i=r.height/2,n=-r.width/2,o=-r.height/2}return new Effect.Move(e,{x:t,y:i,duration:.01,beforeSetup:function(e){e.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(e){new Effect.Parallel([new Effect.Opacity(e.element,{sync:!0,to:1,from:0,transition:a.opacityTransition}),new Effect.Move(e.element,{x:n,y:o,sync:!0,transition:a.moveTransition}),new Effect.Scale(e.element,100,{scaleMode:{originalHeight:r.height,originalWidth:r.width},sync:!0,scaleFrom:window.opera?1:0,transition:a.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(e){e.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.effects[0].element.undoClipping().undoPositioned().setStyle(s)}},a))}})},Effect.Shrink=function(e){e=$(e);var t,i,n=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{}),o={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},a=e.getDimensions();switch(n.direction){case"top-left":t=i=0;break;case"top-right":t=a.width,i=0;break;case"bottom-left":t=0,i=a.height;break;case"bottom-right":t=a.width,i=a.height;break;case"center":t=a.width/2,i=a.height/2}return new Effect.Parallel([new Effect.Opacity(e,{sync:!0,to:0,from:1,transition:n.opacityTransition}),new Effect.Scale(e,window.opera?1:0,{sync:!0,transition:n.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(e,{x:t,y:i,sync:!0,transition:n.moveTransition})],Object.extend({beforeStartInternal:function(e){e.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.effects[0].element.hide().undoClipping().undoPositioned().setStyle(o)}},n))},Effect.Pulsate=function(e){e=$(e);function t(e){return o(1-Effect.Transitions.pulse(e,i.pulses))}var i=arguments[1]||{},n=e.getInlineOpacity(),o=i.transition||Effect.Transitions.sinoidal;return t.bind(o),new Effect.Opacity(e,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(e){e.element.setStyle({opacity:n})}},i),{transition:t}))},Effect.Fold=function(t){var i={top:(t=$(t)).style.top,left:t.style.left,width:t.style.width,height:t.style.height};return t.makeClipping(),new Effect.Scale(t,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(e){new Effect.Scale(t,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(e){e.element.hide().undoClipping().setStyle(i)}})}},arguments[1]||{}))},Effect.Morph=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({style:{}},arguments[1]||{});if(Object.isString(t.style))if(t.style.include(":"))this.style=t.style.parseStyle();else{this.element.addClassName(t.style),this.style=$H(this.element.getStyles()),this.element.removeClassName(t.style);var i=this.element.getStyles();this.style=this.style.reject(function(e){return e.value==i[e.key]}),t.afterFinishInternal=function(t){t.element.addClassName(t.options.style),t.transforms.each(function(e){t.element.style[e.style]=""})}}else this.style=$H(t.style);this.start(t)},setup:function(){function s(t){return t&&!["rgba(0, 0, 0, 0)","transparent"].include(t)||(t="#ffffff"),t=t.parseColor(),$R(0,2).map(function(e){return parseInt(t.slice(2*e+1,2*e+3),16)})}this.transforms=this.style.map(function(e){var t=e[0],i=e[1],n=null;if("#zzzzzz"!=i.parseColor("#zzzzzz"))i=i.parseColor(),n="color";else if("opacity"==t)i=parseFloat(i),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});else if(Element.CSS_LENGTH.test(i)){var o=i.match(/^([\+\-]?[0-9\.]+)(.*)$/);i=parseFloat(o[1]),n=3==o.length?o[2]:null}var a=this.element.getStyle(t);return{style:t.camelize(),originalValue:"color"==n?s(a):parseFloat(a||0),targetValue:"color"==n?s(i):i,unit:n}}.bind(this)).reject(function(e){return e.originalValue==e.targetValue||"color"!=e.unit&&(isNaN(e.originalValue)||isNaN(e.targetValue))})},update:function(e){for(var t,i={},n=this.transforms.length;n--;)i[(t=this.transforms[n]).style]="color"==t.unit?"#"+Math.round(t.originalValue[0]+(t.targetValue[0]-t.originalValue[0])*e).toColorPart()+Math.round(t.originalValue[1]+(t.targetValue[1]-t.originalValue[1])*e).toColorPart()+Math.round(t.originalValue[2]+(t.targetValue[2]-t.originalValue[2])*e).toColorPart():(t.originalValue+(t.targetValue-t.originalValue)*e).toFixed(3)+(null===t.unit?"":t.unit);this.element.setStyle(i,!0)}}),Effect.Transform=Class.create({initialize:function(e){this.tracks=[],this.options=arguments[1]||{},this.addTracks(e)},addTracks:function(e){return e.each(function(e){var t=(e=$H(e)).values().first();this.tracks.push($H({ids:e.keys().first(),effect:Effect.Morph,options:{style:t}}))}.bind(this)),this},play:function(){return new Effect.Parallel(this.tracks.map(function(e){var t=e.get("ids"),i=e.get("effect"),n=e.get("options");return[$(t)||$$(t)].flatten().map(function(e){return new i(e,Object.extend({sync:!0},n))})}).flatten(),this.options)}}),Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex"),Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/,String.__parseStyleElement=document.createElement("div"),String.prototype.parseStyle=function(){var t,i=$H();return t=Prototype.Browser.WebKit?new Element("div",{style:this}).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',String.__parseStyleElement.childNodes[0].style),Element.CSS_PROPERTIES.each(function(e){t[e]&&i.set(e,t[e])}),Prototype.Browser.IE&&this.include("opacity")&&i.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]),i},document.defaultView&&document.defaultView.getComputedStyle?Element.getStyles=function(e){var i=document.defaultView.getComputedStyle($(e),null);return Element.CSS_PROPERTIES.inject({},function(e,t){return e[t]=i[t],e})}:Element.getStyles=function(e){var t,i=(e=$(e)).currentStyle;return(t=Element.CSS_PROPERTIES.inject({},function(e,t){return e.set(t,i[t]),e})).opacity||t.set("opacity",e.getOpacity()),t},Effect.Methods={morph:function(e,t){return e=$(e),new Effect.Morph(e,Object.extend({style:t},arguments[2]||{})),e},visualEffect:function(e,t,i){e=$(e);var n=t.dasherize().camelize(),o=n.charAt(0).toUpperCase()+n.substring(1);return new Effect[o](e,i),e},highlight:function(e,t){return e=$(e),new Effect.Highlight(e,t),e}},$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(i){Effect.Methods[i]=function(e,t){return e=$(e),Effect[i.charAt(0).toUpperCase()+i.substring(1)](e,t),e}}),$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(e){Effect.Methods[e]=Element[e]}),Element.addMethods(Effect.Methods);var CentralNotice={show:function(e){e=e||"Processing...",CentralNotice.update(e)},hide:function(){CentralNotice.getEl().hide()},update:function(e){var t=CentralNotice.getEl();t.down().down().update(e);var i=document.body.offsetWidth/2-t.getWidth()/2;t.show(),t.setStyle({left:i+"px",top:0})},getEl:function(){var e=$("centralNotice");return e||((e=new Element("div",{id:"centralNotice"})).innerHTML="<div class='inner'><div class='content'></div></div>",document.body.appendChild(e)),e}};function showCentralNoticer(e,t){void 0===t&&(t="centralNoticer"),void 0===e&&(e="Processing...");var i=$(t+"_box"),n=$(t+"_content");i||((i=document.createElement("div")).className="centralNoticerBox",i.id=t+"_box",(n=document.createElement("div")).id=t+"_content",n.className="centralNoticerContent",i.appendChild(n),document.body.appendChild(i)),n.innerHTML=e;var o=document.body.offsetWidth/2-$(t+"_box").getWidth()/2;i.show(),i.setStyle({left:o+"px",top:0})}function updateCentralNoticer(e,t){void 0===t&&(t="centralNoticer"),$(t+"_content").innerHTML=e}function hideCentralNoticer(e){"undefined"==typeof noticerID&&(noticerID="centralNoticer"),void 0===e&&(e=1),e*=1e3,$(noticerID+"_box").style.display="none"}var BrowserVersion={IE:!(!window.attachEvent||window.opera),Opera:!!window.opera,WebKit:-1<navigator.userAgent.indexOf("AppleWebKit/"),Gecko:-1<navigator.userAgent.indexOf("Gecko")&&-1==navigator.userAgent.indexOf("KHTML"),MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),getIEVersion:function(){var e=null;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e},isIE6:function(){return BrowserVersion.getIEVersion()&&BrowserVersion.getIEVersion()<=6},supportFlash:function(){var e=!1;if(BrowserVersion.IE){var t=null;try{(t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))&&(version=t.GetVariable("$version").substring(4),version=version.split(","),e=parseFloat(version[0]+"."+version[1]))}catch(e){}}else if(navigator.mimeTypes["application/futuresplash"]&&navigator.plugins&&navigator.plugins.length)for(x=0;x<navigator.plugins.length;x++)if(-1!=navigator.plugins[x].name.indexOf("Shockwave Flash")){e=navigator.plugins[x].description.split("Shockwave Flash ")[1];break}return e}},PopWindow=Class.create({initialize:function(e){PopWindow.instance&&PopWindow.instance.hide(),$("diigoPopWindow")&&$("diigoPopWindow").remove(),(PopWindow.instance=this).selectX=0,this.selectY=0,this.offsetX=e.left||0,this.offsetY=e.top||0,this.width=e.width||400;var t=e.title.blank()?"&nbsp;":e.title;this.root=e.root||document,this.optEnabled=e.optEnabled||!1,this.center=e.center||!1,this.fixTop=e.fixTop||0,this.overflow=e.overflow||!1,this.dragEnabled=!1,"string"!=typeof this.root||this.root.blank()||(this.root=$(this.root)),this.window=new Element("div",{id:"diigoPopWindow"});var i=new Element("div",{id:"diigoPopWindowInner"});this.title=new Element("div",{id:"wTop"}),this.closeLink=new Element("a",{id:"wCloseLink",href:"javascript:void(0);",title:"Close Window"}),this.closeLink.innerHTML="<img src='/images/popWindowClose.png' alt='close' />",this.closeLink.onclick=PopWindow.instance.doCancel.bind(this),this.title.appendChild(this.closeLink),this.titleName=new Element("h3",{id:"wTitle"}).update(t),this.title.appendChild(this.titleName),i.appendChild(this.title),this.content=new Element("div",{id:"wContent"}),i.appendChild(this.content),this.noticer=new Element("div",{id:"wNoticer"}).hide(),i.appendChild(this.noticer),this.optEnabled&&(this.submitBtn=new Element("input",{type:"button",id:"wSubmit",value:"Submit"}),this.submitBtn.onclick=PopWindow.instance.doSubmit.bind(this),this.cancelBtn=new Element("input",{type:"button",id:"wCancel",value:"Cancel"}),this.cancelBtn.onclick=PopWindow.instance.doCancel.bind(this),this.opt=new Element("div",{id:"wOptions"}),this.opt.appendChild(this.cancelBtn),this.opt.appendChild(this.submitBtn),i.appendChild(this.opt)),this.window.appendChild(i);var n=0,o=0;if(this.root!=document){var a=Position.cumulativeOffset(this.root);n=a[0],o=a[1]}if(this.center&&(n=(Element.getDimensions(document.body).width-this.width)/2,o=(document.body.scrollTop||document.documentElement.scrollTop)+100+this.fixTop),this.overflow){var s=Element.getDimensions(document.body).height-2*(100+this.fixTop)-14-50;this.content.setStyle({maxHeight:s+"px",overflowY:"auto"})}this.window.setStyle({left:fixLeft(n+this.offsetX,this.width+15)+"px",top:fixTop(o+this.offsetY,this.window.getHeight()+15)+"px",zIndex:10009,width:this.width+"px"}),document.body.appendChild(this.window),PopWindow.shadow||(PopWindow.shadow=new Element("div",{id:"popWindowShadow"}),PopWindow.hideIframe=new Element("iframe",{id:"popWindowHideIframe",width:"100%",height:"100%"}),PopWindow.shadow.appendChild(PopWindow.hideIframe),PopWindow.hideIframe.setAttribute("frameBorder","0"),PopWindow.hideIframe.setAttribute("marginheight","0"),PopWindow.hideIframe.setAttribute("marginwidth","0"),PopWindow.hideIframe.setAttribute("scrolling","no"),document.body.appendChild(PopWindow.shadow)),PopWindow.shadow.setStyle({left:fixLeft(n+this.offsetX,this.width+15)+"px",top:fixTop(o+this.offsetY,this.window.getHeight()+15)+"px",zIndex:10008,width:this.width+10+"px",height:this.window.getHeight()+"px"}),PopWindow.shadow.show(),(!BrowserVersion.IE||8<=BrowserVersion.getIEVersion())&&(document.onmousedown=this.selectmouse.bind(this),document.onmouseup=function(){this.dragEnabled=!1}.bind(this),$("wTitle").setStyle({cursor:"move"}))},movemouse:function(e){if(this.dragEnabled){var t=BrowserVersion.IE?this.offsetX+event.clientX-this.selectX:this.offsetX+e.clientX-this.selectX,i=BrowserVersion.IE?this.offsetY+event.clientY-this.selectY:this.offsetY+e.clientY-this.selectY;t<=0&&(t=0),i<=0&&(i=0);var n=document.getElementById("wrapper");if(n)var o=Element.getDimensions(n);else o=Element.getDimensions(document.body);return t+this.window.getWidth()>=o.width&&(t=o.width-this.window.getWidth()),i+this.window.getHeight()>=o.height&&(i=o.height-this.window.getHeight()),this.window.setStyle({left:t+"px",top:i+"px"}),PopWindow.shadow.setStyle({left:t+"px",top:i+"px"}),!1}},selectmouse:function(e){if("wTitle"==(BrowserVersion.IE?event.srcElement:e.target).id){this.dragEnabled=!0;var t=Position.cumulativeOffset(this.window);return this.offsetX=t[0],this.offsetY=t[1],this.selectX=BrowserVersion.IE?event.clientX:e.clientX,this.selectY=BrowserVersion.IE?event.clientY:e.clientY,document.onmousemove=this.movemouse.bind(this),!1}},show:function(e){void 0!==e&&(this.offsetX=e.left||this.offsetX,this.offsetY=e.top||this.offsetY,this.root=e.root||this.root,"string"!=typeof this.root||this.root.blank()||(this.root=$(this.root)));var t=0,i=0;if(this.root!=document){var n=this.root.cumulativeOffset();t=n[0],i=n[1]}this.window.setStyle({left:fixLeft(t+this.offsetX,this.width+15)+"px",top:fixTop(i+this.offsetY,this.window.getHeight()+15)+"px",zIndex:999,width:this.width+"px"}),this.window.show(),PopWindow.shadow.setStyle({left:fixLeft(t+this.offsetX,this.width+15)+"px",top:fixTop(i+this.offsetY,this.window.getHeight()+15)+"px",zIndex:998,width:this.width+10+"px",height:this.window.getHeight()+"px"}),PopWindow.shadow.show(),this.content.show(),this.noticer.hide(),this.title.show(),this.closeLink.show(),this.optEnabled&&this.opt.show()},hide:function(){this.window.hide(),PopWindow.shadow.hide()},updateContent:function(e){this.content.innerHTML=e,this.reCalShadowRange()},appendNode:function(e){e&&(this.content.appendChild(e),this.reCalShadowRange())},doSubmit:function(){this.submit()},doCancel:function(){this.hide();try{this.cancel()}catch(e){}},reCalShadowRange:function(){PopWindow.shadow.setStyle({height:this.window.getHeight()+"px"})},onLoading:function(e){e=e||"processing...",this.noticer.innerHTML=e,this.noticer.className="wLoading",this.noticer.show(),this.content.hide(),this.opt.hide(),this.reCalShadowRange()},onComplete:function(e){"200"==e.status?(this.noticer.className="wSuccess",msg=e.msg||"done!",this.noticer.innerHTML=msg,PopWindow.instance.hide()):(this.noticer.className="wFailed",msg=e.msg||"failed!",this.noticer.innerHTML=msg,this.noticer.show(),this.opt.hide(),this.content.hide(),setTimeout("PopWindow.instance.hide()",5e3))}}),AvatarPopup=Class.create({initialize:function(e){(e=e||{}).scope||(e.scope="main"),e.togglerClass||(e.togglerClass="avatarPopup");null==_GLOBAL_VAR.AvatarUserInfos&&(_GLOBAL_VAR.AvatarUserInfos={}),$(e.scope).select("."+e.togglerClass).each(function(t){t.down().onmouseover=function(){clearTimeout(AvatarPopup.timeout),t.title="",t.down().alt="";var e=t.down().src.split("/").last().replace(/_\d+\.jpg/,"");AvatarPopup.currentUser=e,AvatarPopup.timeout=setTimeout(AvatarPopup.loadUserInfos.bind(t,e),500)},t.down().onmouseout=function(){clearTimeout(AvatarPopup.timeout),AvatarPopup.currentUser=null,AvatarPopup.timeout=setTimeout(AvatarPopup.hideWindow,500),AvatarPopup.hideLoading()}})}});AvatarPopup.currentLoading=null,AvatarPopup.currentUser=null,AvatarPopup.timeout=null,AvatarPopup.currentFollowUser=null,AvatarPopup.getLoadingEl=function(){var e="avatarPopupLoading",t=$(e);return t||(t=new Element("div",{id:e}),document.body.appendChild(t)),t},AvatarPopup.showLoading=function(e){var t=AvatarPopup.getLoadingEl(),i=e.cumulativeOffset();t.show(),t.setStyle({left:i[0]+e.getWidth()+"px",top:i[1]+e.getHeight()+"px"})},AvatarPopup.hideLoading=function(){AvatarPopup.getLoadingEl().hide()},AvatarPopup.loadUserInfos=function(){var i=this,e=$A(arguments)[0];if(_GLOBAL_VAR.AvatarUserInfos[e])AvatarPopup.showWindow(_GLOBAL_VAR.AvatarUserInfos[e],i);else if(AvatarPopup.currentLoading==e)AvatarPopup.showLoading(i);else{AvatarPopup.showLoading(i),AvatarPopup.currentLoading=e;var t=BOOKMARK_HOST+"/user_mana2/load_avatar_popup_infos?username="+e;if(AvatarPopup.scenes.inGroup||AvatarPopup.scenes.inMessage)return CrossSubDomainAjax.baseDomain=BOOKMARK_HOST.replace(/.*\.diigo\./,"diigo."),CrossSubDomainAjax.request(t,{asynchronous:!0,evalScripts:!1,onComplete:function(e){if("200"==e.status){var t=e.responseText.evalJSON();_GLOBAL_VAR.AvatarUserInfos[t.username]=t,AvatarPopup.currentLoading=null,AvatarPopup.hideLoading(),AvatarPopup.showWindow(t,i)}}}),!1;new Ajax.Request(t,{method:"post",onSuccess:function(e){var t=e.responseText.evalJSON();_GLOBAL_VAR.AvatarUserInfos[t.username]=t,AvatarPopup.currentLoading=null,AvatarPopup.hideLoading(),AvatarPopup.showWindow(t,i)}})}},AvatarPopup.getWindowEl=function(){var e="avatarPopupWindow",t=$(e);return t||(t=new Element("div",{id:e}),document.body.appendChild(t)),t},AvatarPopup.scenes={inGroup:new RegExp(GROUP_HOST).test(self.location.href),inMessage:new RegExp("undefined"!=typeof DMS_HOST?DMS_HOST:MESSAGE_HOST).test(self.location.href),inIndividualGroup:new RegExp(GROUP_HOST+"/group/.+").test(self.location.href)},AvatarPopup.template={getWindowTemp:function(){var e="<div class='top'></div><div class='content'><div class='inner clearfix'><div class='navi clearfix'>";if(AvatarPopup.scenes.inIndividualGroup){var t=self.location.href.match(/\/group\/([\d\-\w]+)/).last();e+="<a class='promptNaviLink' href='"+GROUP_HOST+"/group/"+t+"/content/user/_USERNAME_' title='View _REALNAME_&#39;s content in group'>View _REALNAME_'s content in group</a>"}else AvatarPopup.scenes.inMessage?e+="<a class='promptNaviLink' href='"+DMS_HOST+"/user/_CAP_USERNAME_' title='View _REALNAME_&#39;s EasyBlog'>View _REALNAME_'s EasyBlog</a>":e+="<a class='promptNaviLink' href='"+BOOKMARK_HOST+"/profile/_USERNAME_' title='View _REALNAME_&#39;s profile'>View _REALNAME_'s profile</a>";return e+="<div class='moreNavi'><ul><li class='contextMenu'><a href='javascript:void(0);'>more<b>&#9660;</b></a><ul class='subMenu' style='display:none;width:120px;'>",(AvatarPopup.scenes.inIndividualGroup||AvatarPopup.scenes.inMessage)&&(e+="<li><a href='"+BOOKMARK_HOST+"/profile/_USERNAME_'>Profile</a></li>"),e+="<li><a href='"+BOOKMARK_HOST+"/user/_USERNAME_'>Library</a></li><li><a href='"+BOOKMARK_HOST+"/network/_USERNAME_'>Network</a></li><li><a href='"+BOOKMARK_HOST+"/friends/_USERNAME_'>Friends</a></li><li><a href='"+GROUP_HOST+"/user/_USERNAME_'>Groups</a></li><li><a href='"+BOOKMARK_HOST+"/list/_USERNAME_'>Lists</a></li><li><a href='"+BOOKMARK_HOST+"/cloud/_USERNAME_'>Tags</a></li></ul></li></ul></div></div><div class='leftPart'><div class='avatarFrame'><img src='"+RESOURCE_HOST+"/images/avatar/user/_USERNAME__96.jpg' /></div>_FOLLOW_ME_BUTTON_</div>\x3c!--leftPart--\x3e<div class='rightPart'><div class='realname'><b class='_ONLINE_STATUS_' title='_ONLINE_TITLE_'></b>_REALNAME_<span class='accountInfo'>_ACCOUNT_INFO_</span></div><div class='aboutme'>_ABOUTME_</div></div></div></div><div class='bottom'></div>"}},AvatarPopup.hideContextMenu=function(e){ContextMenu.clearTimeHandler(),ContextMenu.hideTimeOut=setTimeout(ContextMenu.hideContextMenu,e)},AvatarPopup.showWindow=function(e,t){if(AvatarPopup.currentUser!=e.username)return!1;var i=AvatarPopup.getWindowEl(),n=AvatarPopup.template.getWindowTemp().replace(/_REALNAME_/g,e.realname);n=(n=(n=(n=(n=(n=(n=n.replace(/_ABOUTME_/g,e.aboutme)).replace(/_CAP_USERNAME_/g,e.username.capitalize())).replace(/_USERNAME_/g,e.username)).replace(/_ONLINE_STATUS_/g,e.online_status)).replace(/_ONLINE_TITLE_/g,"on"==e.online_status?"Online":"Offline")).replace(/_ACCOUNT_INFO_/g,"yes"==e.is_premium?'<a title="Find out about upgrading to premium" href="'+BOOKMARK_HOST+'/premium"><img style="vertical-align: text-bottom;" src="/front-end-utils/images/icon-account-premium.png" alt="Premium Account" /></a>':"")).replace(/_FOLLOW_ME_BUTTON_/,"");var o=t.cumulativeOffset();i.update(n),i.show(),i.setStyle({left:fixLeft(o[0]+t.getWidth()/3,i.getWidth())+"px",top:fixTop(o[1]+t.getHeight()+2,i.getHeight())+"px"}),new ContextMenu(i.id,{eventType:"mouseover"}),i.select(".contextMenu")[0].onmouseout=function(){AvatarPopup.hideContextMenu(500)};var a=i.select(".subMenu")[0];a.setStyle({zIndex:10008}),a.onmouseover=function(){clearTimeout(AvatarPopup.timeout)},a.onmouseout=function(){AvatarPopup.timeout=setTimeout(AvatarPopup.hideWindow,1e3)},i.onmouseover=function(){clearTimeout(AvatarPopup.timeout)},i.onmouseout=function(){AvatarPopup.timeout=setTimeout(AvatarPopup.hideWindow,1e3)}},AvatarPopup.hideWindow=function(){var e=AvatarPopup.getWindowEl();e.update(""),e.hide()},AvatarPopup.hide=function(){AvatarPopup.hideWindow(),AvatarPopup.hideLoading()},AvatarPopup.followCallback=function(e,t){200==e&&(_GLOBAL_VAR.AvatarUserInfos[AvatarPopup.currentFollowUser].follow_status=t)};var DiigoToolTip=Class.create({initialize:function(e){(e=e||{}).scope||(e.scope="main"),e.togglerClass||(e.togglerClass="diigoToolTip");$(e.scope).select("."+e.togglerClass).each(function(e){e.onmouseover=function(){clearTimeout(DiigoToolTip.timeout),_GLOBAL_VAR.DiigoToolTip=e.title,e.title="",DiigoToolTip.timeout=setTimeout(DiigoToolTip.showWindow.bind(e),500)},e.onmouseout=function(){clearTimeout(DiigoToolTip.timeout),_GLOBAL_VAR.DiigoToolTip&&(e.title=_GLOBAL_VAR.DiigoToolTip,_GLOBAL_VAR.DiigoToolTip=""),DiigoToolTip.timeout=setTimeout(DiigoToolTip.hideWindow,500)}})}});function removePromotions(e,t){var i,n=Position.cumulativeOffset(e);(i=new PopWindow({optEnabled:!0,left:n[0]-250,top:n[1],width:500,title:"Remove Ads",root:Element.up(this)})).appendNode(createRemovePromotionsTemp()),i.cancel=function(){resetMoreAction(),resetAllChecker()},i.submitBtn.value="Upgrade to Diigo Premium!",i.cancelBtn.value="No, Thanks",i.submit=function(){return self.location=t,!1}}function createRemovePromotionsTemp(){var e=new Element("div",{className:"removePromotionsContent"});return e.update('Upgrade to diigo premium to remove ads. Diigo premium account also enable you to use some other advanced features. <a href="'+BOOKMARK_HOST+'/premium">Learn More &raquo;</a> '),e}function enableFeature(e,t){var i,n=Position.cumulativeOffset(e),o=t.title||"";(i=new PopWindow({optEnabled:!0,left:n[0]-250,top:n[1],width:500,title:o,root:Element.up(this)})).appendNode(createEnableFeatureTemp(t.content)),i.cancel=function(){resetMoreAction(),resetAllChecker()},i.submitBtn.value=t.submitValue||"Upgrade to Diigo Premium!",i.cancelBtn.value=t.cancelValue||"No, Thanks",i.submit=function(){return self.location=t.premiumURL||BOOKMARK_HOST+"/premium",!1}}function createEnableFeatureTemp(e){var t=new Element("div",{className:"removePromotionsContent"});return t.update(e||""),t}DiigoToolTip.timeout=null,DiigoToolTip.getWindowEl=function(){var e="diigoToolTipWindow",t=$(e);return t||(t=new Element("div",{id:e}),document.body.appendChild(t)),t},DiigoToolTip.template={getWindowTemp:function(){return"<div class='top'></div><div class='content'><div class='inner clearfix'>_DIIGO_TOOL_TIP_CONTENT_</div></div><div class='bottom'></div>"}},DiigoToolTip.hideContextMenu=function(e){ContextMenu.clearTimeHandler(),ContextMenu.hideTimeOut=setTimeout(ContextMenu.hideContextMenu,e)},DiigoToolTip.showWindow=function(){var e=_GLOBAL_VAR.DiigoToolTip,t=DiigoToolTip.getWindowEl(),i=DiigoToolTip.template.getWindowTemp().replace(/_DIIGO_TOOL_TIP_CONTENT_/,e),n=this.cumulativeOffset();t.update(i),t.show(),t.setStyle({left:fixLeft(n[0]+this.getWidth()/3,t.getWidth())+"px",top:fixTop(n[1]+this.getHeight()+2,t.getHeight())+"px"}),t.onmouseover=function(){clearTimeout(DiigoToolTip.timeout)},t.onmouseout=function(){DiigoToolTip.timeout=setTimeout(DiigoToolTip.hideWindow,500)}},DiigoToolTip.hideWindow=function(){var e=DiigoToolTip.getWindowEl();e.update(""),e.hide()},DiigoToolTip.hide=function(){DiigoToolTip.hideWindow(),DiigoToolTip.hideLoading()};var ACContact=Class.create({initialize:function(e){if(e.maxRec&&(this.maxRec=e.maxRec,this.maxRecTipTemp="MAX Recipients "+this.maxRec),this.scanType=e.scanType||"all",this.maxHeight=e.maxHeight||200,this.width=e.width||414,this.recItemsId=[],this.tipTemp=e.tipTemp||"Search your friends on diigo...",this.recBox=e.rec,this.recBox.setStyle({font:"12px verdana",padding:"1px 0 1px 2px",width:this.width+"px"}),!this.recInput){this.recInput=new Element("input",{className:"recInput",id:"myInput",maxlength:255}),this.recBox.appendChild(this.recInput),this.recInputSizer=new Element("div",{className:"recInputSizer"}),this.recBox.appendChild(this.recInputSizer);var t=new Element("div");t.setStyle({clear:"both"}),this.recBox.appendChild(t)}if(ACContact.contacts||(ACContact.contacts=e.contacts),!ACContact.contactLists){ACContact.contactListsID=[];for(var i=0;i<ACContact.contacts.length;i++)"list"==ACContact.contacts[i].type&&ACContact.contactListsID.push(i)}this.tip||(this.tip=new Element("div").hide(),this.tip.setStyle({width:this.width-2+"px"}),this.recBox.up().appendChild(this.tip)),this.contactList||(this.contactList=new Element("div",{className:"accList"}).hide(),this.contactList.setStyle({width:this.width-2+"px"}),this.contactListInner=new Element("div").setStyle({position:"relative",overflow:"auto",padding:"2px"}),this.contactList.appendChild(this.contactListInner),this.recBox.up().appendChild(this.contactList)),this.recBox.onclick=function(){this.recInput.setStyle({visibility:"visible"}),this.recInput.focus()}.bind(this),this.recBox.reset=function(){this.recInput.onblur(),this.recBox.select(".recItem").each(function(e){e.remove()}),this.recItemsId.clear()}.bind(this),this.recInput.onfocus=function(){this.showTip(),this.recInput.reset(),this.currentItem=-1}.bind(this),this.recInput.reset=function(){this.recInput.value="";var e=ACContact.getTextSize(this.recInput.value,this.recInputSizer);this.recInput.setStyle({width:e+30+"px",visibility:"visible"})}.bind(this),this.recInput.onblur=function(){this.wrapItem(),this.hideTip(),setTimeout(function(){this.hideContacts()}.bind(this),300)}.bind(this),this.recInput.onkeydown=function(e){var t;switch(window.event?t=window.event.keyCode:e&&(t=e.which),t){case 9:case 40:return this.hoverItem(this.currentItem+1),!1;case 38:return this.hoverItem(this.currentItem-1),!1;case 8:if(""==this.recInput.value&&this.recInput.previous()){var i=this.recInput.previous().getAttribute("cIndex");$("recItemRemove_"+i).onclick()}break;case 13:return this.wrapItem(),this.recInput.reset(),this.hideContacts(),this.showTip(),!1;case 32:if(!this.recInput.value.blank())return this.wrapItem(),this.recInput.reset(),this.hideContacts(),this.showTip(),!1}var n=ACContact.getTextSize(this.recInput.value,this.recInputSizer);n>this.recBox.getWidth()-50&&(n=this.recBox.getWidth()-50),this.recInput.setStyle({width:n+30+"px"})}.bind(this),this.recInput.onkeyup=function(e){var t;window.event?t=window.event.keyCode:e&&(t=e.which),(t<=105&&48<=t||8==t)&&this.scanContacts()}.bind(this),this.tip_in_box=new Element("span",{className:"emptyTip"}),this.tip_in_box.setStyle({position:"absolute",marginTop:"2px",marginLeft:"5px",color:"#999"}),this.tip_in_box.update(this.tipTemp),this.tip_in_box.onclick=this.recBox.onclick,Insertion.Before(this.recBox,this.tip_in_box),0==e.showTipInBox&&this.hideTipInBox()},showNotice:function(){this.tip.className="accNotice",this.tip.update(this.maxRecTipTemp),this.tip.setStyle({width:this.recBox.getWidth()-2+"px"}),this.tip.show()},showTip:function(){this.hideTipInBox()},hideTip:function(){this.tip.hide(),0==this.recItemsId.length&&this.showTipInBox()},hideTipInBox:function(){this.tip_in_box.hide()},showTipInBox:function(){this.tip_in_box.show()},scanContacts:function(){this.match=[];var e=this.recInput.value.replace(/\s+/,"&");if(e.blank())return this.hideContacts(),!1;for(var t=new RegExp("&"+e,"i"),i=0;i<ACContact.contacts.length;i++){var n="",o=ACContact.contacts[i];if("all"==this.scanType||this.scanType==o.type){switch(o.type){case"list":n="&"+o.extra.title.replace(/\s+/,"&")+"&"+o.extra.note;break;case"friend":n="&"+o.extra.real_name.replace(/\s+/,"&")+"&"+o.id;break;case"user":n="&"+o.id.replace(/\s+/,"&")+"&"+o.extra.email;break;case"email":n="&"+o.id}t.test(n)&&this.match.push(i)}}0<this.match.length?this.showContacts():this.hideContacts()},showContacts:function(){this.recInput.value;this.contactListInner.update(""),this.contactListInner.setStyle({height:"auto",width:this.recBox.getWidth()-6+"px"});for(var e=new Element("div"),t=0;t<this.match.length;t++){var i=this.match[t],n=ACContact.contacts[i],o=new Element("div",{id:"cI_"+t,className:"cItem"});switch(n.type){case"list":o.update("<b><i>list</i>"+this.h(n.extra.title)+"</b>"+n.extra.note);break;case"friend":str="<b>"+this.h(n.extra.real_name)+"</b><span class='extraDesc'>(",n.id&&(str+=this.h(n.id)+" on Diigo"),n.extra.location&&(str+=", "+n.extra.location),n.extra.sex&&(str+=" "+n.extra.sex),str+=")</span>",o.update(str);break;case"user":o.update("<b>"+this.h(n.extra.email)+"</b>");break;case"email":o.update("<b>"+this.h(n.id)+"</b>")}o.setAttribute("cIndex",i),o.onmouseover=function(e){this.hoverItem(e)}.bind(this,t),o.onmouseout=function(e){this.outItem(e)}.bind(this,t),o.onclick=function(){this.wrapItem(),document.getElementById("myInput").blur(),document.getElementById("myInput").focus()}.bind(this),e.appendChild(o)}this.contactListInner.appendChild(e),this.contactList.show(),this.contactListInner.getHeight()>this.maxHeight&&this.contactListInner.setStyle({height:this.maxHeight+"px"}),this.hoverItem(0)},hideContacts:function(){this.contactList.hide(),this.currentItem=-1},h:function(text){if(text.blank())return"";var keyword=this.recInput.value;return text.replace(eval("/"+keyword+"/i"),"<span class='keywordStrong'>"+keyword+"</span>")},hoverItem:function(e){0<=this.currentItem&&this.outItem(this.currentItem),e>this.match.length-1?this.currentItem=this.match.length-1:this.currentItem=e<-1?-1:e;var t=$("cI_"+this.currentItem);if(t){if(t.className+=" hover",0==this.currentItem)return this.contactListInner.scrollTop=0,!1;if(this.currentItem==this.match.length-1)return!(this.contactListInner.scrollTop=2e3);var i=this.contactListInner.getDimensions(),n=this.contactListInner.scrollTop,o=n+i.height,a=t.positionedOffset()[1],s=a+t.getHeight();a<n?this.contactListInner.scrollTop-=n-a:o<s&&(this.contactListInner.scrollTop+=s-o)}},outItem:function(e){if(0<=this.currentItem){var t=$("cI_"+this.currentItem);t&&(t.className=t.className.replace(/\s?hover/gi,""))}this.currentItem=-1;var i=$("cI_"+e);i&&(i.className=i.className.replace(/\s?hover/gi,""))},wrapItem:function(e){if(void 0===e){var t=this.recInput.value;if(t.blank())return!(this.currentItem=-1);e=-1==this.currentItem?(emailR=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,emailR.test(t)?ACContact.contacts.push({type:"email",id:t}):ACContact.contacts.push({type:"username",id:t}),ACContact.contacts.length-1):$("cI_"+this.currentItem).getAttribute("cIndex")}var i=ACContact.contacts[e];if(-1!=this.recItemsId.indexOf(e))return this.hideContacts(),this.recBox.onclick(),!1;if(this.maxRec&&this.recItemsId.length>this.maxRec)return this.hideContacts(),this.showNotice(),!1;var n="";switch(i.type){case"list":n="<i>list</i>"+i.extra.title;break;case"friend":n=i.extra.real_name;break;case"user":n=i.extra.email;break;case"email":case"username":n=i.id}var o=new Element("span",{className:"recItem",id:"recItem_"+e}).update(n),a=new Element("a",{className:"recItemRemove",id:"recItemRemove_"+e,href:"javascript:void(0);"}).update("x");o.appendChild(a),o.setAttribute("cIndex",e);var s=new Element("div");s.appendChild(o),new Insertion.Before(this.recInput,s.innerHTML),$("recItemRemove_"+e).onclick=function(e){this.removeRecItem.bind(this)(e)}.bind(this,e),this.recBox.onclick(),this.recItemsId.push(e)},removeRecItem:function(e){$("recItem_"+e).remove(),this.recItemsId=this.recItemsId.without(e),this.recBox.onclick()},getRecItems:function(){if(this.recItemsId&&0!=this.recItemsId.length){for(var e=[],t=[],i=[],n=[],o=0;o<this.recItemsId.length;o++){var a=ACContact.contacts[this.recItemsId[o]];switch(a.type){case"friend":e.push(a.id);break;case"list":i.push(a.id);break;case"user":t.push(a.extra.email);break;case"email":t.push(a.id);break;case"username":n.push(a.id)}}return{friends:e,emails:t,lists:i,usernames:n}}return null},setDefault:function(e){this.wrapItem(e)},getRecOriItems:function(){if(this.recItemsId&&0!=this.recItemsId.length){for(var e=[],t=0;t<this.recItemsId.length;t++)e.push(ACContact.contacts[this.recItemsId[t]]);return e}return null}});ACContact.getTextSize=function(e,t){return t.innerHTML=e.escapeHTML().replace(/ /g,"&nbsp;"),500<t.offsetWidth?500:t.offsetWidth};var _items=[],_groups=[],_moreActionSelectCount=2,_batchActionEnabled=!0,_shareToGroupSelectCount=2;_GLOBAL_VAR.ditems=[],_GLOBAL_VAR.checkedItemCount=0,_GLOBAL_VAR.bACCID="ditemShareToACC",_GLOBAL_VAR.pgHint="Add a Group Comment";var Ditem=Class.create({initialize:function(){this.checked=!1,this.hasDetails=!1,this.c_count=0,this.pri_c_count=0,this.pub_c_count=0,this.pri_a_count=0,this.pub_a_count=0,this.pri_sticky_count=0,this.pub_sticky_count=0,this.comments=[],this.annotations=[],this.groups=[],this.details_count=function(){var e=0;return e+=this.pri_c_count,e+=this.pub_c_count,e+=this.pri_a_count,e+=this.pub_a_count,e+=this.pri_sticky_count,e+=this.pub_sticky_count}}}),Comment=Class.create({initialize:function(){}}),Annotation=Class.create({initialize:function(){this.stickyNotes=[],this.s_count=0}}),StickyNote=Class.create({initialize:function(){}});function switchDetails(e,t){var i=$("ditemDetails_"+e),n=$("eoc_"+e);void 0===t&&(t=null),t?"collapse"==t?(i.hide(),n&&(n.innerHTML=n.innerHTML.replace(DIS_6,DIS_7)),_GLOBAL_VAR.ditems[e].expand=!1,switchCEditor(e,"collapse")):(i.show(),n&&(n.innerHTML=n.innerHTML.replace(DIS_7,DIS_6)),_GLOBAL_VAR.ditems[e].expand=!0):i.visible()?(i.hide(),n&&(n.innerHTML=n.innerHTML.replace(DIS_6,DIS_7)),_GLOBAL_VAR.ditems[e].expand=!1,switchCEditor(e,"collapse")):(i.show(),n&&(n.innerHTML=n.innerHTML.replace(DIS_7,DIS_6)),_GLOBAL_VAR.ditems[e].expand=!0),checkEOCStatus()}function expandOrCollapse(){switchDetails(arguments[0])}function switchExpandOrCollapseAll(){if(_GLOBAL_VAR.expand){expandOrCollapseAll(!1),_GLOBAL_VAR.expand=!1;for(var e=0,t=$("EOCSwitcher_"+e);t;)t.innerHTML=DIS_8,e++,t=$("EOCSwitcher_"+e)}else{expandOrCollapseAll(!0),_GLOBAL_VAR.expand=!0;for(e=0,t=$("EOCSwitcher_"+e);t;)t.innerHTML=DIS_9,e++,t=$("EOCSwitcher_"+e)}}function expandOrCollapseAll(e){if(e){for(var t=0;t<_GLOBAL_VAR.ditems.length;t++)_GLOBAL_VAR.ditems[t].hasDetails&&($("ditemDetails_"+t).show(),$("showDetailsButton_"+t).hide(),_GLOBAL_VAR.ditems[t].expand=!0);_GLOBAL_VAR.expand=!0;for(var i=0,n=$("EOCSwitcher_"+i);n;)i++,n=$("EOCSwitcher_"+i);setDefaultEC("14")}else{for(t=0;t<_GLOBAL_VAR.ditems.length;t++)_GLOBAL_VAR.ditems[t].hasDetails&&($("ditemDetails_"+t).hide(),$("showDetailsButton_"+t).show(),_GLOBAL_VAR.ditems[t].expand=!1);_GLOBAL_VAR.expand=!1;for(i=0,n=$("EOCSwitcher_"+i);n;)i++,n=$("EOCSwitcher_"+i);setDefaultEC("13")}}function checkEOCStatus(){for(var e=!1,t=!1,i=0;i<_GLOBAL_VAR.ditems.length;i++)_GLOBAL_VAR.ditems[i]&&(_GLOBAL_VAR.ditems[i].expand?e=!0:t=!0);if(e&&!t){_GLOBAL_VAR.expand=!0;for(i=0;$("EOCSwitcher_"+i);)$("EOCSwitcher_"+i).innerHTML=DIS_9,i++}else if(!e&&t){_GLOBAL_VAR.expand=!1;for(i=0;$("EOCSwitcher_"+i);)$("EOCSwitcher_"+i).innerHTML=DIS_8,i++}}function checkItem(){var e=arguments[0],t=$("ditemChecker_"+e),i=$("ditemCheckerAll");t.checked?(_GLOBAL_VAR.ditems[e].checked=!0,_GLOBAL_VAR.checkedItemCount++,isAllSelected()&&(i.checked=!0)):(i.checked=!1,_GLOBAL_VAR.ditems[e].checked=!1,_GLOBAL_VAR.checkedItemCount--)}function isAllSelected(){return _GLOBAL_VAR.checkedItemCount==_GLOBAL_VAR.ditems.length}function checkItems(){for(var e=0;e<_GLOBAL_VAR.ditems.length;e++){var t=$("ditemChecker_"+e);t&&t.checked!=this.checked&&t.click()}}function resetChecker(e){}function resetAllChecker(){}function isCheckedAll(){return!!$("ditemCheckerAll").checked}function switchCEditor(e){var t=e.index,i=$("cEditor_"+t);i&&(""==$("cEditor_"+t).innerHTML&&$("cEditor_"+t).appendChild(createCEditor(e)),e.eoc?"collapse"==e.eoc?i.hide():(i.show(),e.show_details&&switchDetails(t,"expand"),initCEditor(e)):""==i.style.display?i.hide():(i.show(),e.show_details&&switchDetails(t,"expand"),initCEditor(e)))}function onlyCommentTo(e){var t=$("cEditorNoticer_"+e);this.checked?showNoticer(t,"Send a message to "+_GLOBAL_VAR.ditems[e].real_name):showNoticer(t,WORD_36)}function createCEditor(e){var t=e.index,i=new Element("form",{id:"cEditForm_"+t,className:"webFormA",method:"post",autocomplete:"off"}),n=new Element("input",{type:"hidden",name:"cType",value:e.cType});i.appendChild(n);var o,a=new Element("fieldset"),s=new Element("ul");if("my"==e.cType){o=new Element("li");var r=new Element("select",{name:"privacy",id:"cModeSelector_"+t});r.update("<option value='c_public'>Public</option><option value='c_private'>Private</option>"),r.onchange=changeCMode.bind(r,t),o.appendChild(r);var l=new Element("span",{id:"cEditorNoticer_"+t,className:"commentNoticer"});o.appendChild(l),s.appendChild(o)}else{o=new Element("li");l=new Element("span",{id:"cEditorNoticer_"+t,className:"commentNoticer"});o.appendChild(l),s.appendChild(o)}o=new Element("li");var d=new Element("textarea",{name:"cContent",id:"cContent_"+t});if(o.appendChild(d),s.appendChild(o),o=new Element("li",{className:"bottomBtn"}),"friend"==e.cType){var c=new Element("label",{className:"bottomChecker"});c.update("<input type='checkbox' id='only_comment_"+t+"' onclick='onlyCommentTo.bind(this)("+t+")' name='only_comment_to_friend' />To "+_GLOBAL_VAR.ditems[t].real_name+" only"),o.appendChild(c)}var u=new Element("input",{id:"commentSubBtn_"+t,className:"diigoBtn firstIBtn",type:"submit",value:"Add Comment"});o.appendChild(u);var p=new Element("input",{id:"commentCancelBtn_"+t,className:"diigoBtn secondIBtn",type:"button",value:"Cancel"});return p.onclick=switchCEditor.bind(this,{index:t,eoc:"collapse"}),o.appendChild(p),s.appendChild(o),a.appendChild(s),i.onsubmit=postComment.bind(i,e),i.appendChild(a),i}function refreshDetailsCount(e){var t=$("eoc_"+e);if(t){var i=$("dCount_"+e),n=_GLOBAL_VAR.ditems[e].details_count();0<n?(_GLOBAL_VAR.ditems[e].hasDetails=!0,i.innerHTML=n,t.show()):(_GLOBAL_VAR.ditems[e].hasDetails=!1,t.hide())}}function postComment(t){var e=t.index,i=$("cContent_"+e);if(""==i.value.trim())return i.focus(),!1;if(t.only_comment_to_friend=!!this.only_comment_to_friend&&this.only_comment_to_friend.checked,t.content=i.value,"friend"==t.cType&&t.only_comment_to_friend){var n="/message_mana/send_msg",o={send_type:"some",send_to:{friends:[_GLOBAL_VAR.ditems[t.index].u_name]},privacy:"private",subject:_GLOBAL_VAR.ditems[t.index].title,message:i.value};postCommentLoading(e),new Ajax.Request(n,{asynchronous:!0,evalScripts:!1,onComplete:function(e){postCommentComplete(e,t)},parameters:"json="+encodeURIComponent(Object.toJSON(o))})}else{n="/annotation_mana/post_comment";var a=Form.serialize(this),s=encodeURIComponent(_GLOBAL_VAR.ditems[t.index].title);if(a+="&to="+_GLOBAL_VAR.ditems[t.index].user_id+"&thread_title="+s+"&link_id="+_GLOBAL_VAR.ditems[e].link_id+"&user_id="+_GLOBAL_VAR.ditems[e].user_id,"my"==t.cType)a+="&cMode="+("c_private"==this.privacy.value?"2":"0");else;postCommentLoading(e),new Ajax.Request(n,{asynchronous:!0,evalScripts:!1,onComplete:function(e){postCommentComplete(e,t)},parameters:a})}return!1}function postCommentLoading(e){switchCEditorToPosting(e)}function switchCEditorToPosting(e){var t=$("commentSubBtn_"+e);t.value=WORD_3,t.disabled=!0,$("commentCancelBtn_"+e).disabled=!0}function switchCEditorToEdit(e){var t=$("commentSubBtn_"+e);t.disabled=!1,t.value="Add Comment",$("commentCancelBtn_"+e).disabled=!1}function postStickyNote(){var t=arguments[0],e=t.split("_"),i=$("sContent_"+t);if(""==i.value.trim())return i.focus(),!1;var n=Form.serialize(this);return n+="&link_id="+_GLOBAL_VAR.ditems[e[0]].link_id+"&ann_id="+_GLOBAL_VAR.ditems[e[0]].annotations[e[1]].id+"&sMode=2",new Ajax.Request("/annotation_mana/post_sticky_note",{asynchronous:!0,evalScripts:!0,onLoading:function(e){postStickyNoteLoading(e,t)},onComplete:function(e){postStickyNoteComplete(e,t,i.value)},parameters:n}),!1}function postStickyNoteLoading(e,t){switchSEditorToPosting(t)}function switchSEditorToPosting(e){var t=$("sSubBtn_"+e);t.value=WORD_3,t.disabled=!0,$("sCancelBtn_"+e).disabled=!0}function switchSEditorToEdit(e){var t=$("sSubBtn_"+e);t.disabled=!1,t.value="Add Sticky Note",$("sCancelBtn_"+e).disabled=!1}function postStickyNoteComplete(e,t,i){if(switchSEditorToEdit(t),"200"==e.status){$("addStickyNoteMenu_"+t).hide();for(var n=e.responseText.split("&"),o=new Object,a=0;a<n.length;a++){var s=n[a].split("=");"content"==s[0]&&(s[1]=unescape(s[1])),o[s[0]]=s[1]}o.content=displayCContent(i),indexA=t.split("_");var r=createNewStickyNote(o,t);if(r){var l=$("stickyUL_"+t);l.appendChild(r),"none"==l.style.display&&l.show(),switchSEditor(t),countDetails(indexA[0])}else showNoticer($("sEditorNoticer_"+t),WORD_4)}else"403"==e.status?authFailed():showNoticer($("sEditorNoticer_"+t),WORD_4)}function createNewStickyNote(e,t){indexA=t.split("_"),sIndex=t+"_"+_GLOBAL_VAR.ditems[indexA[0]].annotations[indexA[1]].stickyNotes.length;var i=new Element("li",{id:"sticky_"+sIndex,className:"sItem"}),n=new Element("span",{className:"content"}).update(e.content),o=new Element("span",{className:"tail"});o.innerHTML+=" - ",o.appendChild(new Element("a",{href:"/user/"+e.u_name}).update(e.u_name)),o.innerHTML+=" "+e.created_at,o.innerHTML+=' - <a class="tailAction" href="javascript:void(0)" onclick="doEditStickyNote(\''+sIndex+"')\">Edit</a>",o.innerHTML+=' - <a href="javascript:void(0);" class="tailAction" onclick="doRemoveStickyNote(\''+sIndex+"')\" >Remove</a>",i.appendChild(n),i.appendChild(o);var a=new StickyNote;return a.id=e.id,a.u_name=e.u_name,a.mode=e.mode,a.link_id=e.link_id,a.content=e.content,addStickyNoteToJson(a,t),i}function addStickyNoteToJson(e,t){var i=t.split("_"),n=$("removeA_"+i[0]+"_"+i[1]);0==_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].s_count&&(_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].mode=e.mode,changeHighlightColor(i[0]+"_"+i[1],e.mode)),_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].stickyNotes.push(e),_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].s_count++,"0"==e.mode?(_GLOBAL_VAR.ditems[i[0]].pub_sticky_count++,n&&(n.style.display="none")):_GLOBAL_VAR.ditems[i[0]].pri_sticky_count++,refreshDetailsCount(i[0])}function changeHighlightColor(e,t){var i=$("highlight_"+e);i.className=0==t?i.className.replace("private","public"):i.className.replace("public","private")}function initCEditor(e){var t=$("cContent_"+e.index);t.disabled=!1,t.value="",t.focus(),e.mode=DEFAULT_C_MODE,initCEditorMode(e)}function initSEditor(e){var t=$("sContent_"+e);t.disabled=!1,t.value="",t.focus();var i=e.split("_"),n=_GLOBAL_VAR.ditems[i[0]].annotations[i[1]];0!=n.s_count?initSEditorMode(e,n.mode,!0):initSEditorMode(e,DEFAULT_S_MODE)}function displayCContent(e){return e.replace(/\r\n|\n|\r/g,"<br/>").replace(/<script/i,"&lt;script").replace(/<\/script/i,"&lt;/script")}function postCommentComplete(e,t){if(switchCEditorToEdit(t.index),"200"==e.status){var i=e.responseText.evalJSON();i.content=displayCContent(t.content);var n=$("comments_"+t.index);n.show(),switchCEditor({index:t.index,eoc:"collapse"});var o=createNewComment(i,t);n.appendChild(o),countDetails(t.index)}else"403"==e.status?authFailed():showNoticer($("cEditorNoticer_"+index),WORD_4)}function createNewComment(e,t){var i=t.index+"_"+_GLOBAL_VAR.ditems[t.index].comments.length,n=new Element("li",{id:"comment_"+i,className:"cItem"});if(!e.tid||"my"==t.cType&&2==e.mode);else{var o=new Element("span",{className:"commentAlert"});t.only_comment_to_friend;var a=MESSAGE_HOST+"/message/"+e.tid;o.update("You can visit the discussion thread here <a href='"+a+"'>"+a+"</a>"),n.appendChild(o)}var s=$("cModeSelector_"+t.index);s&&"c_private"==s.value&&n.addClassName("privateC");var r=new Element("span",{className:"cContent"}).update(e.content),l=new Element("span",{className:"tail"});"friend"==t.cType&&t.only_comment_to_friend,l.innerHTML+=" - ",l.appendChild(new Element("a",{href:"/user/"+e.u_name}).update(e.u_name)),l.innerHTML+=" "+e.created_at,l.innerHTML+=' - <a href="javascript:void(0);" class="tailAction" onclick="doRemoveComment(\''+i+"')\">Remove</a>",n.appendChild(r),n.appendChild(l);var d=new Comment;return d.id=e.id,d.mode=e.mode,d.u_name=e.u_name,d.link_id=e.link_id,addCommentToJson(d,t.index),n}function addCommentToJson(e,t){_GLOBAL_VAR.ditems[t].comments.push(e),"0"==e.mode?_GLOBAL_VAR.ditems[t].pub_c_count++:_GLOBAL_VAR.ditems[t].pri_c_count++,refreshDetailsCount(t)}function addStickyNotes(e){switchSEditor(e)}function cancelSEditor(){switchSEditor(arguments[0])}function switchSEditor(e){var t=$("sticky_"+e),i=$("sEditor_"+e),n=$("annotation_"+e).getElementsByClassName("hOpts")[0];if(""==$("sEditor_"+e).innerHTML&&($("sEditor_"+e).appendChild(createSEditor(e)),initSEditorMode(e,DEFAULT_S_MODE)),""==i.style.display){i.style.display="none";var o=e.split("_");0==_GLOBAL_VAR.ditems[o[0]].annotations[o[1]].s_count&&(t.style.display="none"),n.show()}else i.style.display="",t.style.display="",initSEditor(e),n.hide()}function createSEditor(e){var t=new Element("form",{id:"sEditForm_"+e,className:"webFormA",method:"post"}),i=new Element("fieldset"),n=new Element("ul"),o=new Element("li"),a=new Element("select",{name:"privacy",id:"sModeSelector_"+e,class:"inputTxt2"}).hide();a.update("<option value='s_private'>Private</option>"),a.onchange=changeSMode.bind(a,e);var s=new Element("span",{id:"sEditorNoticer_"+e,className:"commentNoticer"});o.appendChild(a),o.appendChild(s),n.appendChild(o),o=new Element("li");var r=new Element("textarea",{name:"sContent",id:"sContent_"+e,class:"inputTxt2"});o.appendChild(r),n.appendChild(o),(o=new Element("li",{className:"bottomBtn"})).update("<input type='submit' class='diigoBtn firstIBtn' value='Add Sticky Note' id='sSubBtn_"+e+"' />");var l=new Element("input",{id:"sCancelBtn_"+e,className:"diigoBtn secondIBtn",type:"button",value:"Cancel"});return l.onclick=cancelSEditor.bind(l,e),o.appendChild(l),n.appendChild(o),i.appendChild(n),t.onsubmit=postStickyNote.bind(t,e),t.appendChild(i),t}function initSEditorMode(e,t,i){var n=$("sModeSelector_"+e),o=$("sEditorNoticer_"+e);0==document.cookie.match(/diigoandlogincookie=(.+?);/)[1].split("-.-")[3]&&(t="2",i=!0),"0"==t?(n.value="s_public",showNoticer(o,WORD_8)):(n.value="s_private",hideNoticer(o)),n.disabled=i}function initCEditorMode(e){if("my"==e.cType){var t=$("cModeSelector_"+e.index),i=$("cEditorNoticer_"+e.index);"0"==e.mode?(t.value="c_public",showNoticer(i,WORD_36)):(t.value="c_private",showNoticer(i,WORD_37))}else{"friend"==e.cType&&($("only_comment_"+e.index).checked=!1),showNoticer(i=$("cEditorNoticer_"+e.index),WORD_36)}}function changeCMode(e){doCMode(e,$F("cModeSelector_"+e))}function doCMode(e,t){showNoticer($("cEditorNoticer_"+e),"c_public"==t?WORD_36:WORD_37)}function changeSMode(e){doSMode(e,$F("sModeSelector_"+e))}function doSMode(e,t){"s_public"==t?showNoticer($("sEditorNoticer_"+e),WORD_8):hideNoticer($("sEditorNoticer_"+e))}function removeComment(){var e=this.id.split("_");doRemoveComment(e[1]+"_"+e[2])}function doRemoveComment(t){if(!confirm(ALE_21))return!1;var e=t.split("_"),i=_GLOBAL_VAR.ditems[e[0]].comments[e[1]].id,n=_GLOBAL_VAR.ditems[e[0]].comments[e[1]].link_id;try{var o="id="+i+"&link_id="+n;return new Ajax.Request("/annotation_mana/remove_comment",{asynchronous:!0,evalScripts:!0,onLoading:function(e){doRemoveCommentLoading(e,t)},onComplete:function(e){doRemoveCommentComplete(e,t)},parameters:o}),!1}catch(e){return!1}}function doRemoveCommentLoading(e,t){$("comment_"+t).style.backgroundColor="#eee";var i=$("removeComment_"+t);i.innerHTML=WORD_3,i.onclick=null}function doRemoveCommentComplete(e,t){if("200"==e.status){var i=t.split("_"),n=_GLOBAL_VAR.ditems[i[0]].comments[i[1]].mode;delete _GLOBAL_VAR.ditems[i[0]].comments[i[1]],_GLOBAL_VAR.ditems[i[0]].c_count--,"0"==n.mode?_GLOBAL_VAR.ditems[i[0]].pub_c_count--:_GLOBAL_VAR.ditems[i[0]].pri_c_count--,refreshDetailsCount(i[0]),Element.remove("comment_"+t),countDetails(i[0])}}function doRemoveStickyNote(t){if(!confirm(ALE_23))return!1;var e=t.split("_"),i="id="+_GLOBAL_VAR.ditems[e[0]].annotations[e[1]].stickyNotes[e[2]].id+"&link_id="+_GLOBAL_VAR.ditems[e[0]].annotations[e[1]].stickyNotes[e[2]].link_id;return new Ajax.Request("/annotation_mana/remove_sticky_note",{asynchronous:!0,evalScripts:!0,onLoading:function(e){doRemoveStickyNoteLoading(e,t)},onComplete:function(e){doRemoveStickyNoteComplete(e,t)},parameters:i}),!1}function doRemoveStickyNoteLoading(e,t){$("sticky_"+t).style.backgroundColor="#eee";var i=$("removeStickyNote_"+t);i.innerHTML=WORD_3,i.onclick=null}function doRemoveStickyNoteComplete(e,t){if("200"==e.status){var i=t.split("_"),n=_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].mode;if(delete _GLOBAL_VAR.ditems[i[0]].annotations[i[1]].stickyNotes[i[2]],_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].s_count--,"0"==n?_GLOBAL_VAR.ditems[i[0]].pub_sticky_count--:_GLOBAL_VAR.ditems[i[0]].pri_sticky_count--,refreshDetailsCount(i[0]),_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].s_count<=0){$("sticky_"+i[0]+"_"+i[1]).style.display="none",$("addStickyNoteMenu_"+i[0]+"_"+i[1]).show(),changeHighlightColor(i[0]+"_"+i[1],2);var o=$("removeA_"+i[0]+"_"+i[1]);o&&(o.style.display="")}Element.remove("sticky_"+t),countDetails(i[0])}}function doEditStickyNote(e){var t=$("sticky_"+e);Element.insert(t,{after:createSEditForm(e)}),t.hide()}function createSEditForm(e){var t=e.split("_"),i=new Element("form",{id:"sEditForm_"+e,className:"webFormA",method:"post"}),n=new Element("ul"),o=new Element("li"),a=new Element("textarea",{name:"content",id:"sContent_"+e,class:"inputTxt2 stickyNoteArea"});a.value=_GLOBAL_VAR.ditems[t[0]].annotations[t[1]].stickyNotes[t[2]].content,o.appendChild(a),n.appendChild(o),(o=new Element("li",{})).update("<input type='submit' class='diigoBtn firstIBtn' value='Submit' id='sSubBtn_"+e+"' />");var s=new Element("input",{id:"sCancelBtn_"+e,className:"diigoBtn secondIBtn",type:"button",value:"Cancel"});return s.onclick=removeSEditForm.bind(i,e),o.appendChild(s),n.appendChild(o),i.onsubmit=doEditStickyNoteSubmit.bind(i,e),i.appendChild(n),i}function removeSEditForm(){var e=arguments[0];$("sticky_"+e).show(),Element.remove($("sEditForm_"+e))}function doEditStickyNoteSubmit(){var i=arguments[0],n=i.split("_"),e=$("sContent_"+i);if(""==e.value.trim())return e.focus(),!1;var t=_GLOBAL_VAR.ditems[n[0]].annotations[n[1]].stickyNotes[n[2]].id,o=_GLOBAL_VAR.ditems[n[0]].annotations[n[1]].stickyNotes[n[2]].link_id,a=Form.serialize(this);return a+="&id="+t+"&link_id="+o,new Ajax.Request("/annotation_mana/edit_sticky_note",{asynchronous:!0,evalScripts:!0,onComplete:function(e){if("200"==e.status){var t=JSON.parse(e.responseText).content;_GLOBAL_VAR.ditems[n[0]].annotations[n[1]].stickyNotes[n[2]].content=t,$("sticky_"+i).select("span.content")[0].innerHTML=displayCContent(t),$("sticky_"+i).show(),Element.remove($("sEditForm_"+i))}},parameters:a}),!1}function countDetails(e){var t=_GLOBAL_VAR.ditems[e];0!=t.c_count||0!=t.annotations.length?t.hasDetails=!1:t.hasDetails=!0}function removeAnnotation(e){if(confirm(ALE_22)){var t=e.split("_"),i=_GLOBAL_VAR.ditems[t[0]].annotations[t[1]];if(2!=i.mode&&(0!=i.mode||0!=i.s_count))return alert(WORD_11),!1;doRemoveAnnotation(i)}}function doRemoveAnnotation(t){var e="ann_id="+t.id+"&link_id="+t.link_id;return showCentralNoticer(DIS_10),new Ajax.Request("/annotation_mana/remove_annotation",{asynchronous:!0,evalScripts:!0,onComplete:function(e){doRemoveAnnotationComplete(e,t.index)},parameters:e}),!1}function doRemoveAnnotationComplete(e,t){if(hideCentralNoticer(),"200"==e.status){var i=t.split("_"),n=_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].mode,o=_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].s_count;delete _GLOBAL_VAR.ditems[i[0]].annotations[i[1]],Element.remove("annotation_"+t),"0"==n?(_GLOBAL_VAR.ditems[i[0]].pub_sticky_count-=o,_GLOBAL_VAR.ditems[i[0]].pub_a_count--):(_GLOBAL_VAR.ditems[i[0]].pri_sticky_count-=o,_GLOBAL_VAR.ditems[i[0]].pri_a_count--),refreshDetailsCount(i[0]),countDetails(i[0]);var a=$("title_"+i[0]).select(".annotationsCount")[0];a.textContent=parseInt(a.textContent)-1}}function changeAnnotationColor(e,t){var i=e.split("_");doChangeAnnotationColor(_GLOBAL_VAR.ditems[i[0]].annotations[i[1]],t=t.replace("highlight_",""))}function doChangeAnnotationColor(t,i){var e="ann_id="+t.id+"&link_id="+t.link_id+"&color="+i;return showCentralNoticer(DIS_10),new Ajax.Request("/annotation_mana/change_annotation_color",{asynchronous:!0,evalScripts:!0,onComplete:function(e){doChangeAnnotationColorComplete(e,t.index,i)},parameters:e}),!1}function doChangeAnnotationColorComplete(e,t,i){if(hideCentralNoticer(),"200"==e.status){t.split("_");var n=$("highlight_"+t),o=$("annotationMenu_"+t);n.removeClassName("highlight_blue").removeClassName("highlight_green").removeClassName("highlight_pink").removeClassName("highlight_yellow").addClassName("highlight_"+i),o.select("li a span").each(function(e){e.update(""),e.className==i&&e.update("<b></b>")})}}function batchExtract(){var e=whichBChecked();if(0==e.length)return flashNotice2(ALE_20),resetMoreAction(),!1;for(var t=[],i=0;i<e.length;i++)t.push(e[i].index);link_ids=[];for(var n=0;n<t.length;n++){var o=t[n],a=_GLOBAL_VAR.ditems[o];link_ids.push(a.link_id)}window.open("/ditem_mana3/extract_annotations?link_ids="+link_ids.join(","),null,"scrollbars=no,menubar=no,width=640,height=420,resizable=no,toolbar=no,location=no,status=no,screenX=200,screenY=100,left=200,top=100"),resetMoreAction()}function extraA(e){window.open("/ditem_mana3/extract_annotations?link_ids="+_GLOBAL_VAR.ditems[e].link_id,null,"scrollbars=no,menubar=no,width=620,height=420,resizable=yes,toolbar=no,location=no,status=no,screenX=200,screenY=100,left=200,top=100")}function loadAnnotations(e){var t=new Element("blockquote",{style:"margin:0",className:"extraAContentOutter",id:"extraAContentOutter"});t.update("<p><strong>Quotes:</strong></p>");for(var i=new Element("div",{className:"extraAContent",id:"extraAContent",style:"border-left: 2px solid #eee; padding-left:1em!important; margin-left:1em!important;"}),n=0;n<e.length;n++){var o=e[n],a=_GLOBAL_VAR.ditems[o],s=$("titleLink_"+o);if("bookmark"==a.type_name&&a.hasDetails){var r="/toolbar_server_v13";params="v=13.0&from=site&user="+_GLOBAL_VAR.my_name+"&cmd=share_makePermalink&json="+Object.toJSON({mode:3,url:encodeURIComponent(a.url),user:_GLOBAL_VAR.username}),new Ajax.Request(r,{asynchronous:!1,evalScripts:!1,parameters:params,onComplete:function(e){r="200"==e.status?(result=e.responseText.evalJSON().result,result.url):s.href}})}else r=a.share_link&&!a.share_link.empty()?a.share_link:s.href;var l=_GLOBAL_VAR.ditems[o].description,d=new Element("a",{href:r,className:"eTitle",rel:"nofollow"}).update(s.innerHTML),c=new Element("p").update(l),u=new Element("p");u.appendChild(d),u.appendChild(c),i.appendChild(u);var p=new Element("div");if("image"==_GLOBAL_VAR.ditems[o].type_name){var m=_GLOBAL_VAR.ditems[o].share_link?_GLOBAL_VAR.ditems[o].share_link:_GLOBAL_VAR.ditems[o].url,h=new Element("a",{href:m,alt:_GLOBAL_VAR.ditems[o].title});h.appendChild(new Element("img",{src:_GLOBAL_VAR.ditems[o].permanent_url,style:"width:160px"})),p.appendChild(h)}else if("note"==_GLOBAL_VAR.ditems[o].type_name)p.appendChild(new Element("div",{className:"eHContent"}).update(_GLOBAL_VAR.ditems[o].note_content.replace(/\\"/g,'"')));else if("bookmark"==_GLOBAL_VAR.ditems[o].type_name){var f=new Element("ul",{className:"eAUL"}),_=null,v=$("annotations_"+o);for(v&&(_=v.down());_;){var g=new Element("li",{style:"line-height:150%;margin-bottom:.6em;"}),w="";if(_.hasClassName("imageAnnotation")){var A=_.id.split("_")[2];w="<a href='"+_GLOBAL_VAR.ditems[o].annotations[A].share_link+"'><img style='width:160px' src='"+_GLOBAL_VAR.ditems[o].annotations[A].permanent_url+"'/></a>"}else if(_.hasClassName("textAnnotation")){var L=_.down();if(w=L.down().innerHTML,L.next()){for(var y=new Element("ul",{className:"eSUL",style:"line-height:150%;margin-bottom:.6em;"}),b=L.down().next().down().down();b;){var C=new Element("li");C.appendChild(new Element("span",{className:"eSContent"}).update(b.down().innerHTML));var O=new Element("span",{className:"eSTail",style:"font-size:12px;color:#aaa;"}).update(" - "),x=b.down().next().down().innerHTML;O.appendChild(new Element("a",{href:BOOKMARK_HOST+"/user/"+x}).update(x)),C.appendChild(O),y.appendChild(C),b=b.next()}g.appendChild(y)}}g.appendChild(new Element("div",{className:"eHContent"}).update(w)),f.appendChild(g),_=_.next()}p.appendChild(f)}i.appendChild(p)}return t.appendChild(i),t}function getPermalinkMode(){var e=0;return $("pLinkOpt_1").checked||(e+=2),$("pLinkOpt_2").checked||(e+=1),e}function copyPermanlink(e){var t=new PopWindow({optEnabled:!0,top:20,width:500,title:"Copy Permalink",center:!0,root:"ditemItem_"+e});if(t.appendNode(loadPermanlinkContent(e,t)),BrowserVersion.IE)t.submitBtn.value="Copy to clipboard",t.cancelBtn.hide(),t.submit=function(){_copy($F("pLinkInput")),t.submitBtn.value="Copied"};else{var i=$("wOptions");i.innerHTML="",i.setStyle({color:"#cc0000",textAlign:"left"})}makePermalink(e)}function makePermalink(t){PopWindow.instance.onLoading(),_GLOBAL_VAR.ditems[t].shareMode=getPermalinkMode();params="v=13.0&from=site&user="+_GLOBAL_VAR.my_name+"&cmd=share_makePermalink&json="+Object.toJSON({mode:_GLOBAL_VAR.ditems[t].shareMode,url:encodeURIComponent(_GLOBAL_VAR.ditems[t].url),user:_GLOBAL_VAR.username}),new Ajax.Request("/toolbar_server_v13",{asynchronous:!0,evalScripts:!1,parameters:params,onComplete:function(e){result=e.responseText.evalJSON().result,_GLOBAL_VAR.ditems[t].permaLink=result.url,$("pLinkInput").value=_GLOBAL_VAR.ditems[t].permaLink,$("pPreivew").href=_GLOBAL_VAR.ditems[t].permaLink,PopWindow.instance.noticer.hide(),PopWindow.instance.content.show(),PopWindow.instance.opt.show(),PopWindow.instance.reCalShadowRange()}})}function getShareLink(i){var n=new PopWindow({optEnabled:!0,top:20,width:500,title:"Share Link",center:!0,root:"ditemItem_"+i});n.onLoading(),_GLOBAL_VAR.ditems[i].share_link?(n.appendNode(loadSharedLink(i)),PopWindow.instance.noticer.hide(),PopWindow.instance.content.show(),PopWindow.instance.reCalShadowRange()):new Ajax.Request("/item/get_share_url",{asynchronous:!0,evalScripts:!1,onComplete:function(e){var t=JSON.parse(e.responseText);_GLOBAL_VAR.ditems[i].share_link=t.shared_url,n.appendNode(loadSharedLink(i)),PopWindow.instance.noticer.hide(),PopWindow.instance.content.show(),PopWindow.instance.reCalShadowRange()},parameters:"link_id="+encodeURIComponent(_GLOBAL_VAR.ditems[i].link_id)})}function loadSharedLink(e,t){var i=new Element("div",{className:"pLinkContent"}),n=new Element("div",{className:"pLink"});return n.appendChild(new Element("input",{id:"pLinkInput",className:"inputTxt2",value:_GLOBAL_VAR.ditems[e].share_link,onclick:"this.select()"})),i.appendChild(n),i}function loadPermanlinkContent(e,t){var i=new Element("div",{className:"pLinkContent"}),n=new Element("div",{className:"alertTip"}).update("Share this annotated page with others<br/><strong>Copy the URL below</strong> and paste it in your blog, email or IM messages...");i.appendChild(n);var o=new Element("div",{className:"pLink"});o.appendChild(new Element("a",{id:"pPreivew",target:"_blank"}).update("Preview &raquo;")),o.appendChild(new Element("input",{id:"pLinkInput",className:"inputTxt2",onclick:"this.select()"})),i.appendChild(o);var a=new Element("a",{href:"javascript:void(0);"}).update("Options...");a.onclick=function(){$("pLinkOpts").toggle()},i.appendChild(a);var s=new Element("div",{id:"pLinkOpts"}).hide(),r=new Element("label").update("<input type='checkbox' autocomplete='off' id='pLinkOpt_1' value='opt1' onclick=\"makePermalink('"+e+"');\" />Only show my highlights and inline comments"),l=new Element("label").update("<input type='checkbox' autocomplete='off' id='pLinkOpt_2' value='opt2' onclick=\"makePermalink('"+e+"');\" />Don't show my private highlights and inline comments");return s.appendChild(r),s.appendChild(l),i.appendChild(s),i}function forwardB(e){forwardItem({type:"ditem",index_a:e})}function shareB(e){shareItem({type:"ditem",index_a:e})}function includeAnnotations(){var e=$("forwardPreview");this.checked?e.show():e.hide()}function initContactsSelect(){var i=new Element("select",{id:"sendToSelector"});i.onchange=function(){"some"==this.value?($(_GLOBAL_VAR.bACCID).show(),_GLOBAL_VAR[_GLOBAL_VAR.bACCID+"_instance"].showTipInBox()):(_GLOBAL_VAR[_GLOBAL_VAR.bACCID+"_instance"].recBox.reset(),$(_GLOBAL_VAR.bACCID).hide(),_GLOBAL_VAR[_GLOBAL_VAR.bACCID+"_instance"].hideTipInBox())}.bind(i),i.appendChild(new Element("option",{value:"some",selected:"selected"}).update("My mutual friends or emails")),i.appendChild(new Element("option",{value:"all"}).update("All my mutual friends")),i.appendChild(new Element("option",{value:"myself"}).update("No one. Just a note")),i.setAttribute("autocomplete","off"),0<ACContact.contactListsID.length&&(i.appendChild(new Element("option",{className:"sep",disabled:"disabled"}).update("--My Contact Lists--")),ACContact.contactListsID.each(function(e){var t=ACContact.contacts[e];i.appendChild(new Element("option",{value:t.id}).update(t.extra.title))}));var e=$("sendToTD");e.update(""),e.appendChild(i),$(_GLOBAL_VAR.bACCID).show(),_GLOBAL_VAR[_GLOBAL_VAR.bACCID+"_instance"].showTipInBox()}function doForward(){}function postToDraftForward(e){var t=document.forms.forwardForm;t?t.b_id=e:((t=new Element("form",{name:"forwardForm",method:"post",action:"/dmail/draft_forward"}).hide()).appendChild(new Element("input",{type:"hidden",name:"b_id",value:e})),t.setAttribute("autocomplete","off"),document.body.appendChild(t)),t.submit()}function copyThis(){var e=arguments[0],t="/post/index?url="+(t=encodeURIComponent(_GLOBAL_VAR.ditems[e].url))+"&title="+encodeURIComponent(_GLOBAL_VAR.ditems[e].title)+"&tags="+encodeURIComponent(_GLOBAL_VAR.ditems[e].t_name)+"&referInfo="+encodeURIComponent(self.location);self.location=t}function thanks(e){var t=new PopWindow({optEnabled:!0,left:120,top:top+20,width:500,title:"Thanks",root:"ditemItem_"+e}),i=_GLOBAL_VAR.ditems[e],n=new Element("div"),o=!_GLOBAL_VAR.thanksFirstBy||i.first_by.blank()?i.u_name:i.first_by,a=!_GLOBAL_VAR.thanksFirstBy||i.first_by.blank()?i.real_name:i.first_by_real_name,s="Thanks for sharing "+i.title,r="<a href='"+BOOKMARK_HOST+"/profile/"+_GLOBAL_VAR.visitor.username+"'>"+_GLOBAL_VAR.visitor.real_name+"</a> wishes to thank <a href='"+BOOKMARK_HOST+"/profile/"+o+"'>"+a+"</a> for sharing this link: <a href='"+i.url+"'>"+i.title+"</a>",l=new Element("p");l.update('Say "Thanks" to '+a+" for this link. &nbsp;&nbsp;"),n.appendChild(l);var d=new Element("a").update("Write some message for "+a);d.href=MESSAGE_HOST+"/inbox/"+o+"?subject="+encodeURIComponent(s)+"&content="+encodeURIComponent(r),n.appendChild(d),l=new Element("p",{style:"margin-top: 9px;font-size:8pt;"});var c=new Element("label").update("<input type='checkbox' id='trackChecker' checked='checked' /> Track conversations about this bookmark?");l.appendChild(c),n.appendChild(l),t.appendNode(n),t.submitBtn.value=" Ok ",t.submit=function(t){var e={send_type:"thanks"};return e.send_to=o,e.subject=encodeURIComponent(s),e.message=encodeURIComponent(r),e.bid=i.b_id2,e.track=$("trackChecker").checked,e.lid=i.url_id2,this.onLoading(),new Ajax.Request("/message_mana/send_msg",{asynchronous:!0,evalScripts:!1,onComplete:function(e){PopWindow.instance.onComplete({status:e.status}),$("menu_item_"+t+"_thanks").hide()},parameters:"json="+Object.toJSON(e)}),!1}.bind(t,e)}function quickCopy(e){var n=e[0],t={};return t.link_id=_GLOBAL_VAR.ditems[n].link_id,t.uid=_GLOBAL_VAR.ditems[n].user_id,t.copy_type="1",showCentralNoticer(DIS_10),new Ajax.Request("/ditem_mana2/quick_copy",{asynchronous:!0,evalScripts:!1,onComplete:function(e){if(hideCentralNoticer(),"200"==e.status){var t=$("menu_item_"+n+"_qcopy");t&&t.hide();var i=$("menu_item_"+n+"_save");i&&(i.onclick=null,i.update("Saved"))}},parameters:"json="+Object.toJSON(t)}),!1}function loadQuickSave(e){return new Element("label").update("<input type='checkbox' id='quickCopyH' checked='checked' autocomplete='off' /> Include Highlights.")}function saveItem(e){var t;_GLOBAL_VAR.saveBType=e.saveType;var i=e.index||0,n=_GLOBAL_VAR.ditems[i],o=("create"==_GLOBAL_VAR.saveBType?"Save ":"Edit ")+n.type_name;(t=new PopWindow({optEnabled:!0,center:!0,top:0,width:500,title:o,root:this})).appendNode(createSaveItemTemp(n)),t.cancel=function(){resetMoreAction(),resetAllChecker()},t.submitBtn.value="Save",t.cancelBtn.value="Cancel",t.submit=submitSaveItem.bind(this,e),initSaveItemEditor(e),window.jQuery&&window.jQuery.fn.DiigoLSearch?jQuery("#bTxtTags").DiigoLSearch({mutil:!0,type:null,data:TAGs}):enabledSaveItemTagSuggestion("bTxtTags"),switchSelectAddToList(n),switchSelectAddToGroup(null,n.index)}function createSaveItemTemp(e){var t=new Element("table",{className:"editBTable"}),i=new Element("tbody"),n=new Element("tr");n.appendChild(new Element("td").update("<input type='text' placeholder='Url' id='bTxtUrl' class='inputTxt2' name='url' style='width:430px;' maxlength='255' />"));var o=new Element("tr");o.appendChild(new Element("td").update("<input type='text' placeholder='Title' id='bTxtTitle' class='inputTxt2' name='title' style='width:430px;' maxlength='255' />")),desc_row=new Element("tr"),desc_row.appendChild(new Element("td").update("<textarea id='bTxtDesc' placeholder='Add a description' class='inputTxt2' name='desc' style='width:430px;height:60px;' ></textarea>"));var a=new Element("tr");a.appendChild(new Element("td").update("<input type='text' class='inputTxt2' placeholder='Add Tags' id='bTxtTags' autocomplete='off' name='tags' style='width:430px;' maxlength='255' /><p style='font-size:12px;color:#999;'>space separated. Use \" \" for tag with multiple words.</p>"));var s=new Element("tr"),r=new Element("td").update("");r.appendChild(new Element("div",{className:"addToHolder",id:"addToListHolder"}).hide()),r.appendChild(new Element("div",{className:"addListInput",id:"addListInputHolder"}).hide()),s.appendChild(r);var l=new Element("tr");l.id="group_selector";var d=new Element("td").update("");d.appendChild(new Element("div",{className:"addToHolder",id:"addToGroupHolder"}).hide()),l.appendChild(d);var c=new Element("tr"),u="<label><input id='bPriPrivate' type='checkbox' /><b class='PrivateIcon'></b>Private</label>",p="<label><input type='checkbox' id='bUnread' /><b class='RLIcon'></b>Read Later</label>";if(i.appendChild(o),"bookmark"==e.type_name){i.appendChild(n);var m=u+p;e.u_name!=_GLOBAL_VAR.my_name&&e.hasDetails&&(m="<label style='float:right;margin-right:0;'><input id='bCopyAnnotations' type='checkbox' />Copy these highlights</label>"+m),c.appendChild(new Element("td").update(m)),i.appendChild(c),i.appendChild(desc_row)}else if("image"==e.type_name)c.appendChild(new Element("td").update(u)),i.appendChild(c),i.appendChild(desc_row);else if("note"==e.type_name){c.appendChild(new Element("td").update(u)),i.appendChild(c);var h=new Element("tr");h.appendChild(new Element("th").update("Content:")),h.appendChild(new Element("td").update("<textarea id='bNoteTxtContent' class='inputTxt2' name='content' style='width:380px;height:200px;' ></textarea>")),i.appendChild(h)}else if("pdf"==e.type_name){m=u+p;c.appendChild(new Element("td").update(m)).hide(),i.appendChild(c),i.appendChild(desc_row)}return i.appendChild(a),i.appendChild(s),i.appendChild(l),t.appendChild(i),t}function switchSelectAddToList(t){var i=$("addToListHolder");if(!_GLOBAL_VAR.my_lists){var e="/ditem_outliner/load_user_outliners?u_name="+_GLOBAL_VAR.my_name;return i.update("<img src='/images/loading.gif' alt='loading...' />").show(),new Ajax.Request(e,{asynchronous:!0,evalScripts:!1,onComplete:function(e){"200"==e.status&&(_GLOBAL_VAR.my_lists=e.responseText.evalJSON(),renderListSelecotr(i,t))}}),!1}i.show(),$("addToListSelector")||renderListSelecotr(i,t)}function renderListSelecotr(e,t){var i=new Element("select",{id:"addToListSelector",className:"inputTxt2"});i.onchange=function(){if("-2"==i.value){var e=$("addListInputHolder");e.update('<input type="text" id="newListInEdit" class="inputTxt2"><a id="AddListInEdit">Add</a><a id="CancelAddInEdit">Cancel</a>'),e.show(),$("addToListSelector").hide(),$("AddListInEdit").onclick=function(){var e=$("newListInEdit").value;0<e.length&&createListByShareContextMenu($H({title:e}))},$("CancelAddInEdit").onclick=function(){e.hide(),$("addToListSelector").show()}}}.bind(i),i.appendChild(new Element("option",{value:-1}).update("Add to an Outliner")),i.appendChild(new Element("option",{value:-1}).update("------------")),i.appendChild(new Element("option",{value:-2}).update("Create an Outliner...")),i.appendChild(new Element("option",{value:-1}).update("------------"));for(var n=0;n<_GLOBAL_VAR.my_lists.length;n++){if(-1<t.lists_id.indexOf(_GLOBAL_VAR.my_lists[n].id))var o=" (added)";else o="";var a=new Element("option",{value:n}).update(_GLOBAL_VAR.my_lists[n].title+o);i.appendChild(a)}e.update("").appendChild(i),i.value=-1}function switchSelectShareToFriend(e){var i=$("shareToFriendHolder");if(!_GLOBAL_VAR.contactLists){return i.update("<img src='/images/loading.gif' alt='loading...' />").show(),new Ajax.Request("/user_mana2/load_contact_lists",{asynchronous:!0,evalScripts:!1,method:"get",onComplete:function(e){if("200"==e.status){var t=e.responseText.evalJSON();_GLOBAL_VAR.contactLists=t,renderShareToFriendSelector(i)}}}),!1}i.visible()?i.hide():i.show(),$("shareToFriendSelector")||renderShareToFriendSelector(i)}function renderShareToFriendSelector(e){var t=new Element("select",{id:"shareToFriendSelector"});t.onchange=function(){"-2"==t.value&&(self.location=BOOKMARK_HOST+"/contact/new_list")}.bind(t),t.appendChild(new Element("option",{value:"-3",selected:"selected"}).update("All Friends"));for(var i=new Element("optgroup",{label:"Or Friends in a Contact List"}),n=0;n<_GLOBAL_VAR.contactLists.length;n++){var o=_GLOBAL_VAR.contactLists[n],a=new Element("option",{value:o.id}).update(o.extra.title);i.appendChild(a)}t.appendChild(i),1<_GLOBAL_VAR.contactLists.length&&t.appendChild(new Element("option",{value:-1}).update("------------")),t.appendChild(new Element("option",{value:-2}).update("Create a Contact List...")),e.update("").appendChild(t),t.value=-3}function switchSelectAddToGroup(e,t){var i=$("addToGroupHolder");if(!_GLOBAL_VAR.my_groups){var n="/group_mana/load_groups?u_name="+_GLOBAL_VAR.my_name;return i.update("<img src='/images/loading.gif' alt='loading...' />").show(),new Ajax.Request(n,{asynchronous:!0,evalScripts:!1,onComplete:function(e){"200"==e.status&&(_GLOBAL_VAR.my_groups=e.responseText.evalJSON(),renderGroupSelector(i,t))}}),!1}i.show(),$("addToGroupSelector")||renderGroupSelector(i,t)}function renderGroupSelector(e,t){var i=new Element("select",{id:"addToGroupSelector",className:"inputTxt2"});i.onchange=function(){"-2"==i.value?self.location=GROUP_HOST+"/create":0<=i.value?($("addToGroupHolder").select("label")[0]&&$("addToGroupHolder").select("label")[0].show(),$("addToGroupHolder").select("textarea")[0].show()):-1==i.value&&($("addToGroupHolder").select("label")[0]&&$("addToGroupHolder").select("label")[0].hide(),$("addToGroupHolder").select("textarea")[0].hide())}.bind(i),i.appendChild(new Element("option",{value:-1}).update("Share to a Group")),i.appendChild(new Element("option",{value:-1}).update("------------"));for(var n=_GLOBAL_VAR.ditems[t].groups,o=[],a=0,s=n.length;a<s;a++)o.push(n[a].g_name);for(a=0;a<_GLOBAL_VAR.my_groups.length;a++){if(-1<o.indexOf(_GLOBAL_VAR.my_groups[a].g_name))var r=" (added)";else r="";var l=new Element("option",{value:a}).update(_GLOBAL_VAR.my_groups[a].display_name+r);i.appendChild(l)}1<_GLOBAL_VAR.my_groups.length&&i.appendChild(new Element("option",{value:-1}).update("------------")),i.appendChild(new Element("option",{value:-2}).update("Create a Group...")),e.update("").appendChild(i);var d=_GLOBAL_VAR.ditems[t];if(("bookmark"==d.type_name||"pdf"==d.type_name)&&d.hasDetails){var c=new Element("label",{style:"margin-left:10px;display:none;"}).update("<input type='checkbox' checked ='checked' id='addToGroupWithA'/>Share Existing Annotations");c.setAttribute("for","addToGroupWithA"),e.appendChild(c)}var u=new Element("textarea",{id:"addToGroupComment",className:"inputTxt2"});u.setStyle({margin:"5px 0 0 0",width:"95%",height:"60px",color:"#999",display:"none"}),u.value=_GLOBAL_VAR.pgHint,u.onfocus=function(){u.value==_GLOBAL_VAR.pgHint&&(u.value="",u.style.color="#000;")}.bind(u),u.onblur=function(){u.value.blank()&&(u.value=_GLOBAL_VAR.pgHint,u.style.color="#999;")}.bind(u),d.description&&(u.value=d.description),e.appendChild(u),i.value=-1}function initSaveItemEditor(e){var t,i,n,o,a=e.index||0;if("list"==e.type)t=_GLOBAL_VAR.list.title,n=_GLOBAL_VAR.list.tags.split(","),o=_GLOBAL_VAR.list.desc||"";else{var s=_GLOBAL_VAR.ditems[a];if(t=s.title,i=s.url,n=s.t_name.split(","),o=s.description||"","bookmark"==s.type_name)0==s.readed&&($("bUnread").checked=!0),$("bTxtUrl").value=i;else if("image"==s.type_name);else if("note"==s.type_name){$("bNoteTxtContent").up().up().remove();var r=new Element("a");r.href="/item/edit/note"+s.url_key,r.setStyle("text-align: right; display: block; margin-right: 50px;"),r.update("Edit Content &raquo"),$("wContent").insert({top:r})}else"pdf"==s.type_name&&0==s.readed&&($("bUnread").checked=!0);2==s.mode&&($("bPriPrivate").checked=!0)}$("bTxtTitle").value=t;for(var l=[],d=0;d<n.length;d++)-1!=n[d].indexOf(" ")?l.push('"'+n[d]+'"'):l.push(n[d]);var c=l.join(" ");$("bTxtTags")&&($("bTxtTags").value=c.trim()),$("bTxtDesc")&&($("bTxtDesc").value=o.trim())}function refreshDitem(e){var t=_GLOBAL_VAR.ditems[e],i=$("titleLink_"+e);i.update(_GLOBAL_VAR.ditems[e].title),i.href=t.url;var n=$("oriUrl_"+e);n&&(n.update(_GLOBAL_VAR.ditems[e].domain),n.href="/search?adSScope=my&snapshot=no&what=%40"+encodeURIComponent(_GLOBAL_VAR.ditems[e].domain));var o=$("cacheLink_"+e);o&&(o.href=t.cache_link);var a,s=$("tags_"+e);if(s.update(""),_GLOBAL_VAR.ditems[e].t_name.blank())s.className="";else for(var r=_GLOBAL_VAR.ditems[e].t_name.split(","),l=0;l<r.length;l++){var d=document.createElement("a");-1!=r[l].indexOf(" ")?d.href="/user/"+_GLOBAL_VAR.username+"/"+encodeURIComponent('"'+r[l]+'"'):d.href="/user/"+_GLOBAL_VAR.username+"/"+encodeURIComponent(r[l]),d.innerHTML=r[l],s.appendChild(d)}if((a=(a=$("title_"+e)?$("title_"+e).up():i)||$("titleLink_"+e))&&(0==t.mode?a.removeClassName("private"):a.addClassName("private")),$("descContent_"+e)){var c=_GLOBAL_VAR.ditems[e].description;c.blank()?$("desc_"+e).hide():($("descContent_"+e).update(displayCContent(c)),$("desc_"+e).show(),$("expandInfo_"+e).show(),$("expandInfo_"+e).hasClassName("expand")||$("expandInfo_"+e).click())}switch(_GLOBAL_VAR.ditems[e].type_name){case"bookmark":1==t.readed?(i.className="readed",i.title="",i.href=_GLOBAL_VAR.ditems[e].url):(i.className="unread",i.title="Unread",i.onmouseup=function(){clickMarkRead(e)},i.href="/ditem_mana2/read_ditem?link_id="+_GLOBAL_VAR.ditems[e].link_id+"&url="+encodeURIComponent(_GLOBAL_VAR.ditems[e].url))}renderBelongTo(e),renderSharedTo(e)}function submitSaveItem(n){var o=n.index,a=_GLOBAL_VAR.ditems[o]||{};a.type_name=a.type_name||"bookmark";var e={},t=$("bTxtTitle");if(""==t.value.trim())return t.focus(),!1;e.title=t.value;var i=$("bTxtTags");if(e.tags=i.value.trim(),(descTxt=$("bTxtDesc"))&&(e.description=descTxt.value),$("bUnread")&&(e.unread=$("bUnread").checked),$("bPriPrivate")&&(e.private=$("bPriPrivate").checked),"ditem"==n.type){if(e.url=a.url,"bookmark"==a.type_name){var s=$("bTxtUrl");if(""==s.value.trim())return s.focus(),!1;s.value!=a.url&&(e.new_url=s.value)}if(e.link_id=a.link_id,$("bNoteTxtContent")){var r=$("bNoteTxtContent").value;if(r.empty())return!1;e.content=r}$("bCopyAnnotations")&&$("bCopyAnnotations").checked&&(e.copy_annotations=$("bCopyAnnotations").checked),_GLOBAL_VAR.my_name!=a.u_name&&(e.ca_owner_id=a.user_id)}else"list"==n.type&&(e.url=_GLOBAL_VAR.list.publish_url);var l=_GLOBAL_VAR.my_lists[$F("addToListSelector")];l&&(e.lists=[l.id]);var d=_GLOBAL_VAR.my_groups[$F("addToGroupSelector")];d&&(e.groups=[d.g_name]);var c=$("addToGroupWithA");c&&c.checked&&(e.shareExistingAnnotations=!0);var u=$("addToGroupComment");u&&!u.value.blank()&&u.value!=_GLOBAL_VAR.pgHint&&(e.groupPageComment=u.value),PopWindow.instance.onLoading();var p="/item/save/"+a.type_name;return new Ajax.Request(p,{asynchronous:!0,evalScripts:!1,onComplete:function(e){if(PopWindow.instance.onComplete({status:e.status}),"200"==e.status){var t=e.responseText.evalJSON();if("ditem"==n.type&&_GLOBAL_VAR.my_name==a.u_name){if(a.title=t.title,a.t_name=t.tags,null!=t.url&&(a.url=t.url),null!=t.domain&&(a.domain=t.domain),null!=t.link_id&&(a.link_id=t.link_id),null!=t.desc&&(a.description=t.desc),t.lists_id&&(a.lists_id=a.lists_id.concat(t.lists_id).uniq()),t.groups&&t.groups[0]){var i=t.groups[0];a.groups=a.groups.concat({g_name:i.name,display_name:i.displayName})}a.mode=t.mode,a.readed=t.unread?0:1,t.note_content&&!t.note_content.empty()&&(a.note_content=t.note_content),t.share_link?a.share_link=t.share_link:a.share_link&&(a.share_link=""),null!=t.cache_link&&(a.cache_link=t.cache_link),_GLOBAL_VAR.ditems[o]=a,n.callback?n.callback(n.saveType,a):refreshDitem(o)}}},parameters:e}),!1}function initSharedTo(){for(var e="",t=0;t<_GLOBAL_VAR.ditems.length;t++)e+=_GLOBAL_VAR.ditems[t].index+":"+_GLOBAL_VAR.ditems[t].link_id+",";var i="/group_mana/load_shared_to?u_name="+(_GLOBAL_VAR.username||"");new Ajax.Request(i,{asynchronous:!0,evalScripts:!1,method:"post",onComplete:function(e){initSharedToComplete(e)},parameters:"link_id="+e})}function initSharedToComplete(request){if("200"==request.status){eval(request.responseText);for(var i=0;i<_GLOBAL_VAR.ditems.length;i++)renderSharedTo(i)}}function doShareToGroupAction(){if(arguments.length<1)var e=this.value;else e=arguments[0];switch(e){case"-1":break;case"-2":self.location=GROUP_HOST+"/group_mana/step_1";break;default:doShareToGroup(e)}}function doShareToGroup(t){if(0==_GLOBAL_VAR.checkedItemCount)return flashNotice2(ALE_20),resetShareToGroup(),!1;lockShareToGroup();for(var e=whichBChecked(),i="",n=0;n<e.length;n++)i+=0==n?e[n].index+":"+e[n].link_id:","+e[n].index+":"+e[n].link_id;var o="/group_mana/share_to?g_name="+_GLOBAL_VAR.groups[t].g_name;showCentralNoticer(DIS_10),new Ajax.Request(o,{asynchronous:!0,evalScripts:!1,onComplete:function(e){doShareToGroupComplete(e,t)},parameters:"link_id="+i})}function doShareToGroupComplete(e,t){if("200"==e.status){flashNotice2(ALE_37.replace("?","<a href='"+GROUP_HOST+"/group/"+_GLOBAL_VAR.groups[t].g_name+"' style='text-decoration:underline;'>"+_GLOBAL_VAR.groups[t].display_name+"</a>"));for(var i=whichBChecked(),n=0;n<i.length;n++)noticeSharedTo(i[n].index,"1",t)}else"400"==e.status||alert(EXC_1);resetAllChecker(),hideCentralNoticer(),resetShareToGroup()}function noticeSharedTo(e,t,i){var n=_GLOBAL_VAR.groups[i].g_name,o=_GLOBAL_VAR.groups[i].display_name,a=_GLOBAL_VAR.groups[i].mode;"1"==t&&(_GLOBAL_VAR.ditems[e].groups.push({g_name:n,display_name:o,mode:a}),renderSharedTo(e))}function renderSharedTo(e){if(0<_GLOBAL_VAR.ditems[e].groups.length){var t=$("sharedTo_"+e);if(t){t.show(),t.innerHTML="in group: ";for(var i=0;i<_GLOBAL_VAR.ditems[e].groups.length;i++){var n=_GLOBAL_VAR.ditems[e].groups[i],o=document.createElement("a");o.href=GROUP_HOST+"/group/"+n.g_name,o.innerHTML=n.display_name,o.style.margin="0",t.appendChild(o),i<_GLOBAL_VAR.ditems[e].groups.length-1&&(t.innerHTML+=", ")}}}}function resetShareToGroup(){for(var e=0;e<_shareToGroupSelectCount;e++){var t=$("shareToGroup_"+e);t&&(t.value="-1",t.disabled=!1,t.blur())}}function lockShareToGroup(){for(var e=0;e<_shareToGroupSelectCount;e++){var t=$("shareToGroup_"+e);t&&(t.disabled=!0)}}function flagAsSpam(){if(!confirm("report spam?"))return!1;var i=arguments[0],e="/spam_mana/mark_spam?b_id2="+_GLOBAL_VAR.ditems[i].b_id2;return new Ajax.Request(e,{asynchronous:!0,evalScripts:!1,onComplete:function(e){if("200"==e.status){var t=$("menu_item_"+i+"_spam");t.innerHTML="Spam reported",t.onclick=null}else alert(e.status)}}),!1}function traceDitem(){doTraceDitem([_GLOBAL_VAR.ditems[arguments[0]]],1)}function untraceDitem(){doTraceDitem([_GLOBAL_VAR.ditems[arguments[0]]],0)}function doTraceDitem(t,i){if(0==t.length)return!1;for(var e=[],n=0;n<t.length;n++)e.push($H({b_index:t[n].index,url_id2:t[n].url_id2,trace_id:t[n].trace_id,trace:i}));return showCentralNoticer(DIS_10),new Ajax.Request("/alert/trace_ditem",{asynchronous:!0,evalScripts:!0,onComplete:function(e){traceDitemComplete(e,t,i)},parameters:"trace="+i+"&trace_info_json="+e.toJSON()}),!1}function traceDitemComplete(e,t,i){if(hideCentralNoticer(),"200"==e.status)for(var n=e.responseText.evalJSON(),o=0;o<n.length;o++){var a=n[o].b_index,s=$("menu_item_"+a+"_trace"),r=_GLOBAL_VAR.ditems[a];1==i?(s&&(s.onclick=untraceDitem.bind(s,a),s.innerHTML=WORD_27),r.trace_id=n[o].trace_id):(s&&(s.onclick=traceDitem.bind(s,a),s.innerHTML=WORD_26),r.trace_id=0);var l=$("bTrace_"+a);0<r.trace_id?(l.innerHTML=WORD_28,l.show()):(l.innerHTML="",l.hide())}else alert(EXC_5);resetMoreAction()}function switchTagCloudEOS(){var e=loadCusData(),t=$("tagCloudEOS"),i=$("u_cloudBoxHolder");-1!=t.innerHTML.indexOf("Expand")?(i.setStyle({height:"auto",overflow:"hidden"}),e.tag_cloud_eos="1",t.innerHTML="Shrink"):(i.setStyle({height:"300px",overflow:"auto"}),e.tag_cloud_eos="0",t.innerHTML="Expand"),e.store()}function removeBFromList2(){if(!confirm(ALE_33))return resetMoreAction(),resetAllChecker(),!1;var e=this.getAttribute("listID");doRemoveBFromList([_GLOBAL_VAR.ditems[arguments[0]]],1,e)}function removeBFromList(){if(!confirm(ALE_33))return resetMoreAction(),resetAllChecker(),!1;doRemoveBFromList([_GLOBAL_VAR.ditems[arguments[0]]],0)}function doRemoveBFromList(t,i,e){for(var n=[],o=0;o<t.length;o++)n.push(t[o].itemId||t[o].link_id);var a,s=t[0].itemType||2;a="1"==i?e:_GLOBAL_VAR.list_id;var r=$H({lid_a:n,list_id:a,item_type:s}).toJSON();return showCentralNoticer(DIS_10),new Ajax.Request("/ditem_list/delete_ditem",{asynchronous:!0,evalScripts:!0,onComplete:function(e){doRemoveBFromListComplete(e,t,i,a)},parameters:"json_infos="+r}),!1}function doRemoveBFromListComplete(e,t,i,n){if(hideCentralNoticer(),resetMoreAction(),resetAllChecker(),"200"==e.status)if("1"==i)for(var o=0;o<t.length;o++){var a=t[o];_GLOBAL_VAR.ditems[a.index].lists_id=_GLOBAL_VAR.ditems[a.index].lists_id.without(n),$("bToList_"+a.index+"_"+n).remove()}else{for(o=0;o<t.length;o++){a=t[o];_GLOBAL_VAR.ditems[a.index]=null,removeListDitem(a.index)}0==_GLOBAL_VAR.ditems.compact().length&&self.location.reload()}}function deleteB(){var e=arguments[0],t=arguments[1],i=_GLOBAL_VAR.ditems[e],n="delete "+i.type_name+' "'+i.title+'" ?';if(!confirm(n))return resetMoreAction(),resetAllChecker(),!1;t&&"function"==typeof t&&t(),doDeleteB(e||0==e?[_GLOBAL_VAR.ditems[e]]:[_GLOBAL_VAR.ditem])}function doDeleteB(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].link_id);var n="link_id="+e.join(",");return showCentralNoticer(DIS_10),new Ajax.Request("/ditem_mana2/delete_b",{asynchronous:!0,evalScripts:!1,onComplete:function(e){doDeleteBComplete(e,t)},parameters:n}),!1}function doDeleteBComplete(e,t){if(hideCentralNoticer(),resetMoreAction(),"200"==e.status)if(_GLOBAL_VAR.back)self.location=_GLOBAL_VAR.back;else if(_GLOBAL_VAR.ditems&&0!=_GLOBAL_VAR.ditems.size()){for(var i=0;i<t.length;i++){var n=t[i];_GLOBAL_VAR.ditems[n.index]=null,removeDitem(n.index),window.jQuery&&jQuery("#ditemItemsWraper .ditemImageGrid").diigowf("reload")}0==_GLOBAL_VAR.ditems.compact().length&&self.location.reload()}else self.location="/user/"+_GLOBAL_VAR.ditem.user_name}function removeDitem(e){Element.remove("ditemItem_"+e)}function removeListDitem(e){$("ditemItem_"+e).up().remove()}function markUnread(){doMarkUnreadRead([_GLOBAL_VAR.ditems[arguments[0]]],0)}function markRead(){doMarkUnreadRead([_GLOBAL_VAR.ditems[arguments[0]]],1)}function doMarkUnreadRead(t,i){if(0==t.length)return!1;for(var e="",n=0;n<t.length;n++)e+=t[n].link_id+",";if(""==e)return!1;var o="link_id="+e+"&readed="+i;return showCentralNoticer(DIS_10),new Ajax.Request("/ditem_mana2/mark_readed",{asynchronous:!0,evalScripts:!0,onComplete:function(e){markUnreadComplete(e,t,i)},parameters:o}),!1}function markUnreadComplete(e,t,i){if(hideCentralNoticer(),"200"==e.status)for(var n=0;n<t.length;n++){var o=t[n].index,a=_GLOBAL_VAR.ditems[o];a.readed=i;var s=$("titleLink_"+o);1==a.readed?s.className="readed":s.className="unread"}resetMoreAction(),resetChecker(o)}function markTempRead(e){$("titleLink_"+e).className="readed"}function clickMarkRead(e){doMarkRead([_GLOBAL_VAR.ditems[e]])}function doMarkRead(t){if(0==t.length)return!1;for(var e="",i=0;i<t.length;i++)e+=t[i].link_id+",";if(""==e)return!1;var n="link_id="+e;return showCentralNoticer(DIS_10),new Ajax.Request("/ditem_mana2/mark_readed",{asynchronous:!0,evalScripts:!0,onComplete:function(e){markReadComplete(e,t)},parameters:n}),!1}function markReadComplete(e,t){if(hideCentralNoticer(),"200"==e.status)for(var i=0;i<t.length;i++){var n=t[i].index;$("titleLink_"+n).className="readed",$("action_markRead_"+n).remove()}resetMoreAction()}function markModePublic(){doMarkMode([_GLOBAL_VAR.ditems[arguments[0]]],0)}function markModePrivate(){doMarkMode([_GLOBAL_VAR.ditems[arguments[0]]],2)}function doMarkMode(t,i){if(0==t.length)return!1;for(var e="",n=0;n<t.length;n++)e+=t[n].link_id+",";if(""==e)return!1;var o="link_id="+e+"&mode="+i;return showCentralNoticer(DIS_10),new Ajax.Request("/ditem_mana2/convert_mode",{asynchronous:!0,evalScripts:!0,onComplete:function(e){markModeComplete(e,t,i)},parameters:o}),!1}function markModeComplete(e,t,i){if(hideCentralNoticer(),"200"==e.status)for(var n=0;n<t.length;n++){var o=t[n].index,a=_GLOBAL_VAR.ditems[o];a.mode=i;var s=$("title_"+o).up();0==a.mode?s.removeClassName("private"):s.addClassName("private")}resetMoreAction()}function doAction(){if(arguments.length<1)var e=this.value;else e=arguments[0];switch(e){case"0":batchForwardB();break;case"2":batchmarkMode(0);break;case"3":batchmarkMode(2);break;case"4":batchDeleteB();break;case"6":batchExtract();break;case"7":batchMarkUnreadRead(1);break;case"8":batchMarkUnreadRead(0);break;case"9":newDitem();break;case"10":batchBlogthis();break;case"13":batchTraceDitem(1);break;case"14":batchTraceDitem(0);break;case"15":batchAddToBList();break;case"16":batchEditTags.bind(this)();break;case"25":batchRemoveBFromList()}blurMoreAction()}function blurMoreAction(){try{for(var e=0;e<_moreActionSelectCount;e++){var t=$("moreAction_"+e);t&&t.blur()}}catch(e){}}function batchForwardB(){var e=whichBChecked();if(0==e.length)return flashNotice2(ALE_20),resetMoreAction(),!1;for(var t=[],i=0;i<e.length;i++)t.push(e[i].index);forwardB(t)}function batchBlogthis(){var e=whichBChecked();if(0==e.length)return flashNotice2(ALE_20),resetMoreAction(),!1;for(var t=[],i=0;i<e.length;i++)t.push(e[i].link_id);postToDraftBlog(t.join(","))}function batchMarkUnreadRead(e){var t=whichBChecked();if(0==t.length)return flashNotice2(ALE_20),resetMoreAction(),!1;for(var i=[],n=0;n<t.length;n++)t[n].readed==e?resetChecker(t[n].index):i.push(t[n]);doMarkUnreadRead(i,e)}function batchmarkMode(e){var t=whichBChecked();if(0==t.length)return flashNotice2(ALE_20),resetMoreAction(),!1;for(var i=[],n=0;n<t.length;n++)t[n].mode==e?resetChecker(t[n].index):i.push(t[n]);doMarkMode(i,e)}function batchDeleteB(){return 0==_GLOBAL_VAR.checkedItemCount?(flashNotice2(ALE_20),resetMoreAction(),!1):confirm(ALE_26)?void doDeleteB(whichBChecked()):(resetMoreAction(),resetAllChecker(),!1)}function batchRemoveBFromList(){return 0==_GLOBAL_VAR.checkedItemCount?(flashNotice2(ALE_20),resetMoreAction(),!1):confirm(ALE_33)?void doRemoveBFromList(whichBChecked(),0):(resetMoreAction(),resetAllChecker(),!1)}function doPrint(e){var t=document.forms.extractForm;if(t)t.b_id=e;else{(t=document.createElement("form")).name="extractForm",t.method="post",t.action="/ditem_mana2/extract";var i=document.createElement("input");i.type="hidden",i.name="b_id",i.value=e,t.appendChild(i),t.style.display="none",document.body.appendChild(t)}t.submit()}function newDitem(){var e="/post/index?referInfo="+self.location;self.location=e}function blogThis(){postToDraftBlog(_GLOBAL_VAR.ditems[this.index].b_id)}function postToDraftBlog(e){var t=document.forms.blogThisForm;if(t)t.b_id=e;else{(t=document.createElement("form")).name="blogThisForm",t.method="post",t.action="/blog_this/draft_blog";var i=document.createElement("input");i.type="hidden",i.name="link_id",i.value=e,t.appendChild(i),t.style.display="none",document.body.appendChild(t)}t.submit()}function whichBChecked(){for(var e=[],t=0;t<_GLOBAL_VAR.ditems.length;t++)void 0!==_GLOBAL_VAR.ditems[t]&&_GLOBAL_VAR.ditems[t]&&_GLOBAL_VAR.ditems[t].checked&&e.push(_GLOBAL_VAR.ditems[t]);return e}function resetMoreAction(){try{for(var e=0;e<_moreActionSelectCount;e++){var t=$("moreAction_"+e);t&&(t.value="-1",t.disabled=!1,t.blur())}}catch(e){}}function lockMoreAction(e){for(var t=0;t<_moreActionSelectCount;t++){var i=$("moreAction_"+t);i&&(i.value=e,i.disabled=!0)}}function markDefaultECAction(e){for(var t=0;t<_moreActionSelectCount;t++){var i=$("defaultEC_"+t);"0"==e?(i.value="13",i.innerHTML=i.innerHTML.replace("expand","collapse")):(i.value="14",i.innerHTML=i.innerHTML.replace("collapse","expand"))}}function getBatchActions(){for(var e=[],t=document.getElementsByTagName("option"),i=0;i<t.length;i++){"batchAction"==t[i].getAttribute("name")&&e.push(t[i])}return e}function batchTraceDitem(e){var t=whichBChecked();if(0==t.length)return flashNotice2(ALE_20),resetMoreAction(),!1;for(var i=[],n=0;n<t.length;n++)0<t[n].trace_id&&1==e?resetChecker(t[n].index):0==t[n].trace_id&&0==e?resetChecker(t[n].index):i.push(t[n]);doTraceDitem(i,e)}function checkBList(){this.checked?_GLOBAL_VAR.lists[this.index].checked=!0:_GLOBAL_VAR.lists[this.index].checked=!1}function whichBListChecked(){for(var e=[],t=0;t<_GLOBAL_VAR.lists.length;t++){var i=_GLOBAL_VAR.lists[t];void 0!==i&&i.checked&&e.push(i)}return e}function renderBelongTo(e){if(0<_GLOBAL_VAR.ditems[e].lists_id.length){var t=$("belongList_"+e);if(t){for(var i="in outliner: ",n=0;n<_GLOBAL_VAR.ditems[e].lists_id.length;n++){var o=_GLOBAL_VAR.ditems[e].lists_id[n];_GLOBAL_VAR.lists.each(function(e){if(e.id==o){var t=e;i+=", <a style='margin:0;' title=\"Go to outliner: "+t.title+'" href="'+t.uri+'">'+t.title+"</a>"}})}t.innerHTML=i.replace("in outliner: , ","in outliner: ")}}}function batchEditTags(){if(0==whichBChecked().length)return flashNotice2(ALE_20),resetMoreAction(),!1;var e=new PopWindow({optEnabled:!0,left:150,top:100,title:"Revise tags",root:"right_Column"});e.appendNode(loadTagEditor()),e.submit=doTagsEdit.bind(e,$("tagEditForm")),e.cancel=function(){resetMoreAction(),resetAllChecker()},$("editTags").clear().focus(),$("tagEditOption_2").checked=!0,enabledSaveItemTagSuggestion("editTags"),e.show()}function loadTagEditor(){if(_GLOBAL_VAR.tagEditor)return _GLOBAL_VAR.tagEditor;var e=new Element("form",{id:"tagEditForm",method:"post",onsubmit:"return false;"});return row=new Element("div",{className:"teItem"}),row.appendChild(new Element("input",{type:"text",name:"editTags",maxlength:255,id:"editTags",className:"inputTxt2"})),e.appendChild(row),row=new Element("div",{className:"teItem"}),row.appendChild(new Element("label",{for:"tagEditOption_2"}).update("<p style='margin-top:5px;'><input type='radio' value='1' id='tagEditOption_2' name='editTagOption' />Add additional tags to selected items</p>")),row.appendChild(new Element("label",{for:"tagEditOption_1"}).update("<p style='margin-top:5px;'><input type='radio' value='0' id='tagEditOption_1' name='editTagOption' />Replace all tags on selected items by</p>")),e.appendChild(row),_GLOBAL_VAR.tagEditor=e,_GLOBAL_VAR.tagEditor}function doTagsEdit(){var t=this,e=arguments[0];if(""==$F("editTags").trim())return!1;var i=whichBChecked();if(0==i.length)return!1;for(var n=[],o=0;o<i.length;o++)n.push(i[o].link_id);var a=$H({link_id_a:n});return t.onLoading(),new Ajax.Request("/ditem_mana2/batch_edit_tags",{asynchronous:!0,evalScripts:!1,onComplete:function(e){doTagsEditComplete(e,i,t)},parameters:Form.serialize(e)+"&infos="+a.toJSON()}),!1}function doTagsEditComplete(e,i,n){if(n.onComplete({status:e.status}),resetMoreAction(),resetAllChecker(),"200"==e.status){for(var o,a=e.responseText.evalJSON(),s=document.getElementsByName("editTagOption"),r=0;r<s.length;r++)s[r].checked&&(o=s[r].value);for(r=0;r<i.length;r++){var l=i[r].index;"0"==o||"no_tag"==i[r].t_name?i[r].t_name=a.uniq().join(","):"1"==o&&(t=i[r].t_name.blank()?a:i[r].t_name.split(",").concat(a),i[r].t_name=t.uniq().join(",")),refreshDitem(l)}}}function doAddToListAction(){if(arguments.length<1)var e=this.value;else e=arguments[0];switch(e){case"-1":break;case"-2":self.location="/ditem_list/new_list";break;default:_GLOBAL_VAR.lists[e].checked=!0,doAddToList()}}function doAddToList(){var t=whichBChecked();if(0==t.length)return flashNotice2(ALE_20),resetAddToList(),!1;var i=whichBListChecked();if(0==i.length)return flashNotice2(ALE_36),resetAddToList(),!1;for(var e=[],n=0;n<i.length;n++)e.push(i[n].id);var o=[];for(n=0;n<t.length;n++)-1==t[n].lists_id.indexOf(e[0])&&o.push(t[n].link_id);if(0==o.length||0==e.length)return resetListChecked(),resetAddToList(),!1;var a=$H({link_id_a:o,list_id_a:e});return lockAddToList(),showCentralNoticer(DIS_10),new Ajax.Request("/ditem_outliner/add_to_outliner",{asynchronous:!0,evalScripts:!1,onComplete:function(e){doAddToListComplete(e,t,i)},parameters:"infos="+a.toJSON()}),!1}function doAddToListComplete(e,t,i){if(hideCentralNoticer(),resetAddToList(),resetListChecked(),resetAllChecker(),"200"==e.status){for(var n=[],o=0;o<i.length;o++)n.push("<a style='text-decoration:underline;' href='"+i[o].uri+"'>"+i[o].title+"</a>");flashNotice2("Added to Outliner: "+n.join(", ")+" successfully!");var a=[];for(o=0;o<i.length;o++)a.push(i[o].id);for(o=0;o<t.length;o++)t[o].lists_id=t[o].lists_id.concat(a).uniq(),renderBelongTo(t[o].index)}else alert(EXC_1)}function resetListChecked(){_GLOBAL_VAR.lists.each(function(e){e.checked=!1})}function lockAddToList(){for(var e=0;e<2;e++){var t=$("addToList_"+e);t&&(t.disabled=!0)}}function resetAddToList(){for(var e=0;e<2;e++){var t=$("addToList_"+e);t&&(t.value="-1",t.disabled=!1,t.blur())}}function switchSearchHelper(){var e=loadCusData();"none"==$("searchHelper").style.display?(switch2HelperMode(),e.adSearch="1"):(switch2SimpleMode(),e.adSearch="0"),e.store()}function switch2HelperMode(){var e=$("whatHolder"),t=$("searchHelper"),i=$("searchTips");e.style.display="none",t.style.display="",i.style.display="none",_GLOBAL_VAR.adSearch="1",decodeAdSyntax("_dwhat")}function switch2SimpleMode(){var e=$("whatHolder"),t=$("searchHelper"),i=$("searchTips");e.style.display="",t.style.display="none",i.style.display="none",_GLOBAL_VAR.adSearch="0"}function initAdSearchBar(){return"1"==defFullTextSearchMode?(switch2HelperMode(),!0):"0"==defFullTextSearchMode?(switch2SimpleMode(),!0):void("1"==loadCusData().adSearch?switch2HelperMode():switch2SimpleMode())}function doFSearch2(){var e=$F("_dwhat").trim();e="0"==_GLOBAL_VAR.adSearch?$F("_dwhat").trim():encodeAdSyntax();var t=$F("_dsscope").trim(),i="";return i=-1!=self.location.href.indexOf("sa=Search")?self.location.href.replace(/q=.+&/,"q="+e+"&"):"/search?adSScope="+t+"&what="+encodeURIComponent(e),self.location=i,!1}function filterItemsTags(e){this.temItemIndex=-1,this.clearItems();var t=e.length,i=this.inputField.value;if(-1!=i.lastIndexOf(" ")?i=i.substring(i.lastIndexOf(" ")+1,i.length):-1!=i.lastIndexOf(",")&&(i=i.substring(i.lastIndexOf(",")+1,i.length)),""==i)return!1;for(var n=0,o=new RegExp("^("+i.replace(/\+/g,"&#43;").replace(/\./g,"\\.")+").*","i"),a=0;a<t;a++){var s=this.items[a].tName;if(o.test(s)){this.lockSubmit();var r=document.createElement("li");r.className="mouseOut",r.id=this.itemPrefix+"Item_"+n,r.name=a,r.object=this,r.onclick=function(){this.object.populateItems(this),this.object.inputField.focus();try{var e=this.object.inputField.up();e&&e.onsubmit()}catch(e){}},r.onmouseout=function(){this.className="mouseOut"},r.onmouseover=function(){this.className="mouseOver",this.object.temItemIndex=parseInt(this.name)};var l=new String(s);-1!=l.indexOf(" ")&&(l='"'+l+'"'),r.innerHTML=l,this.completeDiv.appendChild(r),n++}}document.getElementById(this.itemPrefix+"Item_"+(this.temItemIndex+1))&&(this.completeDiv.style.display="",this.setOffsets())}function autoCompletePopulateTag(e){if(!e)return!1;this.updateInput(e.innerHTML),this.clearItems()}function enabledSaveItemTagSuggestion(suggestionElID){var autoCompleteTag=new AutoComplete(suggestionElID,"popupTag","");autoCompleteTag.autoSizeInput=!1,autoCompleteTag.filterItems=filterItemsTags,autoCompleteTag.populateItems=autoCompletePopulateTag,_GLOBAL_VAR.my_all_tags?(autoCompleteTag.items=_GLOBAL_VAR.my_all_tags,autoCompleteTag.turnOn()):new Ajax.Request("/tag_mana2/load_user_tags",{asynchronous:!0,evalScripts:!1,onComplete:function(request){"200"==request.status&&(_GLOBAL_VAR.my_all_tags=eval(request.responseText),autoCompleteTag.items=_GLOBAL_VAR.my_all_tags,autoCompleteTag.turnOn())}})}function initAutoCompleteTag(){var e=new AutoComplete("tagsCrumbInput","popupTag","tagCrumbSubmit");e.filterItems=filterItemsTags,e.populateItems=autoCompletePopulateTag,e.items=_GLOBAL_VAR.tags,e.turnOn()}function showNoticer(e,t){e.show(),e.update(t)}function hideNoticer(e){e.hide()}function changeListCount(e){var t=loadCusData();t.count=e,t.store(),self.location.reload()}function clickFollowMeOnTwitter(){var e=loadCusData();e.followMe="yes",e.store()}function isFollowedMeOnTwitter(){return"yes"==loadCusData().followMe}function setDefaultEC(e){var t=loadCusData();t.default_ec="13"==e?"1":"0",t.store(),resetMoreAction()}function switchPreview(e,t,i){var n=$(e);null==i&&(i=1);var o=$("b_preview_box_"+t);o?"none"==o.style.display?o.style.display="":o.style.display="none":createPreviewBox(n,t,i)}function hidePreiview(){$("b_preview_box_"+arguments[0]).style.display="none"}function createPreviewBox(e,t,i){try{var n=$("ditemItem_"+t).select(".ditemTitleArea")[0],o=new Element("div",{className:"previewBox",id:"b_preview_box_"+t}),a=new Element("div",{className:"previewBar"}),s=new Element("a",{className:"pCloser",href:"javascript:void(0);"}).update("Close");s.onclick=hidePreiview.bind(s,t),a.appendChild(s);var r=new Element("a",{rel:"nofollow",className:"pNewWindow",href:_GLOBAL_VAR.ditems[t].url,target:"_blank"}).update("New window");r.onclick=hidePreiview.bind(s,t),a.appendChild(r),o.appendChild(a);var l=new Element("div",{className:"previewInner"}),d=_GLOBAL_VAR.ditems[t].url;l.appendChild(new Element("iframe",{className:"previewIFrame",id:"b_preview_"+t,frameBorder:"0",src:d})),o.appendChild(l),Element.insert(n,{after:'<div id="b_preview_outter_'+t+'"></div>'}),$("b_preview_outter_"+t).appendChild(o)}catch(e){}}function doHideStickyNoteLoading(e,t){$("sticky_"+t).style.backgroundColor="#eee";var i=$("hideStickyNote_"+t);i.innerHTML=WORD_3,i.onclick=null}function doHideStickyNoteComplete(e,t){if("200"==e.status){var i=t.split("_"),n=_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].mode;if(delete _GLOBAL_VAR.ditems[i[0]].annotations[i[1]].stickyNotes[i[2]],_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].s_count--,"0"==n?_GLOBAL_VAR.ditems[i[0]].pub_sticky_count--:_GLOBAL_VAR.ditems[i[0]].pri_sticky_count--,refreshDetailsCount(i[0]),_GLOBAL_VAR.ditems[i[0]].annotations[i[1]].s_count<=0){$("sticky_"+i[0]+"_"+i[1]).style.display="none",changeHighlightColor(i[0]+"_"+i[1],2);var o=$("removeA_"+i[0]+"_"+i[1]);o&&(o.style.display="")}Element.remove("sticky_"+t),countDetails(i[0])}}function doHideComment(t){var e=t.split("_"),i=_GLOBAL_VAR.ditems[e[0]].comments[e[1]].id;try{var n="id="+i;return new Ajax.Request("/my_site/hide_comment",{onLoading:function(e){doHideCommentLoading(e,t)},onComplete:function(e){doHideCommentComplete(e,t)},parameters:n}),!1}catch(e){return!1}}function doHideCommentLoading(e,t){$("comment_"+t).style.backgroundColor="#eee";var i=$("hideComment_"+t);i.innerHTML=WORD_3,i.onclick=null}function doHideCommentComplete(e,t){if("200"==e.status){var i=t.split("_"),n=_GLOBAL_VAR.ditems[i[0]].comments[i[1]].mode;delete _GLOBAL_VAR.ditems[i[0]].comments[i[1]],_GLOBAL_VAR.ditems[i[0]].c_count--,"0"==n.mode?_GLOBAL_VAR.ditems[i[0]].pub_c_count--:_GLOBAL_VAR.ditems[i[0]].pri_c_count--,refreshDetailsCount(i[0]),Element.remove("comment_"+t),countDetails(i[0])}}function forwardItem(n){var o;if("list"==n.type){(o=new PopWindow({optEnabled:!0,center:!0,top:20,width:500,title:"Send"})).submitBtn.value="Send",o.cancelBtn.value="Cancel"}else if("ditem"==n.type){n.index_a;1==n.index_a.length&&"ditemItem_"+n.index_a[0],(o=new PopWindow({optEnabled:!0,center:!0,top:20,fixTop:-100,width:500,title:"Send To"})).submitBtn.value="Send",o.cancelBtn.value="Cancel",o.cancel=function(){resetMoreAction(),resetAllChecker()}}if(o.onLoading(),"ditem"==n.type){for(var e=[],a={},t=0;t<n.index_a.length;t++)_GLOBAL_VAR.ditems[n.index_a[t]].share_link||"bookmark"!==_GLOBAL_VAR.ditems[n.index_a[t]].typeName&&(e.push(_GLOBAL_VAR.ditems[n.index_a[t]].link_id),a[_GLOBAL_VAR.ditems[n.index_a[t]].link_id]=_GLOBAL_VAR.ditems[n.index_a[t]]);0<e.length?new Ajax.Request("/item/get_share_url",{asynchronous:!0,evalScripts:!1,onComplete:function(e){var t=JSON.parse(e.responseText);for(var i in t)a[i].share_link=t[i].shared_url;o.appendNode(loadForwardTemp(n))},parameters:"link_id_a="+encodeURIComponent(e.join())}):o.appendNode(loadForwardTemp(n))}else o.appendNode(loadForwardTemp(n));if(o.submit=function(){var e=$("sendToSelector").value,t={};switch(e){case"all":t.send_type="all";break;case"some":t.send_type="some",t.send_to=_GLOBAL_VAR[_GLOBAL_VAR.bACCID+"_instance"].getRecItems();break;case"myself":t.send_type="myself",t.send_to=e;break;default:t.send_type="list",t.send_to=e}t.privacy="private";var i=$("forwardForm");return t.subject=i.subject.value,t.message=i.message.value,"ditem"==n.type?($A($("forwardPreview").getElementsByClassName("eSTail")).each(function(e){e.remove()}),t.quotes=$("forwardPreview").innerHTML):"list"==n.type&&(t.quotes=$("forwardPreview").innerHTML),this.onLoading(),new Ajax.Request("/message_mana/send_msg",{asynchronous:!0,evalScripts:!1,onComplete:function(e){PopWindow.instance.onComplete({status:e.status,msg:"message sent"}),resetMoreAction(),resetAllChecker()},parameters:"json="+encodeURIComponent(Object.toJSON(t))}),!1}.bind(o),!ACContact.contacts||0==ACContact.contacts.length){o.onLoading();return new Ajax.Request("/user_mana2/load_contacts",{asynchronous:!0,evalScripts:!1,method:"get",onComplete:function(e){if("200"==e.status){var t=e.responseText.evalJSON();_GLOBAL_VAR[_GLOBAL_VAR.bACCID+"_instance"]=new ACContact({rec:$(_GLOBAL_VAR.bACCID),contacts:t,showTipInBox:!1}),initContactsSelect(),PopWindow.instance.noticer.hide(),PopWindow.instance.content.show(),PopWindow.instance.opt.show(),PopWindow.instance.reCalShadowRange()}}}),!1}_GLOBAL_VAR[_GLOBAL_VAR.bACCID+"_instance"]=new ACContact({rec:$(_GLOBAL_VAR.bACCID),showTipInBox:!1}),initContactsSelect(),PopWindow.instance.noticer.hide(),PopWindow.instance.content.show(),PopWindow.instance.opt.show(),PopWindow.instance.reCalShadowRange()}function loadForwardTemp(e){var t=new Element("table",{id:"forwardTable"}),i=new Element("tbody"),n=new Element("tr",{style:"display:none"});n.appendChild(new Element("th").update("Send to:"));var o=new Element("td",{id:"sendToTD"});n.appendChild(o),n.appendChild(o),i.appendChild(n),(n=new Element("tr",{id:"contactRow"})).appendChild(new Element("th").update("Send to:")),o=new Element("td",{colspan:"2"});var a=new Element("div",{className:"accOuter"});a.appendChild(new Element("div",{id:_GLOBAL_VAR.bACCID,className:"inputTxt2"}).hide()),o.appendChild(a),n.appendChild(o),i.appendChild(n),(n=new Element("tr",{id:"subjectRow"})).appendChild(new Element("th").update("Subject:"));var s=new Element("input",{type:"text",name:"subject",maxlength:255,className:"inputTxt2"});"ditem"==e.type?s.value=_GLOBAL_VAR.ditems[e.index_a[0]].title:"list"==e.type&&(s.value=_GLOBAL_VAR.list.title),(o=new Element("td",{colspan:"2"})).appendChild(s),n.appendChild(o),i.appendChild(n),(n=new Element("tr")).appendChild(new Element("th").update("Message:")),i.appendChild(n),n=new Element("tr"),(o=new Element("td",{colspan:"3"})).appendChild(new Element("textarea",{name:"message",className:"inputTxt2"})),n.appendChild(o),i.appendChild(n),t.appendChild(i);var r=new Element("form",{id:"forwardForm"});r.setAttribute("autocomplete","off"),r.appendChild(t);var l=new Element("div",{id:"forwardPreview"});return"ditem"==e.type?l.appendChild(loadAnnotations(e.index_a)):"list"==e.type&&(l.setStyle({height:"1%"}),2==_GLOBAL_VAR.list.mode?l.update("<p><a href='"+BOOKMARK_HOST+"/list?token="+_GLOBAL_VAR.token+"'>"+_GLOBAL_VAR.list.title+" "+BOOKMARK_HOST+"/list?token="+_GLOBAL_VAR.token+"</a></p><p>"+_GLOBAL_VAR.list.desc+"</p>"):l.update("<p><a href='"+BOOKMARK_HOST+"/list/"+_GLOBAL_VAR.username+"/"+_GLOBAL_VAR.list.uri+"'>"+_GLOBAL_VAR.list.title+" "+BOOKMARK_HOST+"/list/"+_GLOBAL_VAR.username+"/"+_GLOBAL_VAR.list.uri+"</a></p><p>"+_GLOBAL_VAR.list.desc+"</p>")),r.appendChild(l),r}function shareItem(n){var e;if("list"==n.type);else if("ditem"==n.type){var t=n.index_a,i="leftColumn";1==n.index_a.length&&(i="ditemItem_"+n.index_a[0]),(e=new PopWindow({optEnabled:!0,left:120,top:20,width:500,title:"Share with my friends on Diigo",root:i})).cancel=function(){resetMoreAction(),resetAllChecker()},t.each(function(e){switchDetails(e,"collapse")})}if(e.appendNode(loadShareItemTemp(n)),e.submit=function(){var e=$("shareItemToSelector").value,t=_GLOBAL_VAR.ditems[n.index_a[0]].link_id,i=null;return i=-2==e?"&link_id="+t:"list="+e+"&link_id="+t,this.onLoading(),new Ajax.Request("/contact/share_ditem_to_list",{asynchronous:!0,evalScripts:!1,onComplete:function(e){PopWindow.instance.onComplete({status:e.status}),resetMoreAction(),resetAllChecker()},parameters:i}),!1}.bind(e),!_GLOBAL_VAR.contactLists){e.onLoading();return new Ajax.Request("/user_mana2/load_contact_lists",{asynchronous:!0,evalScripts:!1,method:"get",onComplete:function(e){if("200"==e.status){var t=e.responseText.evalJSON();_GLOBAL_VAR.contactLists=t,initShareToCLSelect(),PopWindow.instance.noticer.hide(),PopWindow.instance.content.show(),PopWindow.instance.opt.show(),PopWindow.instance.reCalShadowRange()}}}),!1}initShareToCLSelect()}function initShareToCLSelect(){var e=$("shareItemToContactTD");if(0==_GLOBAL_VAR.contactLists.length)e.appendChild(new Element("a",{href:"/contact/new_list"}).update("No contact list. You can create one now.")),$("wOptions").hide();else{var t=new Element("select",{id:"shareItemToSelector"});t.appendChild(new Element("option",{value:"-2"}).update("All Friends"));for(var i=new Element("optgroup",{label:"Or Friends in a Contact List"}),n=0;n<_GLOBAL_VAR.contactLists.length;n++){var o=_GLOBAL_VAR.contactLists[n],a=new Element("option",{value:o.id}).update(o.extra.title);i.appendChild(a)}t.appendChild(i),1<_GLOBAL_VAR.contactLists.length&&t.appendChild(new Element("option",{value:-1}).update("------------")),t.appendChild(new Element("option",{value:-2}).update("Create a Contact List...")),e.appendChild(t),t.value=-2}}function loadShareItemTemp(e){var t=new Element("table",{id:"shareItemTable"}),i=new Element("tbody");tr=new Element("tr"),tr.appendChild(new Element("th")),td=new Element("td",{id:"shareItemToContactTD"}),tr.appendChild(td),i.appendChild(tr),t.appendChild(i);var n=new Element("form",{id:"shareItemForm"});return n.setAttribute("autocomplete","off"),n.appendChild(t),n}function likeThisLink(o,a){var s=this.id;return showCentralNoticer(DIS_10),new Ajax.Request("/item_mana/like_link",{asynchronous:!0,evalScripts:!1,parameters:{link_id:o,ouid:a},onComplete:function(e){if(hideCentralNoticer(),"200"==e.status){var t=$(s);t.innerHTML=t.innerHTML.replace("Like","Unlike"),t.addClassName("unlike"),t.removeClassName("like"),t.onclick=function(){a?unlikeThisLink.bind(this)(o,a):unlikeThisLink.bind(this)(o)};var i=e.responseText.evalJSON(),n=$("likeSpan_"+i.link_id);n&&(n.innerHTML=i.value,n.show())}}}),!1}function unlikeThisLink(o,a){var s=this.id;return showCentralNoticer(DIS_10),new Ajax.Request("/item_mana/unlike_link",{asynchronous:!0,evalScripts:!1,parameters:{link_id:o},onComplete:function(e){if(hideCentralNoticer(),"200"==e.status){var t=$(s);t.innerHTML=t.innerHTML.replace("Unlike","Like"),t.removeClassName("unlike"),t.addClassName("like"),t.onclick=function(){a?likeThisLink.bind(this)(o,a):likeThisLink.bind(this)(o)};var i=e.responseText.evalJSON(),n=$("likeSpan_"+i.link_id);n&&(n.innerHTML=i.value,""==i.value&&n.hide())}}}),!1}function enableBatchActions(){for(var e=0;e<_GLOBAL_VAR.ditems.length;e++){$("ditemChecker_"+e)&&($("ditemChecker_"+e).style.visibility="visible")}$("ditemCheckerAll").style.visibility="visible";var t=$("moreAction_0");t&&(t.style.visibility="visible");var i=$("shareToGroup_0");i&&(i.style.visibility="visible");var n=$("addToList_0");n&&(n.style.visibility="visible")}function getViewport(){var e,t;return t=void 0!==window.innerWidth?(e=window.innerWidth,window.innerHeight):void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?(e=document.documentElement.clientWidth,document.documentElement.clientHeight):(e=document.getElementsByTagName("body")[0].clientWidth,document.getElementsByTagName("body")[0].clientHeight),[e,t]}function readBookmark(e){openBookmarkReader(e)}function closeBookmarkReader(){Modalbox.hide(),window.onresize=null}function openBookmarkReader(e){var t=new Element("div",{id:"bReader"}),i=new Element("div",{id:"bReaderNavi"});i.update('<table><tr><td id="bReaderPagination"></td><td id="bReaderTitle"></td><td id="bReaderActions"></td></tr></table>'),t.appendChild(i);var n=new Element("div",{id:"bReaderInner"});n.appendChild(new Element("iframe",{id:"bReaderIframe",frameBorder:"0"})),t.appendChild(n);var o=new Element("div",{id:"bReaderBetaInfo",class:"alert_info"});o.update('<b></b> Text View is a beta feature. <a target="_blank" href="http://blog.diigo.com/2010/09/13/introduce-text-view-for-better-readability">Learn more &raquo;</a>'),t.appendChild(o),Modalbox.show(t,{title:"",width:750,overlayOpacity:.8}),$("bReaderActions").update('<a id="bReaderClose" title="Close" href="javascript:void(0)" onclick="closeBookmarkReader();"></a><a id="bReaderNewWindow" title="Open this page in new window" target="_blank" href="'+_GLOBAL_VAR.ditems[e].text_view_link+'"></a>'),$("bReaderPagination").update('<a id="bReaderPrevItem" title="Previous" href="javascript:void(0)"></a><a id="bReaderNextItem" title="Next" href="javascript:void(0)"></a>');var a=getViewport();$("bReaderIframe").setStyle({height:a[1]-130+"px",width:"100%"}),Modalbox.resizeToContent(),window.onresize=function(){var e=getViewport();$("bReaderIframe")&&$("bReaderIframe").setStyle({height:e[1]-100+"px"}),Modalbox.resizeToContent()},$("MB_content").setStyle({border:"none"}),$("MB_frame").setStyle({borderTopLeftRadius:0,borderTopRightRadius:0,backgroundColor:"#f5f5f5",paddingBottom:"3px"}),updateReadBookmarkItem(e)}function updateReadBookmarkItem(e){$("bReaderIframe").src=_GLOBAL_VAR.ditems[e].text_view_link+"&view=embeded",$("bReaderTitle").update('<a title="'+_GLOBAL_VAR.ditems[e].title+'" href="'+_GLOBAL_VAR.ditems[e].url+'">'+_GLOBAL_VAR.ditems[e].title.truncate(60)+"</a>"),$("bReaderNewWindow").href=_GLOBAL_VAR.ditems[e].text_view_link,_GLOBAL_VAR.ditems[e-1]&&_GLOBAL_VAR.ditems[e-1].text_view_link?($("bReaderPrevItem").title=_GLOBAL_VAR.ditems[e-1].title,$("bReaderPrevItem").onclick=updateReadBookmarkItem.bind(this,e-1),$("bReaderPrevItem").removeClassName("invalid")):($("bReaderPrevItem").title=null,$("bReaderPrevItem").onclick=null,$("bReaderPrevItem").addClassName("invalid")),_GLOBAL_VAR.ditems[e+1]&&_GLOBAL_VAR.ditems[e+1].text_view_link?($("bReaderNextItem").title=_GLOBAL_VAR.ditems[e+1].title,$("bReaderNextItem").onclick=updateReadBookmarkItem.bind(this,e+1),$("bReaderNextItem").removeClassName("invalid")):($("bReaderNextItem").title=null,$("bReaderNextItem").onclick=null,$("bReaderNextItem").addClassName("invalid"))}function SetCookie(e,t){delCookie(e);var i=new Date;i.setTime(i.getTime()+31536e6),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()+";path=/"}function GetCookie(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var i=GetCookie(e);null!=i&&(document.cookie=e+"="+i+";expires="+t.toGMTString()+";path=/")}function showTagCloud(){TAGCLOUD&&1<TAGCLOUD.length&&new PopWindow({optEnabled:!1,center:!0,top:0,width:900,title:"Select from your top 300 tags <a href='/cloud/"+_GLOBAL_VAR.username+"?sort=4'>View all tags</a><a href='/cloud/"+_GLOBAL_VAR.username+"'>Edit tags</a>",root:this,overflow:!0}).appendNode(getTagCloudDom())}function getTagCloudDom(){for(var e=getTagCloudInfo(),t=new Element("div",{className:"popTagCloud"}).update(""),i=new Element("ul",{className:"tagCloud"}),n=e.length,o=0;o<n;o++){var a;a=/\s/.test(e[o].tName)?'"'+e[o].tName+'"':e[o].tName;var s=new Element("li").update("<a title='"+e[o].count+" bookmarks by myself' class='"+e[o].level+"' href='/user/"+_GLOBAL_VAR.username+"/"+encodeURI(a)+"?"+_GLOBAL_VAR.url_params_tail+"'>"+e[o].tName+"</a>");i.appendChild(s)}return t.appendChild(i),t}function getTagCloudInfo(){if(_GLOBAL_VAR.tagcloud)return _GLOBAL_VAR.tagcloud;if("no_tag"==TAGCLOUD[0].tName)var e=TAGCLOUD[1].count;else e=TAGCLOUD[0].count;for(var t=TAGCLOUD[TAGCLOUD.length-1].count,i=TAGCLOUD.length,n=0;n<i;n++)TAGCLOUD[n].level=getTagCloudLevel(TAGCLOUD[n].count,e,t);return TAGCLOUD.sort(function(e,t){return e.tName.toLowerCase()<=t.tName.toLowerCase()?-1:1}),_GLOBAL_VAR.tagcloud=TAGCLOUD,_GLOBAL_VAR.tagcloud}function getTagCloudLevel(e,t,i){var n=parseInt(i),o=parseInt(t)-n+1;if(count=parseInt(e)-n+1,count<1&&(count=1),o==(n=1))return"popular";var a=Math.round((Math.log(count)-Math.log(n))/(Math.log(o)-Math.log(n))*5);switch(5<a&&(a=5),a){case 0:return"notPopular";case 1:return"notVeryPopular";case 2:return"someWhatPopular";case 3:return"popular";case 4:return"veryPopular";case 5:return"ultraPopular"}}function newList(){var e=new PopWindow({optEnabled:!0,center:!0,top:0,width:500,title:"Create a new List",root:this});e.appendNode(createNewListTemp()),e.submitBtn.value="Create","list"==window.location.pathname.slice(1,5)?e.submit=function(){document.listForm&&document.listForm.submit()}:e.submit=function(){createListByShareContextMenu(Form.serialize($$("form[name=listForm]")[0])),e.hide()}}function createNewListTemp(){var e=new Element("form",{action:"/ditem_list/save_list",method:"post",name:"listForm"}),t=new Element("div",{className:"newlistForm"}).update('<div class="formTitle"><input placeholder="Name" class="inputTxt" type="text" autocomplete="off" name="title"></div><div class="formPrivacy"><span class="r_public"><input type="radio" id="public" name="privacy" checked="checked" value="0" /><label for="public" class="radioLabel">Public</label></span><span class="r_private"><input type="radio" id="private" name="privacy" value="2"><label for="private" class="radioLabel"><b></b>Private</label></span></div><div class="formDesc"><textarea class="inputTxt" name="desc" placeholder="Add a description"></textarea></div>');return e.appendChild(t),e}var createListIsSending=!1;function createListByShareContextMenu(e){var t="";if($("listName")&&(t=$("listName").value),0<t.trim().length||e){var i=$H({title:t,desc:""});e&&(i=e);if(createListIsSending)return;createListIsSending=!0,new Ajax.Request("/ditem_outliner/create_outliner",{asynchronous:!0,evalScripts:!1,onComplete:function(e){if(createListIsSending=!1,"403"!=e.responseText){if(200==e.status){var t=JSON.parse(e.responseText),i=_GLOBAL_VAR.lists.length;insertListinfo({id:t.list_id,index:i,title:t.title,uri:t.uri,mode:t.privacy})}}else outlinerLimit()},parameters:i})}}function insertListinfo(e){if(_GLOBAL_VAR.lists.push(e),_GLOBAL_VAR.my_lists&&_GLOBAL_VAR.my_lists.push(e),e.title=_safeHTML(e.title),$("listName")){$("listName").value="";var t=$("addToListMenu"),i=t.select("hr")[0],n=new Element("li").update("<a href=\"javascript:doAddToListAction('"+e.index+"')\">"+e.title+"</a>");console.log(n),t.insertBefore(n,i.nextSibling)}var o=$("addToListSelector");if(o){var a=new Element("option",{value:e.index}).update(e.title);o.appendChild(a),$("addToListSelector").value=e.index,$("addListInputHolder").hide(),$("addToListSelector").show(),$("newListInEdit").value=""}}function _safeHTML(e){return e=(e=e.replace(/</g,"&lt;")).replace(/>/g,"&gt;")}function outlinerLimit(){jQuery('<div><a href="/premium/pricing_table_details">Upgrade your plan to create more outliners.</a></div>').diigoWP({title:"Upgrade your plan"}).show()}var Util={string:function(i){return i=String(i),{interpolate:function(e){for(var t in e)i=this.replace("#{"+t+"}").by(e[t]);return i},replace:function(t){return{by:function(e){return i.split(t).join(e)}}}}}},INPAGE_IMAGE_UPLOAD='<div class="imageupload_wrap"><div class="imageupload"></div><div class="clear"></div></div>',INPAGE_IMAGE_UPLOAD_TEMPLATE='<script type="text/template" id="qq-simple-thumbnails-template"><div class="qq-uploader-selector qq-uploader"><div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone><span>Drop files here to upload</span></div><ul class="qq-upload-list-selector qq-upload-list"><li><div class="qq-progress-bar-container-selector"><div class="qq-progress-bar-selector qq-progress-bar"></div></div><span class="qq-upload-spinner-selector qq-upload-spinner"></span><img class="qq-thumbnail-selector" qq-max-size="200"><a class="qq-upload-cancel-selector qq-upload-cancel"></a><a class="qq-upload-retry-selector qq-upload-retry"></a><span class="qq-hide error-message"></span><span class="qq-hide success-message"><b>&nbsp;</b></span></li></ul><div class="qq-upload-button-selector qq-upload-button"><div class="qq-add-image-button"></div></div></div><\/script>',INPAGE_NEW_BOOKMARK='<div class="newBookmark_wrap"><div class="nb_url hori-form"><label>URL:</label><div class="controls"><input class="inputText urlInput" name="url" placeholder="Paste a URL you want to save here"></div></div><div class="nextButton"><button class="btn blue getDetailButton">Next</button><div class="loading"></div><div class="clear"></div></div><div class="moreDetail"><div class="nb_title hori-form"><label>Title:</label><div class="controls"><div class="title_loading"></div><input class="inputText titleInput" name="url"></div></div><div class="actions"><label class="placeholder">&nbsp;</label><div class="controls"><label><input id="newItemPrivate" type="checkbox"><b class="PrivateIcon"></b>Private</label><label><input type="checkbox" id="newItemUnread"><b class="RLIcon"></b>Read Later</label></div></div></div></div>',INPAGE_NEW_PDF='<div class="newPdf_wrap"><div class="pdfupload"></div><div class="clear"></div></div>',INPAGE_NEW_PDF_TEMPLATE='<script type="text/template" id="qq-simple-pdf-template"><div class="qq-uploader-selector qq-uploader"><div class="qq-upload-button-selector qq-upload-button"><div class="qq-add-image-button btn blue">Choose PDF</div></div><div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone><span>Drop files here to upload</span></div><ul class="qq-upload-list-selector qq-upload-list"><li><div class="qq-progress-bar-container-selector"><div class="qq-progress-bar-selector qq-progress-bar"></div></div><span class="qq-upload-spinner-selector qq-upload-spinner"></span><span class="qq-upload-file-selector qq-upload-file" title="Edit title"></span><input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text"><a class="qq-upload-cancel-selector qq-upload-cancel">cancel</a><a class="qq-upload-retry-selector qq-upload-retry">Retry</a><span class="qq-hide success-message"><b>&nbsp;</b></span><span class="qq-hide error-message">Upload Error</span></li></ul></div><\/script>',INPAGE_NEW_NOTE='<div class="newNote_wrap"><div class="noteArea"><div class="titleArea"><input class="noteTitle" name="title" placeholder="Title"></div><div class="contentArea"><textarea class="noteContent" name="content" id="noteContentArea"></textarea></div><div class="toolbarArea"></div></div></div>',INPAGE_NEW_NOTE_TOOLBAR='<div id="editor-toolbar" style="display: none" class="editor-toolbar"><div data-c-d="insertImage" class="insertImageDialog"><div class="a_a"><div class="a_a_s"><div class="a_a_s_input"><input type="search" class="searchinput"></div></div><div class="holder"></div><div class="a_a_list"><span class="a_a_search"></span><span class="a_a_close"></span></div></div><div class="gallery"><div class="select"><div class="other"><div id="insertLocal" title="select image form local"></div><div class="insertLocalUploading"></div><div class="insertByUrl" title="insert image by URL"><span></span></div></div><div class="slider"><div class="leftarrow"></div><div class="rightarrow"></div><div class="l_images"><ul></ul></div></div></div><div class="insertUrl"><input type="text" name="imageurl" class="imageUrlInput" placeholder="Paste image url"/><button class="btn blue i_i_b">Insert</button></div></div></div><div data-wysihtml5-dialog="createLink" style="display: none;" class="dialog"><label>Link:<input data-wysihtml5-dialog-field="href" class="inputText" value="http://"></label><a data-wysihtml5-dialog-action="save" class="btn blue">OK</a>&nbsp;<a data-wysihtml5-dialog-action="cancel" class="btn">Cancel</a></div><span class="command fontNameCommand" data-toggle="dropdown"><span class="commandTitle fontNameTitle"><b></b><span class="fnt_t">Tahoma</span></span><ul class="commandMenu fontName popupMenu" role="menu"><li data-wysihtml5-command="fontName" data-wysihtml5-command-value="narrow" class="commandMenu">Narrow</li><li data-wysihtml5-command="fontName" data-wysihtml5-command-value="tahoma" class="commandMenu">Tahoma</li><li data-wysihtml5-command="fontName" data-wysihtml5-command-value="comicsans" class="commandMenu">comic sans ms</li><li data-wysihtml5-command="fontName" data-wysihtml5-command-value="helvetica" class="commandMenu">Helvetica</li></ul></span><span class="split"></span><span class="command" data-toggle="dropdown"><span class="commandTitle fontSizeTitle"><b></b><i></i></span><ul class="commandMenu fontSize popupMenu" role="menu"><li data-wysihtml5-command="fontSize" data-wysihtml5-command-value="smaller" class="commandMenu smaller">Small</li><li data-wysihtml5-command="fontSize" data-wysihtml5-command-value="medium" class="commandMenu medium">Normal</li><li data-wysihtml5-command="fontSize" data-wysihtml5-command-value="large" class="commandMenu large">Large</li><li data-wysihtml5-command="fontSize" data-wysihtml5-command-value="x-large" class="commandMenu x-large">Huge</li></ul></span><span class="split"></span><a data-wysihtml5-command="bold" class="command"><i></i></a><a data-wysihtml5-command="italic" class="command"><i></i></a><a data-wysihtml5-command="underline" class="command"><i></i></a><span class="command" data-toggle="dropdown"><span class="commandTitle foreColorTitle"><b></b><i></i></span><ul class="commandMenu foreColor popupMenu" role="menu"><a data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red" class="commandColor"><i></i></a><a data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue" class="commandColor"><i></i></a><a data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple" class="commandColor"><i></i></a><a data-wysihtml5-command="foreColor" data-wysihtml5-command-value="fuchsia" class="commandColor"><i></i></a><a data-wysihtml5-command="foreColor" data-wysihtml5-command-value="lime" class="commandColor"><i></i></a><a data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive" class="commandColor"><i></i></a><a data-wysihtml5-command="foreColor" data-wysihtml5-command-value="yellow" class="commandColor"><i></i></a></ul></span><span class="split"></span>\x3c!--<a data-wysihtml5-command="justifyRight" class="command">Right</a>--\x3e<a data-wysihtml5-command="insertOrderedList" class="command"><i></i></a><a data-wysihtml5-command="insertUnorderedList" class="command"><i></i></a><a data-wysihtml5-command="Indent" class="command"><i></i></a><a data-wysihtml5-command="Outdent" class="command"><i></i></a>\x3c!--<a data-wysihtml5-command="removeFormat" class="command"><i></i></a>--\x3e<a data-c="insertImage" class="command"><i></i></a><a data-wysihtml5-command="createLink" class="command"><i></i></a></div>',INPAGE_NEW_NOTE_UPLOAD_IMAGE_TEMP='<script type="text/template" id="qq-simple-template"><div class="qq-uploader-selector qq-uploader"><div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone><span>Drop files here to upload</span></div><ul class="qq-upload-list-selector qq-upload-list qq-hide"><li><div class="qq-progress-bar-container-selector"><div class="qq-progress-bar-selector qq-progress-bar"></div></div><span class="qq-upload-spinner-selector qq-upload-spinner"></span><img class="qq-thumbnail-selector" qq-max-size="200"><a class="qq-upload-cancel-selector qq-upload-cancel"></a><a class="qq-upload-retry-selector qq-upload-retry"></a><span class="qq-hide error-message"></span><span class="qq-hide success-message"><b>&nbsp;</b></span></li></ul><div class="qq-upload-button-selector qq-upload-button"><div class="qq-add-image-button"></div></div></div><\/script>',NEW_ITEM_DES_TEMPLATE='<div class="itemDes"><div class="itemDescriptionArea"><p class="desTitle"></p><textarea class="inputText desInput" name="desc" placeholder="Add description"></textarea></div><p class="desTitle"></p><input class="inputText tagInput" placeholder=\'Add tags, space separated. Use " " for tag with multiple words.\' autocomplete="off" name="tags" maxlength="255"><div class="recommendedTags"></div><div class="shareto"><div class="addToListHolder"></div><div class="addToGroupHolder"></div></div><div class="Submit"><div class="privacy"><label><input id="newItemPrivate" type="checkbox"><b class="PrivateIcon"></b>Private</label></div><button class="btn blue submit">#{submit}</button><div class="clear"></div></div><div class="clear"></div></div>',DIIGO_WINDOW_POPUP_WRAP='<div class="y_WP"><div class="y_WP_main"><div class="y_WP_header"><span class="y_WP_closeButton"><b>&nbsp;</b></span><span class="y_WP_title">#{title}</span></div><div class="y_WP_wrap"></div></div></div>',IMAGE_POPUP_HTML_TEMPLATE='<div class="imageViewPopup" id="imageViewPopup"><div class="imageLeft imageCur"></div><div class="imageRight imageCur"></div><div class="closeButton"></div><div class="shareMenu"><ul><li><a class="s_facebook" title="share to facebook" href="javascript:void(0)" target="_blank"></a></li><li><a class="s_twitter" title="share to twitter" href="javascript:void(0)" target="_blank"></a></li><li><a class="s_googleplus" title="share to google+" href="javascript:void(0)" target="_blank"></a></li><li><a class="s_email" title="share with email " href="javascript:void(0)" target="_blank"></a></li><li><a class="s_link" title="get image link" href="javascript:void(0)" target="_blank"></a></li><li><a class="a_download" href="javascript:void(0)" title="download image" target="_blank"></a></li><li><a class="a_delete" title="delete image" href="javascript:void(0)" target="_blank"></a></li></ul></div><div class="imageInnerWrap"></div></div>',IMAGE_POPUP_INNER_HTML_TEMPLATE='<div class="imageInner"><img src="#{imgurl}" /></div>',IMAGE_POPUP_GET_LINK='<div class="imageGetLink"><div class="form"><label>Embedded URL:</label><div class="controls"><input class="inputText" name="url" value="#{emburl}"></div></div><div class="form"><label>Shareable URL:</label><div class="controls"><input class="inputText" name="url" value="#{surl}"></div></div></div>',NEW_USE_EXPERIENCE='<div class="newUserExpericeNew"><div class="TopPic"></div><div class="downloadInfo"><div class="d_button d_chrome"><a class="install_button " href="javascript:void(0)" target="_blank"></a></div><div class="d_button d_firefox"><a class="install_button " href="/diigoresources/downloads/diigotoolbar-firefox-new.xpi" ></a></div><div class="d_button d_diigolet"><a class="diigolet_button">Diigolet</a></div><div class="d_message"><p class="d_firefox d_chrome">Diigo extension provides the complete feature package for learners, including image capture and advanced notifications</p><div class="d_diigolet"><p>Make sure the "Bookmarks Bar" is visible.</p><p>drag this Diigolet directly to your browser bar. and start improving your learning right away!</p></div></div></div></div>';if(window.jQuery){var isEmail=function(e){return/^\w+([-.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(jQuery.trim(e))},isUserName=function(e){return/^[a-zA-Z]([0-9a-zA-Z\-_]{5,15})$/.test(jQuery.trim(e))},isPassword=function(e){return 6<=e.length&&e.length<=32},isAllNum=function(e){return/^[0-9]*$/.test(jQuery.trim(e))};jQuery.browser.isChrome=/chrome/.test(navigator.userAgent.toLowerCase()),jQuery.browser.isFirefox=/firefox/.test(navigator.userAgent.toLowerCase()),function(i){i.fn.extend({diigowf:function(e){return this.each(function(){this&&(this.controller?this.controller.setOption(e):i.isPlainObject(e)&&(this.controller=new t(this,e)))})}});var t=function(e,t){this.option=i.extend(!1,{item:"",columns:null,mh:20,mv:20,datasource:null},t),this.re=null,this._container=i(e),o.apply(this,[this.option.mh,this.option.mv]),n.apply(this)},n=function(){var e=this;i(window).on("resize.wf",function(){clearTimeout(e.re),e.re=setTimeout(function(){o.apply(e,[e.option.mh,e.option.mv])},200)})},o=function(e,t){var i=this,n=i._container.width(),o=i._container.find(i.option.item);if(!(o.length<1)){var a,s=o[0].offsetWidth+e;a=i.option.columns?i.option.columns:Math.floor(n/s);var r,l=o.length,d=[];for(r=0;r<l;r++)d.push(o[r].offsetHeight);var c=[];for(r=0;r<a;r++)o[r]&&(o[r].style.top="0",o[r].style.left=s*r+"px",o[r].style.opacity=1,c.push(d[r]));for(r=a;r<l;r++){var u=h(c);o[r].style.top=c[u]+t+"px",o[r].style.left=s*u+"px",o[r].style.opacity="1",c[u]=d[r]+c[u]+t}var p=m(c);this._container.height(p+40)}},m=function(e){var i=e[0];return e.forEach(function(e,t){i<e&&(i=e)}),i},h=function(e){var i=e[0],n=0;return e.forEach(function(e,t){e<i&&(i=e,n=t)}),n};t.prototype.setOption=function(e){if(i.isPlainObject(e))this.option=i.extend(!1,this.option,e);else if("string"==typeof e)switch(e){case"reload":this.reload()}},t.prototype.reload=function(){o.apply(this,[this.option.mh,this.option.mv])}}(jQuery),jQuery(".ditemImageGrid").diigowf({item:".ditemImageLi"}),function(i){i.fn.extend({diigoWP:function(e){return this.each(function(){this&&(this.controller?this.controller.setOption(e):i.isPlainObject(e)&&(this.controller=new t(this,e)))})}});var t=function(e,t){this.option=i.extend(!1,{title:"",width:600,height:null,top:100,scroll:!1,autoshow:!0,theme:"default",closeEvent:function(){}},t),n.apply(this,[e])},n=function(e){var t=this;t.W=i(Util.string(DIIGO_WINDOW_POPUP_WRAP).interpolate({title:t.option.title})),t.W.css("height",document.body.scrollHeight),t.W.find(".y_WP_wrap").html(e),"default"!=t.option.theme&&t.W.addClass(t.option.theme),o.apply(this)},o=function(){var e=this,t=s.apply(this,[this.option.height,this.option.width]);e.W.appendTo(document.body).css("display","none"),e.Wrap=e.W.find(".y_WP_main"),e.Wrap.css("position","absolute").css({width:t.width,left:t.left,top:t.top}),t.height&&e.Wrap.css("height",t.height),e.option.autoshow&&e.show(),a.apply(this)},a=function(){var t=this;t.W.find(".y_WP_closeButton").on("click",function(e){e.preventDefault(),t.remove()}),t.W.find(".y_WP_header").on("mousedown",function(e){}).on("mousemove",function(e){}).on("mouseup",function(e){})},s=function(e,t){var i=document.body.clientWidth,n=document.body.clientHeight,o=(i-t)/2;if(e)var a=(n-e)/2;else a=this.option.top;return a<this.option.top&&(a=this.option.top),{left:o,top:(document.body.scrollTop||document.documentElement.scrollTop)+a,width:t,height:e}};t.prototype.setOption=function(e){if(i.isPlainObject(e))this.option=i.extend(!1,this.option,e);else if("string"==typeof e)switch(e){case"show":this.show();break;case"hide":this.hide();break;case"remove":this.remove();break;case"exist":this.exist()}},t.prototype.show=function(){this.W.show()},t.prototype.hide=function(){this.option.closeEvent(),this.W.hide()},t.prototype.remove=function(){this.option.closeEvent(),this.W.remove()},t.prototype.exist=function(){this.W.remove()}}(jQuery),function(n){n.fn.extend({diigoMenu:function(e){return this.each(function(){this&&(this.controller?this.controller.setOption(e):n.isPlainObject(e)&&(this.controller=new t(this,e)))})}});var t=function(e,t){this.option=n.extend(!1,{menu:".dropMenu",direction:"down"},t),this.button=n(e),this.menu=n(e).find(this.option.menu),0<this.menu.length&&(i.apply(this),o.apply(this))},i=function(){this.menu.hide().css("position","absolute").css("left",0),"up"==this.option.direction?this.menu.css("bottom",this.button.outerHeight()):this.menu.css("top",this.button.outerHeight())},o=function(){var i=this;this.button.on("click",function(e){i.button.addClass("active"),i.menu.show(10,function(){n(document).on("click.one",function(e){i.button.removeClass("active"),i.menu.hide(),n(document).off("click.one")})})}),i.menu.on("click",function(e){e.preventDefault();var t=e.target;i.button.triggerHandler("menuchange",t)})};t.prototype.setOption=function(e){if(n.isPlainObject(e))this.option=n.extend(!1,this.option,e);else if("string"==typeof e)switch(e){case"hide":this.hide()}},t.prototype.hide=function(){this.button.removeClass("active"),this.menu.hide(),n(document).off("click.one")}}(jQuery),jQuery("body").find('[data-toggle="dropdown"]').diigoMenu({menu:"[role='menu']",direction:"down"}),function(i){i.fn.extend({diigoToolTip:function(e){return this.each(function(){this&&(this.controller||i.isPlainObject(e)&&(this.controller=new t(this,e)))})}});var t=function(e,t){this.option=i.extend(!1,{message:null,width:200,location:"bottom"},t),n.apply(this,[e]),o.apply(this)},n=function(e){var n=this;this.ele=i(e),this.ele.on("mouseenter",n._enter=function(){var e,t,i=n.ele.attr("data-location")||n.option.location;n.tooltipView.appendTo(document.body).addClass(i),"bottom"===i?(e=n.ele.offset().top+n.ele.outerHeight()+10,t=n.ele.offset().left+n.ele.outerWidth()/2-n.tooltipView.outerWidth()/2):"right"===i&&(e=n.ele.offset().top+n.ele.outerHeight()/2-n.tooltipView.outerHeight()/2,t=n.ele.offset().left+n.ele.outerWidth()+10),n.tooltipView.css("top",e+"px").css("left",t+"px").show(0,function(){n.tooltipView.addClass("show")})}).on("mouseleave",n._out=function(){n.tooltipView.removeClass("show").detach()})},o=function(){var e=this.option.message||this.ele.attr("data-title");this.tooltipView=i('<div class="DiigoToolTip"></div>').css("position","absolute").css("width",this.option.width).html(e)}}(jQuery),jQuery("body").find('[data-toggle="toolTip"]').diigoToolTip({width:200});var renderDom=function(r){return{list:function(e){var n=r('<select name="lists" id="newItemList" class="inputText"></select>').on("change",function(e){-2==n.val()&&(n.hide(),a.show())});if(n.append('<option value="-3">Add to Outliner</option>'),n.append('<option value="-1">------------</option> '),n.append('<option value="-2">Create an Outliner...</option>'),n.append('<option value="-1">------------</option> '),_GLOBAL_VAR.lists)for(var t=0;t<_GLOBAL_VAR.lists.length;t++)n.append('<option value="'+t+'">'+_GLOBAL_VAR.lists[t].title.replace(/>/g,"&gt;").replace(/</g,"&lt;")+"</option>");var o=!1,a=r('<div class="addList"><input type="text" class="newListInNewItem inputText"><button class="btn blue addNewList">Add</button><a class="cancelNewList">Cancel</a></div>').on("click",".cancelNewList",function(e){a.hide(),n.show(),n.val(-3)}).on("click",".addNewList",function(e){if(!o){var t=this,i=r.trim(a.find(".newListInNewItem").val());0<i.length&&(r(t).html("Adding"),o=!0,renderDom.addList({title:i},function(){r(t).html("Add"),o=!1,a.find(".newListInNewItem").val(""),a.hide(),n.show()}))}});r(e).html(n),a.appendTo(r(e)).hide()},group:function(i){function t(){var e=r('<select name="groups" id="newItemShareGroup" class="inputText"></select>');e.append('<option value="-1">Share to a Group</option>'),e.append('<option value="-1">------------</option>');for(var t=0;t<_GLOBAL_VAR.my_groups.length;t++)e.append('<option value="'+t+'">'+_GLOBAL_VAR.my_groups[t].display_name+"</option>");r(i).html(e)}if(_GLOBAL_VAR.my_groups)t();else{var e="/group_mana/load_groups?u_name="+_GLOBAL_VAR.my_name;r.get(e,function(e){_GLOBAL_VAR.my_groups=JSON.parse(e),t()})}},addList:function(e,n){e=r.extend(!1,{desc:""},e);r.ajax({url:"/ditem_outliner/create_outliner",data:e,type:"POST",success:function(e){if("403"!=e){var t=JSON.parse(e),i=_GLOBAL_VAR.lists.length;renderDom.buildListInfo({id:t.list_id,index:i,title:t.title,uri:t.uri,mode:t.privacy,encoded_id:t.encoded_id}),r.isFunction(n)&&n()}else outlinerLimit()}})},buildListInfo:function(e){if(_GLOBAL_VAR.lists.push(e),_GLOBAL_VAR.my_lists&&_GLOBAL_VAR.my_lists.push(e),0<r("#listName").length){r("#listName").val("");var t=r("#addToListMenu"),i=t.find("hr")[0],n=r("<li><a href=\"javascript:doAddToListAction('"+e.index+"')\">"+e.title+"</a></li>")[0];t[0].insertBefore(n,i.nextSibling)}if(0<r("#myListsNav").length){var o='<a class="edit" href="/ditem_list/edit_list?uri='+e.title.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g,"-")+'" title="Edit"><span class="editIcon"></span></a><a title="'+(2==e.mode?"(Private) ":"")+' info.title" href="/list/'+_GLOBAL_VAR.username+"/"+e.title+"/"+e.encoded_id+'" '+(2==e.mode?'class="private"':"")+'><span class="count">0</span>'+e.title+'<b class="flag"></b></a></li>',a=r("<li>"+o+"</li>");r("#myListsNav").find("ul").prepend(a)}if(0<r("#newItemList").length){var s=r("#newItemList");s.append('<option value="'+e.index+'">'+e.title+"</option>"),s.val(e.index)}}}}(jQuery),ImagePopup=function(r){function a(e){var t,i=this;if("left"==e){var n=r("#ditemItem_"+i.index).prev();n.is(".clear")&&(n=n.prev()),0<n.length&&(t=n.find(".imagePopup").attr("data-imgsrc"),s.apply(i),i.index=n.find(".imagePopup").attr("data-index"),l.apply(i,[t]))}else{var o=r("#ditemItem_"+i.index).next();o.is(".clear")&&(o=o.next()),0<o.length&&(t=o.find(".imagePopup").attr("data-imgsrc"),s.apply(i),i.index=o.find(".imagePopup").attr("data-index"),l.apply(i,[t]))}}var e=function(){var i=this;r("#main").on("click",".imagePopup",function(e){e.preventDefault(),i.index=r(this).attr("data-index");var t=r(this).attr("data-imgsrc");n.apply(i,[i.index,t])}),r("#main").on("click",".imagePopupLibrary",function(e){e.preventDefault(),i.index=r(this).attr("data-index"),r(this).attr("data-a-index")&&(i.aIndex=r(this).attr("data-a-index"));var t=r(this).attr("data-imgsrc");n.apply(i,[i.index,t,"nodirect"])})},n=function(e,t,i){0<r("#imageViewPopup").length||(this.wrapper=r(IMAGE_POPUP_HTML_TEMPLATE),"nodirect"==i&&this.wrapper.find(".imageCur").remove(),s.apply(this),r("body").append(this.wrapper).addClass("popShow"),l.apply(this,[t]),o.apply(this,[i]))},s=function(){var e=d(60,60),t="left:"+e.left+"px;top:"+e.top+"px;";this.wrapper.css("height",document.body.scrollHeight).find(".imageInnerWrap").css("height",document.body.clientHeight).html("<div class='imgLoading' style='"+t+"'>Loading...</div>")},l=function(e){var t=this;t.imageWrapper=r(Util.string(IMAGE_POPUP_INNER_HTML_TEMPLATE).interpolate({imgurl:e})),t.img=t.imageWrapper.find("img")[0],t.img.onload=function(){i.apply(t),t.wrapper.find(".imageInnerWrap").css("height",document.body.clientHeight).html("").append(t.imageWrapper)}},i=function(){var e=this,t=d(e.img.height,e.img.width);e.imageWrapper.css({height:t.height,width:t.width,left:t.left,top:t.top}),e.img.width=t.width,e.img.height=t.height;var i=[],n=r("#ditemItem_"+e.index).prev();n.is(".clear")&&(n=n.prev()),0<n.length&&i.push(n.find(".imagePopup").attr("data-imgsrc"));var o=r("#ditemItem_"+e.index).next();o.is(".clear")&&(o=o.next()),0<o.length&&i.push(o.find(".imagePopup").attr("data-imgsrc"));for(var a=0;a<i.length;a++){(new Image).src=i[a]}},d=function(e,t){var i,n,o=document.body.clientWidth,a=document.body.clientHeight;o<t+150&&(n=e*(i=o-150)/t,t=i,e=n),a<e+100&&(t=i=t*(n=e-100)/e,e=n);var s=(a-e)/2;return s<50&&(s=50),{left:(o-t)/2,top:s,width:t,height:e}},o=function(n){var o=this;r("#imageViewPopup").on("click",".imageInner",function(e){if(e.stopPropagation(),"nodirect"!=n){var t=o.imageWrapper.outerWidth(),i=e.offsetX;i=i||e.clientX-o.imageWrapper.offset().left,a.apply(o,i<t/2?["left"]:["right"])}}).on("click",".imageCur",function(e){e.stopPropagation(),e.preventDefault(),r(e.target).is(".imageLeft")?a.apply(o,["left"]):a.apply(o,["right"])}).on("click",".closeButton",function(e){e.stopPropagation(),m()}).on("click",".shareMenu ul li a",function(e){switch(e.stopPropagation(),e.preventDefault(),this.className){case"s_facebook":c.apply(o,["facebook"]);break;case"s_twitter":c.apply(o,["twitter"]);break;case"s_googleplus":c.apply(o,["googleplus"]);break;case"s_email":c.apply(o,["email"]);break;case"a_download":var t;t="bookmark"==_GLOBAL_VAR.ditems[o.index].type_name?_GLOBAL_VAR.ditems[o.index].annotations[o.aIndex].download_url:_GLOBAL_VAR.ditems[o.index].download_url,window.open(t);break;case"s_link":c.apply(o,["link"]);break;case"a_delete":"bookmark"==_GLOBAL_VAR.ditems[o.index].type_name?(removeAnnotation(o.index+"_"+o.aIndex),m()):deleteB.bind(this,o.index,function(e){o.wrapper.find(".imageRight").trigger("click"),"nodirect"==n&&m()})()}}).one("click",function(e){m()}),r(window).on("resize.image",function(e){o.wrapper.find(".imageInnerWrap").css("height",document.body.clientHeight),i.apply(o)}),r("body").on("keydown.esc",function(e){27==e.keyCode&&m()})},c=function(a){var e,t,i,s=this;if(i="bookmark"==_GLOBAL_VAR.ditems[s.index].type_name?(e=_GLOBAL_VAR.ditems[s.index].annotations[s.aIndex].share_link,t=_GLOBAL_VAR.ditems[s.index].annotations[s.aIndex].permanent_url,_GLOBAL_VAR.ditems[s.index].annotations[s.aIndex].file_link_id):(e=_GLOBAL_VAR.ditems[s.index].share_link,t=_GLOBAL_VAR.ditems[s.index].permanent_url,_GLOBAL_VAR.ditems[s.index].link_id),e&&t)u.apply(s,[e,t,a]);else{r.ajax({url:"/item/get_share_url",data:{link_id:i},success:function(e){var t=JSON.parse(e),i=t.shared_url,n=t.embeded_url,o=t.download_url;s.wrapper.find("a.a_download").attr("href",o),u.apply(s,[i,n,a]),"bookmark"==_GLOBAL_VAR.ditems[s.index].type_name?(_GLOBAL_VAR.ditems[s.index].annotations[s.aIndex].share_link=i,_GLOBAL_VAR.ditems[s.index].annotations[s.aIndex].permanent_url=n,_GLOBAL_VAR.ditems[s.index].annotations[s.aIndex].download_url=o):(_GLOBAL_VAR.ditems[s.index].share_link=i,_GLOBAL_VAR.ditems[s.index].permanent_url=n,_GLOBAL_VAR.ditems[s.index].download_url=o)}})}},u=function(e,t,i){var n,o=260,a=760,s=_GLOBAL_VAR.ditems[this.index].title;switch(i){case"twitter":n="https://twitter.com/intent/tweet?original_referer="+document.location.href+"&text="+s+"&url="+e+"&via=diigo",o=260,a=760;break;case"facebook":n="https://www.facebook.com/sharer/sharer.php?u="+e,a=670,o=430;break;case"googleplus":n="https://plus.google.com/share?url="+e,a=490,o=520;break;case"email":window.open("mailto:?subject="+s+"&body="+e);break;case"link":var r=t;p.apply(this,[r,e])}n&&window.open(n,"shareWindow","height="+o+", width="+a)},p=function(e,t){r(Util.string(IMAGE_POPUP_GET_LINK).interpolate({emburl:e,surl:t})).diigoWP({title:"Get Link"}).find("input").on("click",function(e){this.select()})},m=function(){r("#imageViewPopup").remove(),r("body").off("keydown.esc").removeClass("popShow"),r(window).off("resize.image")};return function(){e.apply(this)}}(jQuery);new ImagePopup;var inpageNewImage=function($){var mainDOM,tempDOM,uploader,len,currentLen,isuploading,_init=function(){(mainDOM=$("<div>"+INPAGE_IMAGE_UPLOAD+Util.string(NEW_ITEM_DES_TEMPLATE).interpolate({submit:"Upload Now"})+"</div>").diigoWP({title:"New Image"})).find(".itemDescriptionArea").remove(),tempDOM=$(INPAGE_IMAGE_UPLOAD_TEMPLATE),uploader=mainDOM.find(".imageupload").fineUploader({autoUpload:!1,validation:{allowedExtensions:["jpg","jpeg","png","bmp","gif","tif","tag","dcm","eps","pbm","pct","pcx","psb"]},template:tempDOM,maxConnections:1,request:{endpoint:"/item/save/image"},messages:{typeError:"{file} is an invalid image,support types: {extensions}"}});var o=!1,a=mainDOM.find(".qq-upload-button"),s=mainDOM.find(".qq-upload-drop-area");uploader.on("complete",function(e,t,i,n){len++;var o=_GLOBAL_VAR.tagsCrumb,a=/\/search\?/.test(document.location.href);len==currentLen&&(mainDOM.find(".submit").html("Upload Now"),isuploading=!1),mainDOM.find(".qq-upload-list li").not(".qq-upload-success").length<1&&(mainDOM.diigoWP("remove"),(o||a)&&_uploadTip()),o||a?_ImageUploadDone(n,!0):_ImageUploadDone(n)}).on("statusChange",function(e,t,i,n){i&&setTimeout(function(){8<=mainDOM.find(".qq-upload-list li").length?(o=!0,a.addClass("fullHide"),s.addClass("fullHide")):(o=!1,a.removeClass("fullHide"),s.removeClass("fullHide"))},0)}).on("submit",function(){if(o)return!1}).on("submitted",function(e,t,i){uploader.fineUploader("setName",t,i+"_"+(_GLOBAL_VAR.ditems.length+parseInt(t)))});var n=mainDOM.find(".tagInput");n.DiigoLSearch({mutil:!0,type:null,data:TAGs});var e=mainDOM.find(".addToListHolder"),t=mainDOM.find(".addToGroupHolder");renderDom.list(e),renderDom.group(t),mainDOM.find(".submit").on("click",function(){if(!isuploading){$(this).html("Uploading..."),isuploading=!0,len=0,currentLen=mainDOM.find(".qq-upload-list li").not(".qq-upload-fail,.qq-upload-success").length;var e="";-1<$("#newItemList").val()&&(e=_GLOBAL_VAR.lists[$("#newItemList").val()].id);var t="";_GLOBAL_VAR.my_groups&&-1<$("#newItemShareGroup").val()&&(_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].group_id,t=_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].g_name);var i="normal";-1<window.location.href.indexOf("type=image")&&(i="grid");_GLOBAL_VAR.ditems.length,Math.random();uploader.fineUploader("setParams",{private:$("#newItemPrivate")[0].checked,tags:n.val(),lists:e,groups:t,display_style:i}),uploader.fineUploader("uploadStoredFiles")}}),"true"!=_GLOBAL_VAR.user_permission.image&&(_upgradeTip(),$(".imageupload_wrap,.itemDes").hide())};function _ImageUploadDone(e,t){if("-2"==e.code)_upgradeTip();else{if(t)return;-1<window.location.href.indexOf("type=image")?$("#ditemItemsWraper .ditemImageGrid").prepend(e.dom_str).diigowf("reload"):($("#ditemItemsWraper").prepend(e.dom_str),new ContextMenu("ditemItemsWraper",{eventType:"mouseover"})),$("#noLibrary").remove(),_buildJSON(e.script_str)}}function _buildJSON(data){eval(data)}function _upgradeTip(){if(!(0<mainDOM.find(".upgradeTip").length)){var e=$("<p class='upgradeTip'>Images ran out of free plan.Please support us with a <a href='/premium'>premium plan</a></p>");mainDOM.find(".imageupload_wrap").after(e)}}function _uploadTip(){var e=$("<p id='uploadImageTip'><a href='/'>Check images you uploaded in recent items.</a></p>");e.appendTo(document.body).delay(5e3).hide(100,function(){e.remove()})}return _init}(jQuery),inpageNewBookmark=function($){var mainDOM,desDOM=NEW_ITEM_DES_TEMPLATE.replace(/<div class=\"privacy\">(.*?)<\/div>/,"<div class='privacy' style='width:1px;height: 20px;float: none;'></div> "),$tag,_init=function(){mainDOM=$("<div>"+INPAGE_NEW_BOOKMARK+Util.string(desDOM).interpolate({submit:"Add New Bookmark"})+"</div>").diigoWP({title:"Add New Bookmark"}),($tag=mainDOM.find(".tagInput")).DiigoLSearch({mutil:!0,type:null,data:TAGs});var e=mainDOM.find(".addToListHolder"),t=mainDOM.find(".addToGroupHolder");renderDom.list(e),renderDom.group(t),_hideMoreDetails(),mainDOM.find(".submit").on("click",function(){var e="";-1<$("#newItemList").val()&&(e=_GLOBAL_VAR.lists[$("#newItemList").val()].id);var t="";_GLOBAL_VAR.my_groups&&-1<$("#newItemShareGroup").val()&&(_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].group_id,t=_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].g_name);var i={title:mainDOM.find(".titleInput").val(),url:mainDOM.find(".urlInput").val(),private:$("#newItemPrivate")[0].checked,unread:$("#newItemUnread")[0].checked,description:mainDOM.find(".desInput").val(),tags:$tag.val(),lists:e,groups:t,dindex:_GLOBAL_VAR.ditems.length};$.ajax({type:"POST",url:"/item/save/bookmark",data:i,success:function(e){_BookmarkAddDone(JSON.parse(e))}})}),mainDOM.find(".urlInput").on("keyup",function(e){13==e.keyCode&&_fillFormWithURL($(this).val())}).on("paste",function(e){var t=this;setTimeout(function(){_fillFormWithURL($(t).val())},0)}),mainDOM.find(".getDetailButton").on("click",function(e){var t=mainDOM.find(".urlInput").val();_fillFormWithURL(t)})},_hideMoreDetails=function(){mainDOM.find(".moreDetail").hide(),mainDOM.find(".itemDes").hide()},_showMoreDetails=function(){mainDOM.find(".nextButton").hide(),mainDOM.find(".moreDetail").show(),mainDOM.find(".itemDes").show()},_BookmarkAddDone=function(e){var t=_GLOBAL_VAR.tagsCrumb,i=/\/search\?/.test(document.location.href);if(t||i){mainDOM.diigoWP("remove");var n=$("<p id='uploadImageTip'><a href='/'>Check bookmark you added in recent items.</a></p>");n.appendTo(document.body).delay(5e3).hide(100,function(){n.remove()})}else $("#ditemItemsWraper").prepend(e.dom_str),new ContextMenu("ditemItemsWraper",{eventType:"mouseover"}),$("#noLibrary").remove(),mainDOM.diigoWP("remove"),_buildJSON(e.script_str)},_buildJSON=function(data){eval(data)},_fillFormWithURL=function(o){if(o){mainDOM.find(".getDetailButton").hide(),mainDOM.find(".nextButton .loading").show();var e=_GLOBAL_VAR.superio_domain+"/fetch_meta";mainDOM.find(".title_loading").show(),$.ajax({url:e,type:"POST",data:{url:o},timeout:1e4,success:function(e){_showMoreDetails(),mainDOM.find(".title_loading").hide();var t=JSON.parse(e),i=mainDOM.find(".titleInput"),n=mainDOM.find(".desInput");$.trim(i.val()).length<1&&t.title&&i.val(t.title),$.trim(n.val()).length<1&&t.desc&&n.val(t.desc),_getRecommendedTags({url:o,title:i.val()})},error:function(e){_showMoreDetails(),_getRecommendedTags({url:o}),mainDOM.find(".title_loading").hide()}})}else _showMoreDetails()},_getRecommendedTags=function(e){$.ajax({url:"/tag_mana2/load_recommended_tags",data:e,success:function(e){_setRecommendTag(JSON.parse(e).tags)},error:function(e){}})},_setRecommendTag=function(e){var t=mainDOM.find(".recommendedTags");if(t.html(""),0<e.length){t.append("<label>Recommended tags:</label>");for(var i=0;i<e.length;i++)t.append('<a href="javascript:;" data-value="'+e[i]+'">'+e[i]+"</a>");t.on("click","a",function(e){var t=$(this).attr("data-value"),i=ParseTags.parseTags($tag.val(),!0);i.include(t)?(i=i.without(t),$(this).removeClass("active")):(i.push(t),$(this).addClass("active")),$tag.val(ParseTags.unparseTags(i)+" ")})}};return _init}(jQuery),inPageNewPdf=function($){var mainDOM,tmpDOM,$tag,uploader,isUploading=!1,desDOM=NEW_ITEM_DES_TEMPLATE.replace(/<div class=\"privacy\">(.*?)<\/div>/,"<div class='privacy' style='width:1px;height: 20px;float: none;'></div> "),_init=function(){isUploading=!1,mainDOM=$("<div>"+INPAGE_NEW_PDF+Util.string(desDOM).interpolate({submit:"Upload PDF"})+"</div>").diigoWP({title:"Upload PDF"}),tmpDOM=$(INPAGE_NEW_PDF_TEMPLATE),($tag=mainDOM.find(".tagInput")).DiigoLSearch({mutil:!0,type:null,data:TAGs});var e=mainDOM.find(".addToListHolder"),t=mainDOM.find(".addToGroupHolder");renderDom.list(e),renderDom.group(t),(uploader=mainDOM.find(".pdfupload").fineUploader({autoUpload:!1,validation:{allowedExtensions:["pdf"],itemLimit:1,sizeLimit:64e6},template:tmpDOM,request:{endpoint:"/item/save"},editFilename:{enabled:!0},messages:{typeError:"{file} is an invalid PDF"}})).on("complete",function(e,t,i,n){isUploading=!1,mainDOM.find(".submit").html("Upload PDF"),"-2"!=n.code?n.url&&_PDFUploadDone(n):_upgradeTip(!0)}).on("submit",function(){mainDOM.find("li.qq-upload-fail").remove()}),mainDOM.find(".submit").on("click",function(){if(!isUploading){$(this).html("Uploading..."),isUploading=!0;var e="";-1<$("#newItemList").val()&&(e=_GLOBAL_VAR.lists[$("#newItemList").val()].id);var t="";_GLOBAL_VAR.my_groups&&-1<$("#newItemShareGroup").val()&&(_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].group_id,t=_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].g_name),uploader.fineUploader("setParams",{private:!0,tags:$tag.val(),lists:e,groups:t,description:mainDOM.find(".desInput").val(),dindex:_GLOBAL_VAR.ditems.length,dtype:"pdf"}),uploader.fineUploader("uploadStoredFiles")}}),"true"!=_GLOBAL_VAR.user_permission.pdf&&(_upgradeTip(),$(".newPdf_wrap,.itemDes").hide())},_PDFUploadDone=function(e){var t=_GLOBAL_VAR.tagsCrumb,i=/\/search\?/.test(document.location.href);if(mainDOM.diigoWP("remove"),t||i){var n=$("<p id='uploadImageTip'><a href='/'>Check PDF you added in recent items.</a></p>");n.appendTo(document.body).delay(5e3).hide(100,function(){n.remove()})}else $("#ditemItemsWraper").prepend(e.dom_str),new ContextMenu("ditemItemsWraper",{eventType:"mouseover"}),$("#noLibrary").remove(),_buildJSON(e.script_str)},_buildJSON=function(data){eval(data)};function _upgradeTip(){var e;0<mainDOM.find(".upgradeTip").length||(e="true"==_GLOBAL_VAR.ispremium||1==arguments[0]?$("<p class='upgradeTip'>Your PDF quota has been used up. <a href='/premium'>Upgrade now</a> to make yourself more productive!</p>"):$("<p class='upgradeTip'>PDF storage and annotation not available for the free plan. <a href='/premium'>Upgrade now</a> to make yourself more productive!</p>"),mainDOM.find(".newPdf_wrap").after(e))}return _init}(jQuery),newUserExperience=function(i){var n;return function(){n=i(NEW_USE_EXPERIENCE).diigoWP({theme:"flat",width:805});var e=window._gaq||{},t='javascript:(function(){s=document.createElement("script");s.type="text/javascript";s.src="'+document.location.protocol+"//"+document.location.host+'/javascripts/webtoolbar/diigolet_b_h_b.js";document.body.appendChild(s);})();';n.find(".d_diigolet .diigolet_button").attr("href",t).on("dragstart",function(){e&&e.push&&e.push(["_trackEvent","install extension","diigolet_new"])}),i.browser.isChrome?(n.find(".d_chrome").show(),e&&e.push&&e.push(["_trackEvent","show user experience","chrome"])):i.browser.isFirefox?(n.find(".d_firefox").show(),e&&e.push&&e.push(["_trackEvent","show user experience","firefox"])):(n.find(".d_diigolet").show(),e&&e.push&&e.push(["_trackEvent","show user experience","diigolet"])),n.find(".d_firefox .install_button").on("click",function(){e&&e.push&&e.push(["_trackEvent","install extension","firefox"])}),n.find(".d_chrome .install_button").on("click",function(){e&&e.push&&e.push(["_trackEvent","install extension","chrome"]),chrome.webstore.install("https://chrome.google.com/webstore/detail/pnhplgjpclknigjpccbcnmicgcieojbh",function(){e&&e.push&&e.push(["_trackEvent","install extension","chrome-installed"])},function(){})})}}(jQuery),inpageNewNote=function($){var mainDOM,$toolbar,editor,$tag,e_link_id,e_dindex,isedit=!1,AUTOSAVE,_singlePage,_init=function(e,t){var i,n;n=e?(i="Save Note","Edit Note"):(i="Add Note","New Note"),(mainDOM=(_singlePage=t)?$("<div>"+INPAGE_NEW_NOTE+Util.string(NEW_ITEM_DES_TEMPLATE).interpolate({submit:i})+"</div>").appendTo("#newItemBody"):$("<div>"+INPAGE_NEW_NOTE+Util.string(NEW_ITEM_DES_TEMPLATE).interpolate({submit:i})+"</div>").diigoWP({title:n,closeEvent:function(){_resetVar()}})).find(".itemDescriptionArea").remove(),($toolbar=mainDOM.find(".toolbarArea")).html(INPAGE_NEW_NOTE_TOOLBAR),mainDOM.find("#newItemPrivate")[0].checked=!0,"true"!=_GLOBAL_VAR.ispremium&&mainDOM.find(".privacy").css("visibility","hidden"),($tag=mainDOM.find(".tagInput")).DiigoLSearch({mutil:!0,type:null,data:TAGs});var o=mainDOM.find(".addToListHolder"),a=mainDOM.find(".addToGroupHolder");renderDom.list(o),renderDom.group(a),editor=new wysihtml5.Editor("noteContentArea",{toolbar:"editor-toolbar",stylesheets:"/stylesheets/v6/editor.css",parserRules:wysihtml5ParserRules}),_initToolbar(),_bindEvent(),e&&_setValue(e),editor.focus(),mainDOM.find(".noteTitle").focus(),_initAutoSave(),_privaceEvent()},_privaceEvent=function(){$("#newItemPrivate").on("change",function(){$("#newItemPrivate")[0].checked&&"true"!=_GLOBAL_VAR.ispremium&&$("#newItemPrivate").attr("disabled","disabled")})},_initToolbar=function(){_initImageInserArea(),$toolbar.find('[data-toggle="dropdown"]').diigoMenu({menu:"[role='menu']",direction:"up"}),$toolbar.find("[data-wysihtml5-command]").on("click",function(e){if(!$(this).is(".wysihtml5-command-active")){var t=$(this).attr("data-wysihtml5-command"),i=$("[data-wysihtml5-command="+t+"].wysihtml5-command-active");if(0<i.length){var n=i.attr("data-wysihtml5-command-value");editor.toolbar.execCommand(t,n)}}}),editor.on("command:compass",function(e){switch(e.name){case"fontName":var t=$toolbar.find('[data-wysihtml5-command-value="'+e.value+'"]').html();$toolbar.find(".fnt_t").html(t);break;case"justifyLeft":$toolbar.find(".justifyTitle i").attr("class","j_left");break;case"justifyRight":$toolbar.find(".justifyTitle i").attr("class","j_right");break;case"justifyCenter":$toolbar.find(".justifyTitle i").attr("class","j_center")}}).on("focus:composer",function(e){$toolbar.find('[data-toggle="dropdown"]').diigoMenu("hide")}).on("newword:composer",function(e){if(mainDOM.find(".noteTitle").val().length<1){var t=document.createElement("div");t.innerHTML=editor.getValue(),mainDOM.find(".noteTitle").val(t.innerText.slice(0,10))}}),setTimeout(function(){},0)},_initImageInserArea=function(){var i=mainDOM.find(".insertImageDialog"),e=mainDOM.find("[data-c=insertImage]"),r=mainDOM.find(".l_images ul").html(""),n=mainDOM.find(".l_images"),l=[],d='<li data-url="#{embedurl}"><img src="#{url}"/></li>';function o(e){for(var t=0;t<e.length;t++){var i=Util.string(d).interpolate({url:e[t].src,embedurl:e[t].embedurl});r.append(i)}}function t(){o(l)}function c(){i.is(":visible")?(i.hide(),e.removeClass("active"),i.find(".gallery").removeClass("i_search"),r.html(""),t()):(a(),i.show(),e.addClass("active"))}function a(){i.find(".gallery").removeClass("i_search").removeClass("i_insert"),i.find(".searchinput").val(""),i.find(".a_a_s_input").attr("style","")}var s,u=!1,p=0;function m(){_GLOBAL_VAR.username;u||(u=!0,r.find("li.loading").remove(),r.append('<li class="loading"></li>'),n.animate({scrollLeft:n.scrollLeft()+80},100),$.ajax({type:"GET",url:"/user/"+_GLOBAL_VAR.username,data:{json:"true",type:"image",count:"20",page_num:p},success:function(e){e=JSON.parse(e),r.find("li.loading").remove();for(var t=0;t<e.length;t++)l.push({name:e[t].title,src:e[t].image_display_url,embedurl:e[t].image_url_embeded_in_note}),o([{name:e[t].title,src:e[t].image_display_url,embedurl:e[t].image_url_embeded_in_note}]);u=!1,p++},error:function(){r.find("li.loading").remove()}}))}var h,f=!1;function _(){f||(f=!0,r.append('<li class="loading"></li>'),$.ajax({type:"GET",url:"/search",data:{adSScope:"my",what:h,snapshot:"no",json:"true",type:"image",page_num:s},success:function(e){e=JSON.parse(e),r.find("li.loading").remove();for(var t=0;t<e.length;t++)o([{name:e[t].title,src:e[t].image_display_url,embedurl:e[t].image_url_embeded_in_note}]);f=!1,s++},error:function(){r.find("li.loading").remove()}}))}var v,g=!0,w=function(){var e=$(INPAGE_NEW_NOTE_UPLOAD_IMAGE_TEMP),n=$toolbar.find("#insertLocal").fineUploader({validation:{allowedExtensions:["jpg","jpeg","png","gif"]},template:e,request:{endpoint:"/item/save/image"}}).on("submitted",function(e,t,i){n.fineUploader("setName",t,i+"_0"),mainDOM.find("#insertLocal").hide(),mainDOM.find(".insertLocalUploading").show()}).on("complete",function(e,t,i,n){if(mainDOM.find("#insertLocal").show(),mainDOM.find(".insertLocalUploading").hide(),"-2"==n.code&&$("<p class='upgradeTip'>Images ran out of free plan.Please support us with a <a href='/premium'>premium plan</a></p>").appendTo(".newNote_wrap"),n.success){var o=n.image_display_url_small;editor.composer.commands.exec("insertImage",{src:n.image_url_embeded_in_note,class:"wysiwyg-image"}),c();var a={title:n.title,src:o,embedurl:n.image_url_embeded_in_note};l.unshift(a);var s=Util.string(d).interpolate({url:o,embedurl:o});r.prepend(s)}});n.fineUploader("setParams",{for:"note"})};a(),mainDOM.find("[data-c=insertImage]").on("click",function(){c(),g&&(g=!1,r.find("li.loading").remove(),r.append('<li class="loading"></li>'),m(),w())}),i.find(".a_a_search").on("click",function(){!function(){var e=i.find(".a_a_s_input");e.attr("style")?(e.attr("style",""),i.find(".searchinput").val(""),i.find(".gallery").removeClass("i_search"),t()):(e.attr("style","left:0"),i.find(".searchinput").focus())}()}),i.find(".a_a_close").on("click",function(){c()}),i.find(".searchinput").on("input",function(){var e=$(this).val();0<e.length?(i.find(".gallery").removeClass("i_insert").addClass("i_search"),r.html(""),clearTimeout(v),v=setTimeout(function(){s=0,h=e,_()},1e3)):(i.find(".gallery").removeClass("i_search"),r.html(""),t())}),r.on("click","li",function(){var e=$(this).attr("data-url");editor.composer.commands.exec("insertImage",{src:e,class:"wysiwyg-image"}),c()}),mainDOM.find(".insertByUrl").on("click",function(){i.find(".gallery").addClass("i_insert")});var A=!1;mainDOM.find(".leftarrow").on("click",function(){if(!A){A=!0;var e=n.scrollLeft();0<e&&(e-=200)<0&&(e=0),n.animate({scrollLeft:e},300,function(){A=!1})}}),mainDOM.find(".rightarrow").on("click",function(){if(!A){A=!0;var t=n.scrollLeft();n.animate({scrollLeft:t+200},300,function(){A=!1;var e=n.scrollLeft();t==e&&(i.find(".gallery").is(".i_search")?_():m())})}}),mainDOM.find(".i_i_b").on("click",function(){var e=mainDOM.find(".imageUrlInput").val();editor.composer.commands.exec("insertImage",{src:e,class:"wysiwyg-image"}),mainDOM.find(".imageUrlInput").val(""),c()})},isSaving=!1,_saveNote=function(l){return new YPro(function(t,i,e){if(editor.getValue().length<1)t(null);else if(isSaving)t(null);else{isSaving=!0,mainDOM.find(".submit").html("Saving...");var n=$("<div>"+editor.getValue()+"</div>");n.find(".img-loading").removeClass("img-loading");var o=n.html(),a={title:mainDOM.find(".noteTitle").val(),content:o,tags:$tag.val()};a.title.length<1&&(a.title="New Note"),isedit?(a.dindex=e_dindex,a.link_id=e_link_id):a.dindex=_GLOBAL_VAR.ditems.length,a.note_type="rich";var s="";-1<$("#newItemList").val()&&(s=_GLOBAL_VAR.lists[$("#newItemList").val()].id);var r="";_GLOBAL_VAR.my_groups&&-1<$("#newItemShareGroup").val()&&(_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].group_id,r=_GLOBAL_VAR.my_groups[$("#newItemShareGroup").val()].g_name),a.lists=s,a.groups=r,l&&(a.groups=""),a.private=$("#newItemPrivate")[0].checked,$.ajax({type:"POST",url:"/item/save/note",data:a,success:function(e){mainDOM.find(".submit").html("Save Note"),t(e,a),isSaving=!1},error:function(e){mainDOM.find(".submit").html("Save Note"),i(e),isSaving=!1}})}})},_initAutoSave=function(){clearInterval(AUTOSAVE),AUTOSAVE=setInterval(function(){_saveNote(!0).then(function(e,t){if(e&&!_singlePage){var i=JSON.parse(e);isedit?_editNoteDone(i,!0):(isedit=!0,e_link_id=i.link_id,e_dindex=t.dindex,_postNoteDone(i,!0))}})},2e4)},_bindEvent=function(){mainDOM.find(".submit").on("click",function(e){_saveNote().then(function(e){e&&(_singlePage||(isedit?_editNoteDone(JSON.parse(e)):_postNoteDone(JSON.parse(e)),new ContextMenu("ditemItemsWraper",{eventType:"mouseover"})))})}),mainDOM.on("WPremove",function(){_resetVar(),new ContextMenu("ditemItemsWraper",{eventType:"mouseover"})})},_setValue=function(e){isedit=!0,mainDOM.find(".noteTitle").val(e.title);var i=e.tags.split(",");i.forEach(function(e,t){/\s/.test(e)&&(i[t]='"'+e+'"')}),$tag.val(i.join(" ")),!0===e.isPrivate||"true"==e.isPrivate?$("#newItemPrivate")[0].checked=!0:($("#newItemPrivate")[0].checked=!1,mainDOM.find(".privacy").css("visibility","visible")),e_link_id=e.link_id,e_dindex=e.dindex,"true"!==e.isRich&&(e.content=e.content.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\u00A0/g,"&nbsp;").replace(/\\r/g,"").replace(/\\n/g,"<br />").replace(/\r/g,"").replace(/\n/g,"<br />"));var t=e.content.replace(/\\"/g,'"');setTimeout(function(){editor.setValue(t)},0)},_postNoteDone=function(e,t){var i=document.location.search;""!=i&&!/type=note/.test(i)||($("#ditemItemsWraper").prepend(e.dom_str),$("#noLibrary").remove()),_closeWindow(t),_buildJSON(e.script_str)},_buildJSON=function(data){eval(data)},_editNoteDone=function(e,t){var i=_GLOBAL_VAR.ditems[e_dindex];i.title=e.title,i.note_content=e.note_content,i.t_name=e.tags,i.note_type="rich",i.mode=e.mode,2==e.mode?i.private=!0:i.private=!1;var n=e.dom_str;$("#ditemItem_"+e_dindex).html($(n).html()),_closeWindow(t)},_closeWindow=function(e){e||(mainDOM.diigoWP("remove"),_resetVar())},_resetVar=function(){clearInterval(AUTOSAVE),e_dindex=e_link_id=null,isedit=!1};return _init}(jQuery),initNewVersionNotify=function(i){return function(){if(!Cookies.get("version",{domain:".diigo.com"})){var e=i("<div id='newVersionNotify'><div class='versionTip'>Preview the new Diigo and send us your input to make Diigo better for you!</div><div class='GoButton'><button class='submit'>Go</button></div></div>"),t=e.diigoWP({title:"New Diigo",width:660,closeEvent:function(){setNewVersionNextAlertCookie()}});e.find(".submit").on("click",function(){setDefaultPreviewCookie(),document.location.href="https://preview.diigo.com",t.diigoWP("exist")})}}}(jQuery),initQuotaNotify=function(n){return function(){var e="<div id='quotaNotify'><div class='quotaTip'><p>Your highlight number is over quota:</p><p class='quotaDetail'><span class='quotaNum'>"+_GLOBAL_VAR.permissions.annPermission.annotationQuota+"</span> higlights for "+_GLOBAL_VAR.permissions.servicePlanName+" plan, you have <span class='usedNum'>"+_GLOBAL_VAR.permissions.annPermission.annotationUsedCount+"</span> highlights</p></div><div class='upgradeDiv'><button class='submit'>Upgrade Now !</button></div></div>",t=n(e),i=t.diigoWP({title:"Over Quota",width:660});t.find(".submit").on("click",function(){setDefaultPreviewCookie(),document.location.href="https://www.diigo.com/premium?f=oquota",i.diigoWP("exist")})}}(jQuery),insertExtensionTip=function(e){var t=e('<div id="installDiigoChromeExtension">Install Diigo Extension</div>');return function(){e.browser.isChrome&&0==e("#diigo-chrome-installed").length&&t.insertAfter("#MyLibSearchbox"),t.on("click",function(){window._gaq&&window._gaq.push&&_gaq.push(["_trackEvent","new user guide","install extension","chrome-promote"]),chrome.webstore.install("https://chrome.google.com/webstore/detail/pnhplgjpclknigjpccbcnmicgcieojbh",function(){window._gaq&&window._gaq.push&&_gaq.push(["_trackEvent","new user guide","install extension","chrome-promote-installed"])},function(){window.open("https://chrome.google.com/webstore/detail/pnhplgjpclknigjpccbcnmicgcieojbh")})})}}(jQuery)}function addImage(){inpageNewImage()}function addBookmark(){inpageNewBookmark()}function addPdf(){inPageNewPdf()}function downloadPdf(e,t){var i="/item/pdf/download?link_id="+_GLOBAL_VAR.ditems[e].link_id;t&&(i+="&original=true"),window.open(i)}function showNewUserExperience(){newUserExperience()}function showExtensionTip(){insertExtensionTip()}function addNote(){inpageNewNote()}function editNote(e){var t=_GLOBAL_VAR.ditems[e].title,i=_GLOBAL_VAR.ditems[e].note_content,n=_GLOBAL_VAR.ditems[e].t_name,o=_GLOBAL_VAR.ditems[e].link_id,a=_GLOBAL_VAR.ditems[e].is_rich_note,s=_GLOBAL_VAR.ditems[e].private;inpageNewNote({title:t,content:i,tags:n,link_id:o,isRich:a,dindex:e,isPrivate:s})}function convert_note_rich_to_text(e){var t=e.replace(/<.*?>/g,"");return t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ")}function newVersionNotify(){initNewVersionNotify()}function quotaNotify(){_GLOBAL_VAR.permissions&&!_GLOBAL_VAR.permissions.annPermission.annotationPermission&&initQuotaNotify()}function setNewVersionNextAlertCookie(){var e=Cookies.get("versionAlertDays",{domain:".diigo.com"});null==e?e=1:(e=parseInt(e))?e+=2:e=1,Cookies.remove("versionAlertDays",{domain:".diigo.com"}),Cookies.set("versionAlertDays",e,{domain:".diigo.com"}),Cookies.remove("version",{domain:".diigo.com"}),Cookies.set("version","old",{expire:e,domain:".diigo.com"})}function setDefaultPreviewCookie(){Cookies.set("version","preview",{domain:".diigo.com"}),Cookies.remove("versionAlertDays",{domain:".diigo.com"})}function removeClassicVersionCookie(){Cookies.remove("version",{domain:".diigo.com"}),window.location.reload()}